lights_bright_up:
  alias: Lights Brightness Up
  sequence:
  - service: light.turn_on
    data_template:
      entity_id: "{{ entity_id }}"
      brightness: >
        {% set n = (state_attr(entity_id, "brightness") | int) + 50 %}
        {% if n > 254 %}
          254
        {% else %}
          {{ n }}
        {% endif %}

lights_bright_down:
  alias: Lights Brightness Down
  sequence:
  - service: light.turn_on
    data_template:
      entity_id: "{{ entity_id }}"
      brightness: >
        {% set n = state_attr(entity_id, 'brightness') | int - 50 %}
        {% if n < 4 %}
          4
        {% else %}
          {{ n }}
        {% endif %}

all_lights_off:
  alias: All Lights Off
  sequence:
  - service: light.turn_off
    data:
      entity_id: group.all_lights
  - service: switch.turn_off
    data:
      entity_id: switch.power_outlet_1
  - service: switch.turn_off
    data:
      entity_id: switch.power_outlet_2
  - service: switch.turn_off
    data:
      entity_id: switch.ikea_outlet_1 #patio-lights

turn_on_living_room_lights:
  alias: Turn On Living Room Lights
  sequence:
  - service: switch.turn_off
    data:
      entity_id: switch.living_room_fluxer
  - service: light.turn_on
    data:
      entity_id: light.living_room_lights
      brightness: '255'

turn_off_interior_lights:
  alias: Turn Off Interior Lights
  sequence:
  - service: light.turn_off
    data:
      entity_id: light.interior_lights
  - service: switch.turn_off
    data:
      entity_id:
      - group.interior_light_switches

turn_on_interior_lights:
  alias: Turn On Interior Lights
  sequence:
  - service: script.turn_on_living_room_lights
  - service: script.turn_on_kitchen_lights
  - service: script.turn_on_patio_lights

turn_on_air_purifier:
  alias: Turn On Air Purifier
  sequence:
  - service: switch.turn_on
    data:
      entity_id: switch.ikea_outlet_2
      
turn_off_air_purifier:
  alias: Turn Off Air Purifier
  sequence:
  - service: switch.turn_off
    data:
      entity_id: switch.ikea_outlet_2

turn_on_patio_lights:
  alias: Turn On Patio Lights
  sequence:
  - service: switch.turn_on
    data:
      entity_id: switch.ikea_outlet_2

turn_off_patio_lights:
  alias: Turn Off Patio Lights
  sequence:
  - service: switch.turn_off
    data:
      entity_id: switch.ikea_outlet_2

set_climate_away_mode:
  alias: Set Climate Away Mode
  sequence:
  - service: climate.set_preset_mode
    data:
      entity_id: climate.thermostat
      preset_mode: away

resume_climate_schedule:
  alias: Resume Climate Schedule
  sequence:
  - service: climate.ecobee_resume_program
    data:
      entity_id: climate.thermostat
      resume_all: true

turn_off_media_players:
  alias: Turn Off Media Players
  sequence:
  - service: media_player.turn_off
    entity_id:
    - media_player.living_room_tv_2
    - media_player.living_room_receiver

turn_on_kitchen_lights:
  alias: Turn On Kitchen Lights
  sequence:
  - service: switch.turn_on
    entity_id:
    - switch.power_outlet_1
    - switch.power_outlet_2

turn_on_entry_way_lights:
  alias: Turn On Entry Way Lights
  sequence:
  - service: light.turn_on
    data:
      entity_id: light.laundry_room_lights
      brightness: '255'

automation_mode_transition_sleep_to_home:
  alias: Sleep Mode to Home Mode
  sequence:
  - service: script.turn_off_air_purifier
  
  # if it's early in the morning, turn some lights on
  - condition: time
    after: '04:00:00'
    before: '08:00:00'
  - service: script.turn_on_kitchen_lights
  - service: light.turn_on
    data:
      entity_id: light.living_room_lights
      brightness: '255'
  - service: switch.turn_off
    data:
      entity_id: switch.living_room_fluxer

  # if it's also a weekday, turn on some more lights
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - service: script.turn_on_entry_way_lights

automation_mode_transition_away_to_home:
  alias: Away Mode to Home Mode
  sequence:
  # Turn off noisy fan, resume A/C schedule
  - service: script.turn_off_air_purifier
  - service: script.resume_climate_schedule

  # if it's dark out, turn on some lights
  - condition: or
    conditions:
    - condition: state
      entity_id: sun.sun
      state: below_horizon
    - condition: numeric_state
      entity_id: sensor.lightlevel_21
      below: '100'
  - service: script.turn_on_interior_lights


automation_mode_transition_other:
  alias: Other Mode to Other Mode
  sequence:
  - service: notify.html5_notifications
    data:
      message: 'automation_mode_transition_other'


set_automation_mode:
  alias: Set Automation Mode
  sequence:
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if (new_mode == "home") %}
          {% if (previous_mode == "sleep") %}
            script.automation_mode_transition_sleep_to_home
          {% elif (previous_mode == "away") %}
            script.automation_mode_transition_away_to_home
          {% else %}
            script.automation_mode_transition_other
          {% endif %}
        {% else %}
          script.automation_mode_transition_other
        {% endif %}

      # message: 'Mode changed from {{ previous_mode }} to {{ new_mode }}'

# set_automation_mode_home:
#   alias: Home Mode
#   sequence:
  
  # - service: switch.turn_on
  #   data:
  #     entity_id: group.kitchen_cabinet_lights
  # - service: script.turn_off_air_purifier
  # - service: script.resume_climate_schedule
  # - condition: or
  #   conditions:
  #   - condition: state
  #     entity_id: sun.sun
  #     state: below_horizon
  #   - condition: numeric_state
  #     entity_id: sensor.lightlevel_21
  #     below: '100'
  # - service: light.turn_on
  #   data:
  #     entity_id: light.living_room_lights
  #     brightness: '255'
  # - service: script.turn_on_patio_lights

# set_automation_mode_sleep:
#   alias: Sleep Mode
#   sequence:
#   - service: input_select.select_option
#     data:
#       entity_id: input_select.automation_mode
#       option: sleep
#   - service: script.turn_on_air_purifier
#   - service: script.turn_off_interior_lights

fast_enable_flux_living_room:
  alias: Fast Enable Living Room Flux
  sequence:
  - service: switch.turn_on
    data:
      entity_id: switch.living_room_fluxer_fast
  - delay:
      seconds: 2
  - service: switch.turn_off
    data:
      entity_id: switch.living_room_fluxer_fast
  - service: switch.turn_on
    data:
      entity_id: switch.living_room_fluxer

hass_restart:
  alias: Restart Home Assistant
  sequence:
  - service: homeassistant.restart

living_room_on:
  alias: Living Room On
  sequence:
  - service: light.turn_on
    data:
      entity_id: light.living_room_lights
  - service: media_player.turn_on
    data:
      entity_id:
      - media_player.living_room_tv_2
      - media_player.living_room_receiver

work_mode:
  alias: Work Mode
  sequence:
  - service: light.turn_off
    entity_id:
    - light.master_bedroom_lights
    - light.living_room_lights
    - light.guest_room_lights
    - light.laundry_room_lights
    - light.driveway_lights
  - service: switch.turn_off
    entity_id:
    - switch.power_outlet_1
    - switch.power_outlet_2
    - switch.ikea_outlet_1

foobar:
  sequence:
  - service: automation.trigger
    entity_id:
    - automation.isuck_large_clean_complete
    - automation.isuck_medium_clean_complete