[{"id":"4d34c979.7acd48","type":"tab","label":"Flux","disabled":false,"info":""},{"id":"c3c8a381.c1927","type":"tab","label":"Light Schedule [PRD]","disabled":false,"info":""},{"id":"f7e7a8ac.19a538","type":"tab","label":"Motion","disabled":false,"info":""},{"id":"d1f48851.ea8a08","type":"tab","label":"Push Notifications","disabled":false,"info":""},{"id":"d0661cff.7e5c6","type":"tab","label":"Garage","disabled":false,"info":""},{"id":"1b9a9b6a.3dd0f5","type":"tab","label":"RGB Shuffler","disabled":false,"info":""},{"id":"dbd2ebf4.b8f648","type":"tab","label":"Presence","disabled":false,"info":""},{"id":"a5e69210.f37a9","type":"tab","label":"Automation Mode","disabled":false,"info":""},{"id":"abbc1f2.48c95e","type":"tab","label":"Chill Mode","disabled":false,"info":""},{"id":"75ccec5b.f7e364","type":"tab","label":"Night Shift","disabled":false,"info":""},{"id":"b388976.2f76968","type":"tab","label":"Security","disabled":false,"info":""},{"id":"2ef67aae.d4bfe6","type":"tab","label":"Wall Tablet","disabled":false,"info":""},{"id":"6ce2b51b.d6eccc","type":"tab","label":"Man Cave Tablet","disabled":false,"info":""},{"id":"a0c38079.b2ea6","type":"tab","label":"Script Triggers","disabled":false,"info":""},{"id":"644db6a5.3303b8","type":"tab","label":"Last Watch AI","disabled":false,"info":""},{"id":"af9f7dc8.af217","type":"tab","label":"Smart Light Toggle","disabled":false,"info":""},{"id":"47850f9e.3112f","type":"tab","label":"Scenes","disabled":false,"info":""},{"id":"d390bbbb.863388","type":"tab","label":"Sensors","disabled":false,"info":""},{"id":"b0806f39.3a32c","type":"tab","label":"Vacation","disabled":false,"info":""},{"id":"4bc9cecd.d3884","type":"tab","label":"Blue Iris","disabled":false,"info":""},{"id":"7acad338.91f38c","type":"tab","label":"Telegram Feed Bot","disabled":false,"info":""},{"id":"9baffb82.f57ff8","type":"tab","label":"Telegram Alarm Bot","disabled":false,"info":""},{"id":"c6727c1e.1d54f","type":"tab","label":"Dimmers","disabled":false,"info":""},{"id":"ba1d0806.5d5398","type":"tab","label":"Voice Commands","disabled":false,"info":""},{"id":"aa7cb008.caa93","type":"tab","label":"Doorbell","disabled":false,"info":""},{"id":"1c2e799b.e17e86","type":"subflow","name":"Man Cave Auto Scene","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"1ad33a79.bcfbb6"}]}],"out":[{"x":780,"y":80,"wires":[{"id":"cf06adde.d4bc8","port":0}]}],"env":[],"color":"#DDAA99","status":{"x":780,"y":140,"wires":[{"id":"dae424d6.6e0b38","port":0}]}},{"id":"334bdfca.304fb","type":"subflow","name":"Light Group Service Call","info":"Call the light.turn_on service to change attributes like brightness, temperature, rgb, etc. for all entities in a group. Ignores lights that are turned off. Useful for adjusting a light group without inadvertently turning on other lights in the group.\n\n## Inputs\n\n(required) `msg.payload.group_id` set to the entity_id of the group, e.g. group.kitchen_lights\n\n(required) `msg.payload.service_data` set to a json object of service attributes for the light.turn_on service.\n\n\nExample payload:\n\n```\n{\n    \"group_id\": \"group.kitchen_lights\",\n    \"service_data\": {\n        \"brightness_step\": 50\n    }\n}\n```","category":"","in":[{"x":40,"y":80,"wires":[{"id":"3430a23b.11092e"}]}],"out":[{"x":1480,"y":80,"wires":[{"id":"3e462361.78b1dc","port":0}]}],"env":[],"color":"#E6E0F8","icon":"font-awesome/fa-lightbulb-o","status":{"x":1260,"y":140,"wires":[{"id":"71cacd05.4a4054","port":0}]}},{"id":"ea924b33.c97d48","type":"subflow","name":"Master Bedroom Auto Scene","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"27c0bf74.75f7c"}]}],"out":[{"x":640,"y":40,"wires":[{"id":"59ff308e.1a228","port":0}]}],"env":[],"color":"#FFAAAA","icon":"font-awesome/fa-adjust","status":{"x":640,"y":100,"wires":[{"id":"5d170fc2.95f3a","port":0}]}},{"id":"47ecb152.aed62","type":"subflow","name":"Laundry Room Auto Scene","info":"","category":"","in":[{"x":20,"y":20,"wires":[{"id":"23e8d1e6.064b6e"}]}],"out":[{"x":720,"y":60,"wires":[{"id":"f8dcb71.20d6848","port":0}]}],"env":[],"color":"#DDAA99","status":{"x":700,"y":120,"wires":[{"id":"c94198a5.999958","port":0}]}},{"id":"3b8908a.fcea8f8","type":"subflow","name":"Light Group Increase Brightness","info":"Increase brightness of a light group without turning on lights in the group that are turned off.","category":"","in":[{"x":40,"y":60,"wires":[{"id":"85922967.04d138"}]}],"out":[{"x":820,"y":60,"wires":[{"id":"7c4ff98f.a61b98","port":0}]}],"env":[],"color":"#DDAA99","status":{"x":520,"y":160,"wires":[{"id":"1f9de8e8.230de7","port":0}]}},{"id":"42ad5100.25527","type":"subflow","name":"Light Group Decrease Brightness","info":"Decrease brightness of a light group without turning on lights that are currently off, and without turning off the group when the minimum brightness is hit.","category":"","in":[{"x":20,"y":80,"wires":[{"id":"45351442.4ff2cc"}]}],"out":[{"x":920,"y":80,"wires":[{"id":"e4530942.d23ba8","port":0}]}],"env":[],"color":"#DDAA99","status":{"x":700,"y":180,"wires":[{"id":"e49a5dd.e1210a","port":0}]}},{"id":"bd7887b2.0cf798","type":"subflow","name":"House Is Dark?","info":"","category":"","in":[{"x":60,"y":100,"wires":[{"id":"468a5f5.229c2a"}]}],"out":[{"x":1260,"y":40,"wires":[{"id":"9e0f3dee.1f2b6","port":0}]},{"x":1260,"y":160,"wires":[{"id":"5e9092f0.64e8fc","port":0}]}],"env":[],"color":"#DDAA99","status":{"x":1260,"y":100,"wires":[{"id":"4a48c0f0.5e053","port":0}]}},{"id":"b62e4b55.b6e888","type":"subflow","name":"Get Trigger User Name","info":"","category":"","in":[{"x":280,"y":140,"wires":[{"id":"8ca2a17.9ca4d6"}]}],"out":[{"x":1080,"y":140,"wires":[{"id":"63bfcf7a.4ea8c","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"a86c4410.e2a568","type":"server","name":"Home Assistant","legacy":false,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true},{"id":"e5627157.6cda8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"f1ce55a2.fcd558","type":"position-config","name":"Silverleaf","isValide":"true","longitude":"0","latitude":"0","angleType":"deg","timeZoneOffset":99,"timeZoneDST":0,"stateTimeFormat":"3","stateDateFormat":"12"},{"id":"e7767a8a.ec2a28","type":"mqtt-broker","name":"HA-Broker","broker":"192.168.1.53","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"ff59c515.6b4888","type":"switch","z":"c3c8a381.c1927","name":"IF (HOME, SUNSET)","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"topic = \"sun.sun\" and $globalContext('automation_mode') in ['home', 'guest'] and payload = \"below_horizon\"","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":160,"wires":[["e6bb7917.e655d8","d9cfbe8d.f6c8b"]]},{"id":"d8664183.3795c","type":"switch","z":"c3c8a381.c1927","name":"IF (SUNRISE)","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"topic = \"sun.sun\" and payload = \"above_horizon\"","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":1,"x":720,"y":280,"wires":[["4f2dc313.64e01c"]]},{"id":"82f3e546.6ac108","type":"trigger-state","z":"c3c8a381.c1927","name":"State Trigger: sensor.time","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"sensor.time","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":190,"y":240,"wires":[["67e85155.6ad8c"],[]]},{"id":"76e1a905.a7ed98","type":"switch","z":"c3c8a381.c1927","name":"IF (HOME, 4PM)","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"topic = \"sensor.time\" and payload = \"16:00\" and $globalContext('automation_mode') in ['home', 'guest']","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":1,"x":730,"y":340,"wires":[["8ab9b9ad.8d7048"]]},{"id":"8ab9b9ad.8d7048","type":"api-call-service","z":"c3c8a381.c1927","name":"Ledge Flux On","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.ledge_scene_flux","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":340,"wires":[[]]},{"id":"d5a4bceb.bd591","type":"switch","z":"c3c8a381.c1927","name":"IF (NOT_HOME, SUNSET)","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"topic = \"sun.sun\" and $globalContext('automation_mode') in ['away', 'sleep'] and payload = \"below_horizon\"","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":1,"x":760,"y":220,"wires":[["6f320f36.e8e79"]]},{"id":"8eeae444.3f6948","type":"comment","z":"4d34c979.7acd48","name":"Circadian Lightijng (using sun position)","info":"","x":770,"y":340,"wires":[]},{"id":"43bb9f54.4e777","type":"range","z":"4d34c979.7acd48","minin":"-90","maxin":"90","minout":"1","maxout":"6000","action":"clamp","round":true,"property":"payload.kelvin","name":"percent to kelvin range","x":720,"y":380,"wires":[["589fd94f.9b3b48"]]},{"id":"212eb7d9.de2628","type":"change","z":"4d34c979.7acd48","name":"","rules":[{"t":"set","p":"circadian_kelvin","pt":"flow","to":"payload.kelvin","tot":"msg"},{"t":"set","p":"circadian_percent","pt":"flow","to":"payload.percent","tot":"msg"},{"t":"set","p":"circadian_rgb","pt":"flow","to":"payload.rgb","tot":"msg"},{"t":"set","p":"circadian_kelvin","pt":"global","to":"payload.kelvin","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1100,"y":380,"wires":[["cfefc5bd.c1f8e8","74fd7dfa.8bc6b4","6dce4c70.38a8a4","563153d7.8339fc"]]},{"id":"30098ea6.092542","type":"inject","z":"4d34c979.7acd48","name":"every 30 seconds","repeat":"30","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"","payloadType":"date","x":130,"y":380,"wires":[["6cbd12eb.4fdaec"]]},{"id":"589fd94f.9b3b48","type":"function","z":"4d34c979.7acd48","name":"Kelvin to RGB","func":"// these functions were converted from Home Assistant's python version of it.\n// https://github.com/home-assistant/home-assistant/blob/05ecc5a1355c7af11b5d310470a6171528dc7a2b/homeassistant/util/color.py\n\nvar color_temperature_to_rgb = function(color_temperature_kelvin) {\n    /*\n    Return an RGB color from a color temperature in Kelvin.\n    This is a rough approximation based on the formula provided by T. Helland\n    http://www.tannerhelland.com/4435/convert-temperature-rgb-algorithm-code/\n    */\n    // range check\n    if(color_temperature_kelvin < 1000) {\n        color_temperature_kelvin = 1000;\n    } else if(color_temperature_kelvin > 40000) {\n        color_temperature_kelvin = 40000;\n    }\n\n    tmp_internal = color_temperature_kelvin / 100.0;\n\n    red = _get_red(tmp_internal);\n    green = _get_green(tmp_internal);\n    blue = _get_blue(tmp_internal);\n\n    return [red, green, blue];\n};\n\nvar _get_red = function(temperature) {\n    // Get the red component of the temperature in RGB space.\n    if(temperature <= 66){\n        return 255;\n    }\n    tmp_red = 329.698727446 * Math.pow(temperature - 60, -0.1332047592);\n    return _bound(tmp_red);\n}\n\nvar _get_green = function(temperature) {\n    // Get the green component of the given color temp in RGB space.\n    if(temperature <= 66){\n        green = 99.4708025861 * Math.log(temperature) - 161.1195681661;\n    } else {\n        green = 288.1221695283 * Math.pow(temperature - 60, -0.0755148492);\n    }\n    return _bound(green);\n}\n\nvar _get_blue = function(temperature) {\n    // Get the blue component of the given color temperature in RGB space.\n    if(temperature >= 66){\n        return 255;\n    } else if(temperature <= 19){\n        return 0;\n    }\n    blue = 138.5177312231 * Math.log(temperature - 10) - 305.0447927307;\n    return _bound(blue);\n}\n\nvar _bound = function(color_component, minimum=0, maximum=255) {\n    /*\n    Bound the given color component value between the given min and max values.\n    The minimum and maximum values will be included in the valid output.\n    i.e. Given a color_component of 0 and a minimum of 10, the returned value\n    will be 10.\n    */\n    color_component_out = Math.max(color_component, minimum);\n    return Math.min(color_component_out, maximum);\n}\n\nmsg.payload.rgb = color_temperature_to_rgb(msg.payload.kelvin);\n\nreturn msg;","outputs":1,"noerr":0,"x":920,"y":380,"wires":[["212eb7d9.de2628"]]},{"id":"cb26bcab.f5c9a","type":"change","z":"4d34c979.7acd48","name":"","rules":[{"t":"set","p":"payload.kelvin","pt":"msg","to":"payload.altitude","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":380,"wires":[["43bb9f54.4e777","df89ff02.9c083"]]},{"id":"6cbd12eb.4fdaec","type":"sun-position","z":"4d34c979.7acd48","name":"","positionConfig":"f1ce55a2.fcd558","rules":[],"onlyOnChange":"true","topic":"","outputs":1,"start":"","startType":"none","startOffset":0,"startOffsetType":"none","startOffsetMultiplier":60000,"end":"","endType":"none","endOffset":0,"endOffsetType":"none","endOffsetMultiplier":60000,"x":310,"y":380,"wires":[["cb26bcab.f5c9a"]]},{"id":"bf5b8cf1.ec4c2","type":"api-call-service","z":"4d34c979.7acd48","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_text","service":"set_value","entityId":"input_text.daylight_rgb","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":true,"x":1510,"y":480,"wires":[[]]},{"id":"74fd7dfa.8bc6b4","type":"function","z":"4d34c979.7acd48","name":"RGB Data","func":"return {\n    payload: {\n        \"data\": {\n            \"value\": flow.get(\"circadian_rgb\").toString()\n        }\n    }\n}","outputs":1,"noerr":0,"x":1290,"y":480,"wires":[["bf5b8cf1.ec4c2"]]},{"id":"6dce4c70.38a8a4","type":"function","z":"4d34c979.7acd48","name":"Kelvin Data","func":"return {\n    payload: {\n        \"data\": {\n            \"value\": flow.get(\"circadian_kelvin\")\n        }\n    }\n}","outputs":1,"noerr":0,"x":1290,"y":540,"wires":[["d9d4e40f.1e2f48"]]},{"id":"d9d4e40f.1e2f48","type":"api-call-service","z":"4d34c979.7acd48","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.daylight_kelvin","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":true,"x":1520,"y":540,"wires":[[]]},{"id":"84c393a7.19107","type":"change","z":"4d34c979.7acd48","name":"ledge_strips_are_fluxed := false","rules":[{"t":"set","p":"ledge_strips_are_fluxed","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1090,"y":840,"wires":[[]]},{"id":"2370ff74.227fc","type":"change","z":"4d34c979.7acd48","name":"ledge_strips_are_fluxed := true","rules":[{"t":"set","p":"ledge_strips_are_fluxed","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1410,"y":840,"wires":[[]]},{"id":"64981787.fd18f8","type":"http response","z":"4d34c979.7acd48","name":"","statusCode":"200","headers":{},"x":1520,"y":320,"wires":[]},{"id":"cfefc5bd.c1f8e8","type":"switch","z":"4d34c979.7acd48","d":true,"name":"is HTTP request","property":"res","propertyType":"msg","rules":[{"t":"istype","v":"object","vt":"object"}],"checkall":"true","repair":false,"outputs":1,"x":1320,"y":320,"wires":[["64981787.fd18f8"]]},{"id":"22cf8df7.f3d6d2","type":"inject","z":"4d34c979.7acd48","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"altitude\":-90}","payloadType":"json","x":310,"y":440,"wires":[["cb26bcab.f5c9a"]]},{"id":"35f7fd2c.ffe4b2","type":"trigger-state","z":"4d34c979.7acd48","name":"Ledge Lights On","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"light.ledge_strips","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"hj4iazjncr","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"sg3tblo1wf","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":460,"y":900,"wires":[["81f27104.74dee"],[]]},{"id":"81f27104.74dee","type":"api-current-state","z":"4d34c979.7acd48","name":"Ledge Fluxer Is On/Off","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.ledge_fluxer","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":780,"y":760,"wires":[["e370794.1ab4688"],["84c393a7.19107"]]},{"id":"71cf9d8c.22c764","type":"api-current-state","z":"4d34c979.7acd48","name":"Ledge Strips Are On","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.ledge_strips","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":440,"y":780,"wires":[["81f27104.74dee"],["84c393a7.19107"]]},{"id":"19c94091.dfe66f","type":"trigger-state","z":"4d34c979.7acd48","name":"Ledge Lights Off","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"light.ledge_strips","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"2rk3lvyp7l2","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":460,"y":1020,"wires":[["84c393a7.19107"],[]]},{"id":"f86ed797.9187e8","type":"server-state-changed","z":"c3c8a381.c1927","name":"","server":"a86c4410.e2a568","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sun.sun","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":160,"wires":[["67e85155.6ad8c"]]},{"id":"a0926286.bcb19","type":"trigger-state","z":"4d34c979.7acd48","name":"Ledge Fluxer Switch On","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_boolean.ledge_fluxer","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"82p99vyoycj","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"yzhrxpc961p","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":430,"y":840,"wires":[["81f27104.74dee","b3966e3e.2167b"],[]]},{"id":"bba75229.a9d2","type":"trigger-state","z":"4d34c979.7acd48","name":"Ledge Fluxer Switch Off","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_boolean.ledge_fluxer","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"oh4eijwt2jq","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"9r55ag39yns","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":430,"y":960,"wires":[["84c393a7.19107"],[]]},{"id":"cc0617b9.6490c8","type":"link in","z":"4d34c979.7acd48","name":"Auto Updater","links":["563153d7.8339fc"],"x":55,"y":780,"wires":[["71cf9d8c.22c764"]]},{"id":"563153d7.8339fc","type":"link out","z":"4d34c979.7acd48","name":"Auto Updater","links":["cc0617b9.6490c8","17313e48.1a0442","5cab625f.7f6b3c","bfc3e021.9cf61"],"x":1255,"y":380,"wires":[]},{"id":"2300b7f.3df0c48","type":"server-events","z":"c6727c1e.1d54f","name":"","server":"a86c4410.e2a568","event_type":"deconz_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"x":140,"y":320,"wires":[["1685addb.5ac622","e3dd58be.f8fad8"]]},{"id":"1685addb.5ac622","type":"function","z":"c6727c1e.1d54f","name":"Config","func":"flow.set(\"dimmerSwitchEventIds\", [\n   \"man_cave_dimmer_switch\",\n   \"master_bedroom_dimmer_switch\",\n   \"dimmer_switch\",\n   \"guest_room_dimmer_switch\"\n]);\n\nflow.set(\"dimmerGroupIds\", [\n    \"group.man_cave_lights\"\n]);\n\nflow.set(\"dimmerSwitchOnPressEvent\", 1000);\nflow.set(\"dimmerSwitchOnHoldEvent\", 1001);\nflow.set(\"dimmerSwitchOnReleaseEvent\", 1002);\n\nflow.set(\"dimmerSwitchBrightnessUpPressEvent\", 2000);\nflow.set(\"dimmerSwitchBrightnessUpHoldEvent\", 2001);\nflow.set(\"dimmerSwitchBrightnessUpReleaseEvent\", 2002);\n\nflow.set(\"dimmerSwitchBrightnessDownPressEvent\", 3000);\nflow.set(\"dimmerSwitchBrightnessDownHoldEvent\", 3001);\nflow.set(\"dimmerSwitchBrightnessDownReleaseEvent\", 3002);\n\nflow.set(\"dimmerSwitchOffPressEvent\", 4000);\nflow.set(\"dimmerSwitchOffHoldEvent\", 4001);\nflow.set(\"dimmerSwitchOffReleaseEvent\", 4002);\n\nflow.set(\"tapSwitchEventIds\", [\n    \"tap_switch_1\"\n]);\n\nflow.set(\"tapSwitchPressI\", 34);\nflow.set(\"tapSwitchPressII\", 16);\nflow.set(\"tapSwitchPressIII\", 17);\nflow.set(\"tapSwitchPressIV\", 18);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":320,"wires":[["61566e8e.c582"]]},{"id":"61566e8e.c582","type":"switch","z":"c6727c1e.1d54f","name":"Devices","property":"payload.event.id","propertyType":"msg","rules":[{"t":"eq","v":"dimmerSwitchEventIds[0]","vt":"flow"},{"t":"eq","v":"dimmerSwitchEventIds[1]","vt":"flow"},{"t":"eq","v":"dimmerSwitchEventIds[2]","vt":"flow"},{"t":"eq","v":"dimmerSwitchEventIds[3]","vt":"flow"},{"t":"eq","v":"tapSwitchEventIds[0]","vt":"flow"}],"checkall":"true","repair":false,"outputs":5,"x":740,"y":320,"wires":[["975a74e9.ec9e08"],["49dab70e.08b9a8","8f236d44.4f323"],["49dab70e.08b9a8","8f236d44.4f323"],["247d4339.1b89ac"],["c1c8621b.2fb1e"]]},{"id":"3fe31cd8.6b35b4","type":"switch","z":"c6727c1e.1d54f","name":"Event","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"dimmerSwitchOnPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchOnHoldEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessUpPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessUpHoldEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessDownPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessDownHoldEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchOffPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchOffHoldEvent","vt":"flow"}],"checkall":"true","repair":false,"outputs":8,"x":1210,"y":300,"wires":[["d50459e2.af91d8"],["3193f7b5.211028"],["4d4cb5a0.5e603c"],["27a91cc7.2609e4"],["15a52c34.e626d4"],["25950e5a.0f0162"],["ecabf116.651d9"],["eca51371.38624"]]},{"id":"3193f7b5.211028","type":"api-call-service","z":"c6727c1e.1d54f","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.man_cave_scene_focus","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1450,"y":260,"wires":[[]]},{"id":"ecabf116.651d9","type":"api-call-service","z":"c6727c1e.1d54f","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.man_cave_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1450,"y":560,"wires":[[]]},{"id":"1ad33a79.bcfbb6","type":"api-current-state","z":"1c2e799b.e17e86","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.time","state_type":"str","state_location":"time","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":190,"y":80,"wires":[["d647d482.63c1f8"]]},{"id":"d647d482.63c1f8","type":"function","z":"1c2e799b.e17e86","name":"Determine Scene","func":"var hr = parseInt(msg.time.substring(0, 2));\nvar sceneId = \"\";\n\nif (global.get(\"chill_mode\") == \"on\") {\n    sceneId = \"scene.man_cave_scene_wind_down\";\n}\nelse if (hr >= 4 && hr < 8) {\n    sceneId = \"scene.man_cave_scene_wake_up\";\n}\nelse if (hr >= 8 && hr < 11) {\n    sceneId = \"scene.man_cave_scene_warm_white\";\n}\nelse if (hr >= 11 && hr < 16) {\n    sceneId = \"scene.man_cave_scene_focus\";\n}\nelse if (hr >= 16 && hr < 22) {\n    sceneId = \"scene.man_cave_scene_sweet_tart\";    \n}\nelse if (hr >= 22 || hr < 4) {\n    sceneId = \"scene.man_cave_scene_wind_down\";\n}\n\nmsg.man_cave_scene_id = sceneId;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":80,"wires":[["cf06adde.d4bc8"]]},{"id":"cf06adde.d4bc8","type":"api-call-service","z":"1c2e799b.e17e86","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"","data":"{\"entity_id\":\"{{man_cave_scene_id}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":630,"y":80,"wires":[[]]},{"id":"d50459e2.af91d8","type":"subflow:1c2e799b.e17e86","z":"c6727c1e.1d54f","name":"","env":[],"x":1460,"y":200,"wires":[[]]},{"id":"dae424d6.6e0b38","type":"status","z":"1c2e799b.e17e86","name":"","scope":["1ad33a79.bcfbb6","cf06adde.d4bc8"],"x":600,"y":140,"wires":[[]]},{"id":"dcfe0189.303cf","type":"api-current-state","z":"334bdfca.304fb","name":"Get Turned On Lights","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"{{ payload }}","state_type":"str","state_location":"state","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":980,"y":80,"wires":[["ae868c5c.7e546"],[]]},{"id":"109b05f5.6d12fa","type":"split","z":"334bdfca.304fb","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":810,"y":80,"wires":[["dcfe0189.303cf"]]},{"id":"ba19d76.6fff928","type":"api-current-state","z":"334bdfca.304fb","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"{{ flow.group_id }}","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":430,"y":80,"wires":[["a5656ef5.212ce"]]},{"id":"a5656ef5.212ce","type":"change","z":"334bdfca.304fb","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"data.attributes.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":80,"wires":[["109b05f5.6d12fa"]]},{"id":"ae868c5c.7e546","type":"api-call-service","z":"334bdfca.304fb","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"{{ data.entity_id }}","data":"","dataType":"json","mergecontext":"service_data","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1190,"y":80,"wires":[["3e462361.78b1dc"]]},{"id":"3e462361.78b1dc","type":"join","z":"334bdfca.304fb","name":"","mode":"custom","build":"array","property":"data.entity_id","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1350,"y":80,"wires":[[]]},{"id":"3430a23b.11092e","type":"function","z":"334bdfca.304fb","name":"Setup Variables","func":"flow.set(\"group_id\", msg.payload.group_id);\nflow.set(\"service_data\", msg.payload.service_data);\n\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":80,"wires":[["ba19d76.6fff928"]]},{"id":"4d4cb5a0.5e603c","type":"change","z":"c6727c1e.1d54f","name":"Brightness +50","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group_id\":\"group.man_cave_lights\",\"service_data\":{\"brightness_step\":50}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":320,"wires":[["b54c88d8.8c0658"]]},{"id":"975a74e9.ec9e08","type":"change","z":"c6727c1e.1d54f","name":"","rules":[{"t":"set","p":"group_id","pt":"flow","to":"group.man_cave_lights","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":300,"wires":[["3fe31cd8.6b35b4"]]},{"id":"b54c88d8.8c0658","type":"subflow:334bdfca.304fb","z":"c6727c1e.1d54f","name":"","env":[],"x":1650,"y":320,"wires":[[]]},{"id":"71cacd05.4a4054","type":"status","z":"334bdfca.304fb","name":"","scope":["ae868c5c.7e546"],"x":1160,"y":140,"wires":[[]]},{"id":"27a91cc7.2609e4","type":"change","z":"c6727c1e.1d54f","name":"Brightness Max","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group_id\":\"group.man_cave_lights\",\"service_data\":{\"brightness\":255}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":380,"wires":[["ed216922.a369c8"]]},{"id":"ed216922.a369c8","type":"subflow:334bdfca.304fb","z":"c6727c1e.1d54f","name":"","env":[],"x":1650,"y":380,"wires":[[]]},{"id":"15a52c34.e626d4","type":"change","z":"c6727c1e.1d54f","name":"Brightness -50","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group_id\":\"group.man_cave_lights\",\"service_data\":{\"brightness_step\":-50}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":440,"wires":[["1caa6dd7.d5c952"]]},{"id":"1caa6dd7.d5c952","type":"subflow:334bdfca.304fb","z":"c6727c1e.1d54f","name":"","env":[],"x":1650,"y":440,"wires":[[]]},{"id":"25950e5a.0f0162","type":"change","z":"c6727c1e.1d54f","name":"Brightness Min","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group_id\":\"group.man_cave_lights\",\"service_data\":{\"brightness\":3}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":500,"wires":[["1e9eea50.248bb6"]]},{"id":"1e9eea50.248bb6","type":"subflow:334bdfca.304fb","z":"c6727c1e.1d54f","name":"","env":[],"x":1650,"y":500,"wires":[[]]},{"id":"39103474.3dd8fc","type":"switch","z":"c6727c1e.1d54f","name":"Event","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"dimmerSwitchOnPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchOnHoldEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessUpPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessUpHoldEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessDownPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessDownHoldEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchOffPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchOffHoldEvent","vt":"flow"}],"checkall":"true","repair":false,"outputs":8,"x":1210,"y":760,"wires":[["8697b3b5.6b575"],[],["49419447.c7ca2c"],["8a833a79.b39998"],["2ad16649.f01bfa"],["e5357364.4f3bb"],["8d09fdf8.98d0a"],["4d9bb962.5ef998"]]},{"id":"8d09fdf8.98d0a","type":"api-call-service","z":"c6727c1e.1d54f","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.master_bedroom_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1450,"y":1060,"wires":[[]]},{"id":"49dab70e.08b9a8","type":"change","z":"c6727c1e.1d54f","name":"","rules":[{"t":"set","p":"group_id","pt":"flow","to":"group.master_bedroom_lamps","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":760,"wires":[["39103474.3dd8fc"]]},{"id":"5d170fc2.95f3a","type":"status","z":"ea924b33.c97d48","name":"","scope":["59ff308e.1a228"],"x":540,"y":100,"wires":[[]]},{"id":"8697b3b5.6b575","type":"subflow:ea924b33.c97d48","z":"c6727c1e.1d54f","name":"","env":[],"x":1480,"y":700,"wires":[[]]},{"id":"4d9bb962.5ef998","type":"api-current-state","z":"c6727c1e.1d54f","name":"","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"above_horizon","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sun.sun","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1460,"y":1120,"wires":[["73ba33df.10a64c"],["4bb5243f.7e464c"]]},{"id":"4bb5243f.7e464c","type":"api-call-service","z":"c6727c1e.1d54f","name":"Back Yard Scene - Sleep","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.back_yard_scene_sleep","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1710,"y":1160,"wires":[[]]},{"id":"73ba33df.10a64c","type":"api-call-service","z":"c6727c1e.1d54f","name":"Back Yard Scene - Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.back_yard_scene_off","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1700,"y":1100,"wires":[[]]},{"id":"27c0bf74.75f7c","type":"api-current-state","z":"ea924b33.c97d48","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.daylight_kelvin","state_type":"str","state_location":"kelvin","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":250,"y":60,"wires":[["59ff308e.1a228"]]},{"id":"59ff308e.1a228","type":"api-call-service","z":"ea924b33.c97d48","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.master_bedroom_lights","data":"{\"kelvin\": {{kelvin}}, \"brightness\": 255}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":510,"y":60,"wires":[[]]},{"id":"5e540243.7630cc","type":"trigger-state","z":"f7e7a8ac.19a538","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.hue_103_motion","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"27mve08a4lj","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":370,"y":100,"wires":[["d814d531.1255c8","520cc6d7.48db18"],[]]},{"id":"87d1725d.3d478","type":"inject","z":"f7e7a8ac.19a538","name":"detected","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"entity_id\":\"binary_sensor.hue_103_motion\",\"old_state\":{\"state\":\"off\"},\"new_state\":{\"state\":\"on\"}}","payloadType":"json","x":100,"y":80,"wires":[["5e540243.7630cc"]]},{"id":"257443fa.bd49bc","type":"inject","z":"f7e7a8ac.19a538","name":"clear","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"entity_id\":\"binary_sensor.hue_103_motion\",\"old_state\":{\"state\":\"on\"},\"new_state\":{\"state\":\"off\"}}","payloadType":"json","x":110,"y":120,"wires":[["5e540243.7630cc"]]},{"id":"520cc6d7.48db18","type":"subflow:47ecb152.aed62","z":"f7e7a8ac.19a538","name":"","env":[],"x":1000,"y":100,"wires":[["1309328b.55f15d"]]},{"id":"23e8d1e6.064b6e","type":"api-current-state","z":"47ecb152.aed62","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.time","state_type":"str","state_location":"time","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":170,"y":60,"wires":[["947d7356.6f253"]]},{"id":"947d7356.6f253","type":"function","z":"47ecb152.aed62","name":"Parse Time","func":"var hr = parseInt(msg.time.substring(0, 2));\nvar sceneId = \"\";\nif ((hr >= 4 && hr < 7) || (hr >= 21 && hr < 24)) {\n    sceneId = \"scene.laundry_room_scene_night\";\n}\nelse if (hr >= 7 && hr < 21) {\n    sceneId = \"scene.laundry_room_scene_bright\";\n}\nelse if (hr >= 0 && hr < 4) {\n    sceneId = \"scene.laundry_room_scene_late_night\";    \n}\n\nmsg.scene_id = sceneId;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":60,"wires":[["f8dcb71.20d6848"]]},{"id":"f8dcb71.20d6848","type":"api-call-service","z":"47ecb152.aed62","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"","data":"{\"entity_id\":\"{{scene_id}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":580,"y":60,"wires":[[]]},{"id":"c94198a5.999958","type":"status","z":"47ecb152.aed62","name":"","scope":["f8dcb71.20d6848"],"x":580,"y":120,"wires":[[]]},{"id":"8a833a79.b39998","type":"change","z":"c6727c1e.1d54f","name":"Brightness Max","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group_id\":\"group.master_bedroom_lamps\",\"service_data\":{\"brightness\":255}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":820,"wires":[["2868e10f.d9f42e"]]},{"id":"2868e10f.d9f42e","type":"subflow:334bdfca.304fb","z":"c6727c1e.1d54f","name":"","env":[],"x":1650,"y":820,"wires":[[]]},{"id":"e5357364.4f3bb","type":"change","z":"c6727c1e.1d54f","name":"Brightness Min","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group_id\":\"group.master_bedroom_lamps\",\"service_data\":{\"brightness\":3}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":940,"wires":[["e411bd5a.c4eaf"]]},{"id":"e411bd5a.c4eaf","type":"subflow:334bdfca.304fb","z":"c6727c1e.1d54f","name":"","env":[],"x":1650,"y":940,"wires":[[]]},{"id":"49419447.c7ca2c","type":"change","z":"c6727c1e.1d54f","name":"","rules":[{"t":"set","p":"group_id","pt":"msg","to":"group_id","tot":"flow"},{"t":"set","p":"light_id","pt":"msg","to":"light.master_bedroom_lights","tot":"str"},{"t":"set","p":"brightness_interval","pt":"msg","to":"50","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":760,"wires":[["a4ed5c9a.00f78"]]},{"id":"85922967.04d138","type":"api-current-state","z":"3b8908a.fcea8f8","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"{{ light_id }}","state_type":"str","state_location":"state","override_payload":"flow","entity_location":"entity","override_data":"flow","blockInputOverrides":false,"x":230,"y":60,"wires":[["782cf826.53d368"]]},{"id":"782cf826.53d368","type":"function","z":"3b8908a.fcea8f8","name":"","func":"var brightness = flow.get(\"entity\").attributes.brightness;\nvar group_id = msg.group_id;\nvar interval = msg.brightness_interval;\n\nbrightness = brightness + interval;\n\nif (brightness > 254) {\n    brightness = 255;\n}\n\nmsg.payload = {\n    \"group_id\": group_id,\n    \"service_data\": {\n        \"brightness\": brightness\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":60,"wires":[["7c4ff98f.a61b98"]]},{"id":"7c4ff98f.a61b98","type":"subflow:334bdfca.304fb","z":"3b8908a.fcea8f8","name":"","env":[],"x":650,"y":60,"wires":[[]]},{"id":"2ad16649.f01bfa","type":"change","z":"c6727c1e.1d54f","name":"","rules":[{"t":"set","p":"group_id","pt":"msg","to":"group_id","tot":"flow"},{"t":"set","p":"light_id","pt":"msg","to":"light.master_bedroom_lights","tot":"str"},{"t":"set","p":"brightness_interval","pt":"msg","to":"50","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":880,"wires":[["223b2b69.cc0644"]]},{"id":"45351442.4ff2cc","type":"api-current-state","z":"42ad5100.25527","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"{{ light_id }}","state_type":"str","state_location":"state","override_payload":"flow","entity_location":"entity","override_data":"flow","blockInputOverrides":false,"x":210,"y":80,"wires":[["3d78e0.b23ce72"]]},{"id":"3d78e0.b23ce72","type":"function","z":"42ad5100.25527","name":"","func":"var group_id = msg.group_id;\nvar brightness = flow.get(\"entity\").attributes.brightness;\nvar interval = msg.brightness_interval ? msg.brightness_interval : 50;\n\nbrightness = brightness - interval;\nif (brightness < 3) {\n    brightness = 3;\n}\n\nmsg.payload = {\n    \"group_id\": group_id,\n    \"service_data\": {\n        \"brightness\": brightness\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":80,"wires":[["e4530942.d23ba8"]]},{"id":"e4530942.d23ba8","type":"subflow:334bdfca.304fb","z":"42ad5100.25527","name":"","env":[],"x":710,"y":80,"wires":[[]]},{"id":"1f9de8e8.230de7","type":"status","z":"3b8908a.fcea8f8","name":"","scope":["7c4ff98f.a61b98"],"x":400,"y":160,"wires":[[]]},{"id":"a4ed5c9a.00f78","type":"subflow:3b8908a.fcea8f8","z":"c6727c1e.1d54f","name":"","x":1690,"y":760,"wires":[[]]},{"id":"223b2b69.cc0644","type":"subflow:42ad5100.25527","z":"c6727c1e.1d54f","x":1700,"y":880,"wires":[[]]},{"id":"e49a5dd.e1210a","type":"status","z":"42ad5100.25527","name":"","scope":["e4530942.d23ba8"],"x":580,"y":180,"wires":[[]]},{"id":"e370794.1ab4688","type":"function","z":"4d34c979.7acd48","name":"Svc Data","func":"msg.payload = {\n    \"group_id\": \"group.all_living_room_lights\",\n    \"service_data\": {\n        \"kelvin\": flow.get(\"circadian_kelvin\"),\n        \"transition\": 1,\n        \"brightness\": flow.get(\"circadian_brightness\")\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":760,"wires":[["eaefd140.4ab73"]]},{"id":"eaefd140.4ab73","type":"subflow:334bdfca.304fb","z":"4d34c979.7acd48","name":"","env":[],"x":1310,"y":760,"wires":[["2370ff74.227fc"]]},{"id":"b3966e3e.2167b","type":"api-call-service","z":"4d34c979.7acd48","name":"Turn off Great Room Shuffler","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.great_room_shuffler","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":800,"y":700,"wires":[[]]},{"id":"ef9dca67.5f5ab8","type":"trigger-state","z":"d1f48851.ea8a08","name":"Time == 21:00","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"sensor.time","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"h3dxej3ke5w","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"21:00"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":420,"y":340,"wires":[["a1581e14.efa7d"],[]]},{"id":"a1581e14.efa7d","type":"api-current-state","z":"d1f48851.ea8a08","name":"Garage Open?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"open","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"cover.garage_door","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":680,"y":340,"wires":[["f22a597.e0ed5a8"],[]]},{"id":"a947c96a.cc01b8","type":"api-call-service","z":"d1f48851.ea8a08","name":"Notify Andrew - Garage Door","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"title\":\"Garage Left Open\",\"message\":\"Don't forget to close it tonight!\",\"data\":{\"actions\":[{\"action\":\"notify_action_close_garage\",\"title\":\"Close Now\"},{\"action\":\"notify_action_close_garage_snooze\",\"title\":\"Snooze 1hr\"}],\"tag\":\"notify_close_garage\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1560,"y":340,"wires":[[]]},{"id":"dfbde3c2.e5d06","type":"server-events","z":"d1f48851.ea8a08","name":"","server":"a86c4410.e2a568","event_type":"mobile_app_notification_action","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"x":310,"y":1040,"wires":[["cc14a900.095218","26cfdfdd.934ac","f1dce928.8d2238","c62a7254.37995"]]},{"id":"cc14a900.095218","type":"switch","z":"d1f48851.ea8a08","name":"Close Garage","property":"payload.event.action","propertyType":"msg","rules":[{"t":"eq","v":"notify_action_close_garage","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":620,"y":1040,"wires":[["10cfba2.08dba46"]]},{"id":"32d9d84e.dd7988","type":"api-call-service","z":"d1f48851.ea8a08","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"cover","service":"close_cover","entityId":"cover.garage_door","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1200,"y":1040,"wires":[[]]},{"id":"5f7af048.2fa5b","type":"inject","z":"d1f48851.ea8a08","name":"TEST - 9PM","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"entity_id\":\"sensor.time\",\"old_state\":{\"state\":\"20:59\"},\"new_state\":{\"state\":\"21:00\"}}","payloadType":"json","x":170,"y":340,"wires":[["ef9dca67.5f5ab8"]]},{"id":"10cfba2.08dba46","type":"api-current-state","z":"d1f48851.ea8a08","name":"Garage Open?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"open","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"cover.garage_door","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":820,"y":1040,"wires":[["b35130f2.18593"],[]]},{"id":"9a464a59.d2a138","type":"inject","z":"d1f48851.ea8a08","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Debug","payload":"true","payloadType":"bool","x":860,"y":100,"wires":[["489a3adc.3bb894"]]},{"id":"e139ba3.0700e48","type":"inject","z":"d1f48851.ea8a08","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"Debug","payload":"false","payloadType":"bool","x":870,"y":140,"wires":[["489a3adc.3bb894"]]},{"id":"489a3adc.3bb894","type":"change","z":"d1f48851.ea8a08","name":"","rules":[{"t":"set","p":"debug","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":120,"wires":[[]]},{"id":"b35130f2.18593","type":"switch","z":"d1f48851.ea8a08","name":"","property":"debug","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1000,"y":1040,"wires":[[],["32d9d84e.dd7988"]]},{"id":"117e9460.a3892c","type":"inject","z":"d1f48851.ea8a08","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"Startup","payload":"","payloadType":"str","x":180,"y":80,"wires":[["7d78b4f8.23c34c"]]},{"id":"7d78b4f8.23c34c","type":"change","z":"d1f48851.ea8a08","name":"","rules":[{"t":"set","p":"notify_service_andrews_phone","pt":"global","to":"mobile_app_galaxy_s10","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":80,"wires":[[]]},{"id":"f22a597.e0ed5a8","type":"link out","z":"d1f48851.ea8a08","name":"","links":["a5c9ca97.4a1be8"],"x":815,"y":340,"wires":[]},{"id":"a5c9ca97.4a1be8","type":"link in","z":"d1f48851.ea8a08","name":"","links":["f22a597.e0ed5a8","74303e34.7e993"],"x":1375,"y":340,"wires":[["a947c96a.cc01b8"]]},{"id":"402a210c.3ecb7","type":"api-call-service","z":"d1f48851.ea8a08","name":"Dismiss Andrew - Garage Door","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"message\":\"clear_notification\",\"data\":{\"tag\":\"notify_close_garage\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1570,"y":400,"wires":[[]]},{"id":"62eb2629.ef5988","type":"trigger-state","z":"d1f48851.ea8a08","name":"Garage == Closed","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"cover.garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"d35ta03cu4","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":430,"y":420,"wires":[["35344c4.61c03b4"],[]]},{"id":"35344c4.61c03b4","type":"link out","z":"d1f48851.ea8a08","name":"","links":["ed3ccd2.687913","812d89ab.773bc8","1fe29f88.4f0b8"],"x":575,"y":420,"wires":[]},{"id":"ed3ccd2.687913","type":"link in","z":"d1f48851.ea8a08","name":"","links":["35344c4.61c03b4"],"x":1375,"y":400,"wires":[["402a210c.3ecb7"]]},{"id":"4e142c87.db3074","type":"inject","z":"d1f48851.ea8a08","name":"TEST - CLOSE GARAGE","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"entity_id\":\"cover.garage_door\",\"old_state\":{\"state\":\"closing\"},\"new_state\":{\"state\":\"closed\"}}","payloadType":"json","x":150,"y":420,"wires":[["62eb2629.ef5988"]]},{"id":"f003a50a.dc85f8","type":"comment","z":"d1f48851.ea8a08","name":"--TRIGGERS--","info":"","x":420,"y":260,"wires":[]},{"id":"83ff35d8.8098b8","type":"comment","z":"d1f48851.ea8a08","name":"--NOTIFICATIONS--","info":"","x":1530,"y":280,"wires":[]},{"id":"70273380.5c55dc","type":"comment","z":"d1f48851.ea8a08","name":"--NOTIFICATION ACTIONS--","info":"","x":280,"y":980,"wires":[]},{"id":"26cfdfdd.934ac","type":"switch","z":"d1f48851.ea8a08","name":"Close Garage Snooze","property":"payload.event.action","propertyType":"msg","rules":[{"t":"eq","v":"notify_action_close_garage_snooze","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":640,"y":1140,"wires":[["de04cad8.d4e5c8"]]},{"id":"de04cad8.d4e5c8","type":"trigger","z":"d1f48851.ea8a08","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"1","extend":false,"units":"hr","reset":"","bytopic":"all","outputs":1,"x":870,"y":1140,"wires":[["837ea70.bd8d858"]]},{"id":"837ea70.bd8d858","type":"api-current-state","z":"d1f48851.ea8a08","name":"Garage Open?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"open","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"cover.garage_door","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1060,"y":1140,"wires":[["74303e34.7e993"],[]]},{"id":"74303e34.7e993","type":"link out","z":"d1f48851.ea8a08","name":"","links":["a5c9ca97.4a1be8"],"x":1195,"y":1140,"wires":[]},{"id":"812d89ab.773bc8","type":"link in","z":"d1f48851.ea8a08","name":"","links":["35344c4.61c03b4"],"x":595,"y":1200,"wires":[["27c93f5c.5d22e"]]},{"id":"27c93f5c.5d22e","type":"change","z":"d1f48851.ea8a08","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":1200,"wires":[["de04cad8.d4e5c8"]]},{"id":"d814d531.1255c8","type":"change","z":"f7e7a8ac.19a538","name":"reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":60,"wires":[["8928f1f3.842a"]]},{"id":"f5fa066f.2366b8","type":"api-call-service","z":"f7e7a8ac.19a538","name":"Laundry Room Lights Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_off","entityId":"group.laundry_room_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1590,"y":60,"wires":[[]]},{"id":"1309328b.55f15d","type":"ha-wait-until","z":"f7e7a8ac.19a538","name":"Wait for No Motion","server":"a86c4410.e2a568","outputs":1,"entityId":"binary_sensor.hue_103_motion","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":0,"timeoutType":"num","timeoutUnits":"seconds","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":1230,"y":100,"wires":[["8928f1f3.842a"]]},{"id":"c1c8621b.2fb1e","type":"switch","z":"c6727c1e.1d54f","name":"Event","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"tapSwitchPressI","vt":"flow"},{"t":"eq","v":"tapSwitchPressII","vt":"flow"},{"t":"eq","v":"tapSwitchPressIII","vt":"flow"},{"t":"eq","v":"tapSwitchPressIV","vt":"flow"}],"checkall":"true","repair":false,"outputs":4,"x":1070,"y":1920,"wires":[["fbdde8c4.58faa8"],["6f191a67.1ddc04"],["9ddcbf6b.417fb"],["a90745c6.d5fcd8"]]},{"id":"8847040c.233cd8","type":"api-call-service","z":"d1f48851.ea8a08","name":"Notify Andrew - Catio","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"title\":\"Catio Left Open\",\"message\":\"Don't forget to close the catio!\",\"data\":{\"actions\":[{\"action\":\"notify_action_close_catio_snooze\",\"title\":\"Snooze 1hr\"}],\"tag\":\"notify_close_catio\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1540,"y":480,"wires":[[]]},{"id":"f1dce928.8d2238","type":"switch","z":"d1f48851.ea8a08","name":"Close Catio Snooze","property":"payload.event.action","propertyType":"msg","rules":[{"t":"eq","v":"notify_action_close_catio_snooze","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":640,"y":1280,"wires":[["b57cae1d.8e2fb"]]},{"id":"b57cae1d.8e2fb","type":"trigger","z":"d1f48851.ea8a08","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"1","extend":false,"units":"hr","reset":"","bytopic":"all","outputs":1,"x":870,"y":1280,"wires":[["85aa99c4.1193c8"]]},{"id":"85aa99c4.1193c8","type":"api-current-state","z":"d1f48851.ea8a08","name":"Catio Open?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.catio_door_sensor","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1050,"y":1280,"wires":[["d9fa1f1b.d29b8"],[]]},{"id":"a8a6e08c.f44c6","type":"link in","z":"d1f48851.ea8a08","name":"","links":["d9fa1f1b.d29b8","273513e7.a6ca9c"],"x":1375,"y":480,"wires":[["8847040c.233cd8"]]},{"id":"d9fa1f1b.d29b8","type":"link out","z":"d1f48851.ea8a08","name":"","links":["a8a6e08c.f44c6","72fe1827.24d8b8","df34f038.6410d"],"x":1180,"y":1280,"wires":[]},{"id":"f207ed69.aef8","type":"trigger-state","z":"d1f48851.ea8a08","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.back_office_windows","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":530,"y":500,"wires":[["c3210f61.2fddc"],["91bfa7ec.3f0028","6a20862c.8ff338"]]},{"id":"91bfa7ec.3f0028","type":"link out","z":"d1f48851.ea8a08","name":"","links":["d8f8d393.e4651","1fe29f88.4f0b8","b18d41cc.d7839","1f6e654f.49eb9b"],"x":755,"y":560,"wires":[]},{"id":"63360d40.6b3794","type":"api-call-service","z":"d1f48851.ea8a08","name":"Dismiss Andrew - Catio","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"message\":\"clear_notification\",\"data\":{\"tag\":\"notify_close_catio\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1550,"y":540,"wires":[[]]},{"id":"d8f8d393.e4651","type":"link in","z":"d1f48851.ea8a08","name":"","links":["91bfa7ec.3f0028"],"x":1375,"y":540,"wires":[["63360d40.6b3794"]]},{"id":"e234170b.377878","type":"inject","z":"d1f48851.ea8a08","name":"TEST - OPEN CATIO","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"entity_id\":\"binary_sensor.catio_door_sensor\",\"old_state\":{\"state\":\"off\"},\"new_state\":{\"state\":\"on\"}}","payloadType":"json","x":140,"y":480,"wires":[["f207ed69.aef8"]]},{"id":"9dff62b6.0c4ee","type":"inject","z":"d1f48851.ea8a08","name":"TEST - CLOSE CATIO","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"entity_id\":\"binary_sensor.catio_door_sensor\",\"old_state\":{\"state\":\"on\"},\"new_state\":{\"state\":\"off\"}}","payloadType":"json","x":140,"y":520,"wires":[["f207ed69.aef8"]]},{"id":"c3210f61.2fddc","type":"trigger","z":"d1f48851.ea8a08","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"1","extend":false,"units":"hr","reset":"","bytopic":"all","outputs":1,"x":970,"y":480,"wires":[["273513e7.a6ca9c"]]},{"id":"6a20862c.8ff338","type":"change","z":"d1f48851.ea8a08","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":520,"wires":[["c3210f61.2fddc"]]},{"id":"273513e7.a6ca9c","type":"link out","z":"d1f48851.ea8a08","name":"","links":["a8a6e08c.f44c6","72fe1827.24d8b8","df34f038.6410d"],"x":1075,"y":480,"wires":[]},{"id":"1fe29f88.4f0b8","type":"link in","z":"d1f48851.ea8a08","name":"","links":["35344c4.61c03b4","91bfa7ec.3f0028"],"x":595,"y":1340,"wires":[["12510855.fadfa8"]]},{"id":"12510855.fadfa8","type":"change","z":"d1f48851.ea8a08","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":1340,"wires":[["b57cae1d.8e2fb"]]},{"id":"fdb9eb17.902f78","type":"trigger-state","z":"d1f48851.ea8a08","name":"Every hour","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"sensor.time","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"tea2ba72fl","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"re","comparatorValue":"\\d\\d:\\b00\\b"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":410,"y":620,"wires":[["10ef751c.d42c0b"],[]]},{"id":"e7f31cd8.62323","type":"inject","z":"d1f48851.ea8a08","name":"TEST - 12PM","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"entity_id\":\"sensor.time\",\"old_state\":{\"state\":\"11:59\"},\"new_state\":{\"state\":\"12:00\"}}","payloadType":"json","x":170,"y":620,"wires":[["fdb9eb17.902f78"]]},{"id":"c8709b18.eba7e8","type":"counter","z":"d1f48851.ea8a08","name":"","init":"0","step":"1","lower":"0","upper":"2","mode":"increment","outputs":"1","x":960,"y":620,"wires":[["d49c4e3.81418b","2577d0d4.b9cb9"]]},{"id":"a5d0317a.433e2","type":"change","z":"d1f48851.ea8a08","name":"","rules":[{"t":"set","p":"decrement","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":700,"wires":[["c8709b18.eba7e8"]]},{"id":"d49c4e3.81418b","type":"switch","z":"d1f48851.ea8a08","name":"","property":"countUpperLimitReached","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1090,"y":620,"wires":[["6e56a528.4405dc"]]},{"id":"616fde4d.d8f4a","type":"api-call-service","z":"d1f48851.ea8a08","name":"Notify Andrew - Backyard Lights Unavailable","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"title\":\"Lights Unavailable\",\"message\":\"Back yard lights not available. Recommend power cycling the lights, then restarting HA.\",\"data\":{\"actions\":[{\"action\":\"notify_action_back_yard_lights_unavail_restart_ha\",\"title\":\"Restart HA Now\"}],\"tag\":\"notify_back_yard_lights_unavail\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1610,"y":620,"wires":[[]]},{"id":"2537fa6e.2733a6","type":"api-call-service","z":"d1f48851.ea8a08","name":"Dismiss Andrew - Back Yard Lights Unavailable","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"message\":\"clear_notification\",\"data\":{\"tag\":\"notify_back_yard_lights_unavail\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1620,"y":680,"wires":[[]]},{"id":"c62a7254.37995","type":"switch","z":"d1f48851.ea8a08","name":"Back Yard Lights Unavailable Restart HA","property":"payload.event.action","propertyType":"msg","rules":[{"t":"eq","v":"notify_action_back_yard_lights_unavail_restart_ha","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":700,"y":1440,"wires":[["cbf9be91.d5a73","4100b6fa.7b8a88"]]},{"id":"6800b30a.eecb6c","type":"api-call-service","z":"d1f48851.ea8a08","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"restart","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1210,"y":1440,"wires":[[]]},{"id":"cbf9be91.d5a73","type":"delay","z":"d1f48851.ea8a08","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1000,"y":1440,"wires":[["6800b30a.eecb6c"]]},{"id":"4100b6fa.7b8a88","type":"link out","z":"d1f48851.ea8a08","name":"","links":["4f7a21d.3bdf8e"],"x":955,"y":1400,"wires":[]},{"id":"4f7a21d.3bdf8e","type":"link in","z":"d1f48851.ea8a08","name":"","links":["4100b6fa.7b8a88","3dc33f72.9de34"],"x":715,"y":740,"wires":[["18546706.fa71d9"]]},{"id":"9faaebb5.1c1068","type":"inject","z":"d1f48851.ea8a08","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":820,"y":1400,"wires":[["4100b6fa.7b8a88"]]},{"id":"18546706.fa71d9","type":"change","z":"d1f48851.ea8a08","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":740,"wires":[["6e56a528.4405dc"]]},{"id":"2577d0d4.b9cb9","type":"switch","z":"d1f48851.ea8a08","name":"","property":"countLowerLimitReached","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":560,"wires":[["3dc33f72.9de34"]]},{"id":"3dc33f72.9de34","type":"link out","z":"d1f48851.ea8a08","name":"","links":["4f7a21d.3bdf8e"],"x":1155,"y":560,"wires":[]},{"id":"ed27e170.4804a","type":"api-current-state","z":"1b9a9b6a.3dd0f5","name":"Get Turned On Lights","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"{{ payload }}","state_type":"str","state_location":"state","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":900,"y":480,"wires":[["201fa521.4232ea"],[]]},{"id":"620484c9.21a11c","type":"split","z":"1b9a9b6a.3dd0f5","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":710,"y":480,"wires":[["ed27e170.4804a"]]},{"id":"a45f3a57.53d188","type":"api-current-state","z":"1b9a9b6a.3dd0f5","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.man_cave_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":250,"y":480,"wires":[["a77016c2.b02698"]]},{"id":"a77016c2.b02698","type":"change","z":"1b9a9b6a.3dd0f5","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"data.attributes.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":480,"wires":[["620484c9.21a11c"]]},{"id":"391bf675.309aba","type":"api-call-service","z":"1b9a9b6a.3dd0f5","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1250,"y":480,"wires":[["8935222f.33e62"]]},{"id":"8935222f.33e62","type":"join","z":"1b9a9b6a.3dd0f5","name":"","mode":"custom","build":"array","property":"data.entity_id","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1430,"y":480,"wires":[[]]},{"id":"201fa521.4232ea","type":"function","z":"1b9a9b6a.3dd0f5","name":"","func":"var hue = Math.floor(Math.random() * 361);\nvar saturation = 80 + Math.floor(Math.random() * 21);\n\nmsg.hue = hue;\nmsg.saturation = saturation;\n\nflow.set(\"service_data\", {\n    \"entity_id\": msg.data.entity_id,\n    \"hs_color\": [hue, saturation]\n});\n\nmsg.payload = {\n    \"domain\": \"light\",\n    \"service\": \"turn_on\",\n    \"data\": {\n        \"entity_id\": msg.data.entity_id,\n        \"hs_color\": [hue, saturation],\n        \"transition\": 10\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1070,"y":480,"wires":[["391bf675.309aba"]]},{"id":"328ea738.165a98","type":"trigger","z":"1b9a9b6a.3dd0f5","name":"","op1":"","op2":"0","op1type":"str","op2type":"str","duration":"-10000","extend":false,"units":"ms","reset":"","bytopic":"all","outputs":1,"x":680,"y":180,"wires":[["a45f3a57.53d188"]]},{"id":"5c56969e.32e4f8","type":"change","z":"1b9a9b6a.3dd0f5","name":"reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":240,"wires":[["328ea738.165a98"]]},{"id":"e0f6891c.7c2908","type":"server-state-changed","z":"1b9a9b6a.3dd0f5","name":"","server":"a86c4410.e2a568","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.man_cave_shuffler","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":220,"y":180,"wires":[["328ea738.165a98","e1ebb8ba.b606e8"],["5c56969e.32e4f8"]]},{"id":"e1ebb8ba.b606e8","type":"api-call-service","z":"1b9a9b6a.3dd0f5","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.man_cave_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":700,"y":120,"wires":[[]]},{"id":"6c0f7e74.7cdd","type":"change","z":"4d34c979.7acd48","name":"man_cave_strips_are_fluxed := false","rules":[{"t":"set","p":"man_cave_strips_are_fluxed","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":1180,"wires":[[]]},{"id":"e231d620.c67d68","type":"change","z":"4d34c979.7acd48","name":"man_cave_strips_are_fluxed := true","rules":[{"t":"set","p":"man_cave_strips_are_fluxed","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1460,"y":1180,"wires":[[]]},{"id":"30c7697e.c244a6","type":"trigger-state","z":"4d34c979.7acd48","name":"Man-cave Lights On","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"light.man_cave_lights","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"hj4iazjncr","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"sg3tblo1wf","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":440,"y":1240,"wires":[["c40a202e.35e1e"],[]]},{"id":"c40a202e.35e1e","type":"api-current-state","z":"4d34c979.7acd48","name":"Man-cave Fluxer Is On/Off","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.man_cave_fluxer","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":800,"y":1100,"wires":[["1518b344.25f9cd"],["6c0f7e74.7cdd"]]},{"id":"80bf06e9.63acc8","type":"api-current-state","z":"4d34c979.7acd48","name":"Man Cave Lights Are On","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.man_cave_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":430,"y":1120,"wires":[["c40a202e.35e1e"],["6c0f7e74.7cdd"]]},{"id":"77a6c866.aff2e8","type":"trigger-state","z":"4d34c979.7acd48","name":"Man-cave Lights Off","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"light.man_cave_lights","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"2rk3lvyp7l2","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":440,"y":1360,"wires":[["6c0f7e74.7cdd"],[]]},{"id":"9beb52da.49e43","type":"trigger-state","z":"4d34c979.7acd48","name":"Man-cave Fluxer Switch On","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_boolean.man_cave_fluxer","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"82p99vyoycj","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"yzhrxpc961p","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":420,"y":1180,"wires":[["c40a202e.35e1e","97dddc7f.5d777"],[]]},{"id":"e82e0208.dfaf6","type":"trigger-state","z":"4d34c979.7acd48","name":"Man-cave Fluxer Switch Off","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_boolean.man_cave_fluxer","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"oh4eijwt2jq","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"9r55ag39yns","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":420,"y":1300,"wires":[["6c0f7e74.7cdd"],[]]},{"id":"5cab625f.7f6b3c","type":"link in","z":"4d34c979.7acd48","name":"Auto Updater","links":["563153d7.8339fc"],"x":55,"y":1120,"wires":[["80bf06e9.63acc8"]]},{"id":"1518b344.25f9cd","type":"function","z":"4d34c979.7acd48","name":"Svc Data","func":"msg.payload = {\n    \"group_id\": \"group.man_cave_lights\",\n    \"service_data\": {\n        \"kelvin\": flow.get(\"circadian_kelvin\"),\n        \"transition\": 1,\n        \"brightness\": flow.get(\"circadian_brightness\")\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":1100,"wires":[["bdbf91e8.5b08c"]]},{"id":"bdbf91e8.5b08c","type":"subflow:334bdfca.304fb","z":"4d34c979.7acd48","name":"","env":[],"x":1310,"y":1100,"wires":[["e231d620.c67d68"]]},{"id":"97dddc7f.5d777","type":"api-call-service","z":"4d34c979.7acd48","name":"Turn off Man-cave Shuffler","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.man_cave_shuffler","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":800,"y":1040,"wires":[[]]},{"id":"ce79c75e.65aa28","type":"api-call-service","z":"c6727c1e.1d54f","name":"Shuffle Ledge","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.great_room_shuffler","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1880,"y":2060,"wires":[[]]},{"id":"a90745c6.d5fcd8","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn off Ledge Fluxer","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1340,"y":2140,"wires":[["484d9c52.37b804"]]},{"id":"484d9c52.37b804","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn off Ledge Shuffler","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.great_room_shuffler","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1580,"y":2140,"wires":[["ce1c0e1c.c6edc","649866ea.c5fe08"]]},{"id":"dc85a347.21793","type":"api-current-state","z":"c6727c1e.1d54f","name":"Ledge Lights On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.ledge_strips","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":2050,"y":1900,"wires":[["a371e5a8.ff09e8"],["b3fb6c5e.fb9f8"]]},{"id":"a371e5a8.ff09e8","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn off Ledge Strips","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.living_room_strips_deconz","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2350,"y":1880,"wires":[[]]},{"id":"b3fb6c5e.fb9f8","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn On Ledge Strips","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ledge_strips_deconz","data":"{\"brightness\":255,\"kelvin\":3200}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2370,"y":1960,"wires":[[]]},{"id":"4a565d13.dba8f4","type":"trigger-state","z":"d1f48851.ea8a08","name":"Pi Hole 101 Not Reachable","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.pi_hole_reachable","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"7mvcdbsbjus","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":440,"y":800,"wires":[["a39d51db.96913"],["57466175.0f32f"]]},{"id":"1d4c362a.1ddb5a","type":"api-call-service","z":"d1f48851.ea8a08","name":"Notify Andrew - Pi Hole Unavailable","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"title\":\"Pi-hole Not Reachable\",\"message\":\"Pi-hole is down! Web browsing may be interrupted.\",\"data\":{\"tag\":\"notify_pi_hole_not_reachable\",\"image\":\"/local/images/notification_icons/pihole_logo.png\",\"icon\":\"mdi:pi-hole\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1580,"y":740,"wires":[[]]},{"id":"676e6445.cc33cc","type":"api-call-service","z":"d1f48851.ea8a08","name":"Dismiss Andrew - Pi Hole Not Reachable","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"message\":\"clear_notification\",\"data\":{\"tag\":\"notify_pi_hole_not_reachable\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1600,"y":800,"wires":[[]]},{"id":"a39d51db.96913","type":"link out","z":"d1f48851.ea8a08","name":"","links":["a4f9d45.00ef428"],"x":635,"y":780,"wires":[]},{"id":"57466175.0f32f","type":"link out","z":"d1f48851.ea8a08","name":"","links":["a122a8f.53ba158"],"x":635,"y":820,"wires":[]},{"id":"a4f9d45.00ef428","type":"link in","z":"d1f48851.ea8a08","name":"","links":["a39d51db.96913"],"x":1375,"y":740,"wires":[["1d4c362a.1ddb5a"]]},{"id":"a122a8f.53ba158","type":"link in","z":"d1f48851.ea8a08","name":"","links":["57466175.0f32f"],"x":1375,"y":800,"wires":[["676e6445.cc33cc"]]},{"id":"6e56a528.4405dc","type":"trigger","z":"d1f48851.ea8a08","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1240,"y":620,"wires":[["616fde4d.d8f4a"]]},{"id":"82f4950b.5bca28","type":"trigger-state","z":"dbd2ebf4.b8f648","name":"Kaitlyn Leaves Home","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"person.kaitlyn","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"bpds1d58fb","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"},{"id":"zzcbltq1w5","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"home"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":180,"y":420,"wires":[["1d82b54d.cc589b"],[]]},{"id":"f9c13132.596af","type":"switch","z":"dbd2ebf4.b8f648","name":"[home]","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":870,"y":420,"wires":[["b620c805.171418","f16998de.ecf6a8","af64a0d7.be026","232bb4d0.c4817c"]]},{"id":"b620c805.171418","type":"api-call-service","z":"dbd2ebf4.b8f648","name":"Set Climate Mode","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"set_climate_kaitlyn_away_mode","entityId":"","data":"{\"preset_mode\":\"Kaitlyn Away\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1150,"y":420,"wires":[[]]},{"id":"1d82b54d.cc589b","type":"delay","z":"dbd2ebf4.b8f648","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":540,"y":420,"wires":[["a69145d9.7dd0e8"]]},{"id":"20a5cf6.bb5d23","type":"trigger-state","z":"dbd2ebf4.b8f648","name":"Kaitlyn Arrives Home","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"person.kaitlyn","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"t8jl0i92jjd","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"},{"id":"em5wlma1w2d","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"home"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":180,"y":620,"wires":[["dc90d32d.76a69","4fafe8b8.3f9858","23b73671.5ed63a","842ed01a.96edb","80cabe41.f92be"],[]]},{"id":"dc90d32d.76a69","type":"change","z":"dbd2ebf4.b8f648","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":520,"wires":[["1d82b54d.cc589b"]]},{"id":"f16998de.ecf6a8","type":"api-call-service","z":"dbd2ebf4.b8f648","name":"Turn off lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.ledge_strips, light.kitchen_lights, light.guest_room_lights, light.master_bedroom_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1140,"y":360,"wires":[[]]},{"id":"4fafe8b8.3f9858","type":"api-call-service","z":"dbd2ebf4.b8f648","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"resume_climate_schedule","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":570,"y":720,"wires":[[]]},{"id":"c01ee605.a86a38","type":"trigger-state","z":"f7e7a8ac.19a538","name":"Indoor Motion Sensors","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"group.indoor_motion_sensors","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"27mve08a4lj","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"zw9b2leo11","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":300,"y":420,"wires":[["7945f85c.5abfa8","f5e4b4c2.7f9178"],[]]},{"id":"db5e7c2a.1a7ec","type":"inject","z":"f7e7a8ac.19a538","name":"detected","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"entity_id\":\"group.indoor_motion_sensors\",\"old_state\":{\"state\":\"off\"},\"new_state\":{\"state\":\"on\"}}","payloadType":"json","x":120,"y":400,"wires":[["c01ee605.a86a38"]]},{"id":"5fef9c89.fe26c4","type":"inject","z":"f7e7a8ac.19a538","name":"clear","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"entity_id\":\"group.indoor_motion_sensors\",\"old_state\":{\"state\":\"on\"},\"new_state\":{\"state\":\"off\"}}","payloadType":"json","x":130,"y":440,"wires":[["c01ee605.a86a38"]]},{"id":"7945f85c.5abfa8","type":"switch","z":"f7e7a8ac.19a538","name":"Sleep Mode?","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"sleep","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":380,"wires":[["6b16bd3c.4e7d54"]]},{"id":"6b16bd3c.4e7d54","type":"api-current-state","z":"f7e7a8ac.19a538","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.time","state_type":"str","state_location":"time","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":730,"y":380,"wires":[["5ba9ebab.f14b54"]]},{"id":"d6ebcc65.5a4d2","type":"switch","z":"f7e7a8ac.19a538","name":"msg.hour between 4 and 20","property":"hour","propertyType":"msg","rules":[{"t":"btwn","v":"4","vt":"num","v2":"21","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1140,"y":320,"wires":[["a87fcaba.60d5c8"]]},{"id":"a87fcaba.60d5c8","type":"api-call-service","z":"f7e7a8ac.19a538","name":"Set Home Mode","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.automation_mode","data":"{ \"option\": \"home\" }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1360,"y":320,"wires":[[]]},{"id":"53016360.bb3d8c","type":"api-current-state","z":"1b9a9b6a.3dd0f5","name":"Get Turned On Lights","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"{{ payload }}","state_type":"str","state_location":"state","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":900,"y":940,"wires":[["183cb79c.ee3888"],[]]},{"id":"77c99c5b.614ac4","type":"split","z":"1b9a9b6a.3dd0f5","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":710,"y":940,"wires":[["53016360.bb3d8c"]]},{"id":"8eb9db55.53b248","type":"api-current-state","z":"1b9a9b6a.3dd0f5","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.all_living_room_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":260,"y":940,"wires":[["244d19bb.55f736"]]},{"id":"244d19bb.55f736","type":"change","z":"1b9a9b6a.3dd0f5","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"data.attributes.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":940,"wires":[["77c99c5b.614ac4"]]},{"id":"5b86c7e3.891a28","type":"api-call-service","z":"1b9a9b6a.3dd0f5","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1250,"y":940,"wires":[["8db921e5.57c77"]]},{"id":"8db921e5.57c77","type":"join","z":"1b9a9b6a.3dd0f5","name":"","mode":"custom","build":"array","property":"data.entity_id","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1430,"y":940,"wires":[[]]},{"id":"183cb79c.ee3888","type":"function","z":"1b9a9b6a.3dd0f5","name":"","func":"var hue = Math.floor(Math.random() * 361);\nvar saturation = 80 + Math.floor(Math.random() * 21);\n\nmsg.hue = hue;\nmsg.saturation = saturation;\n\nflow.set(\"service_data\", {\n    \"entity_id\": msg.data.entity_id,\n    \"hs_color\": [hue, saturation]\n});\n\nmsg.payload = {\n    \"domain\": \"light\",\n    \"service\": \"turn_on\",\n    \"data\": {\n        \"entity_id\": msg.data.entity_id,\n        \"hs_color\": [hue, saturation],\n        \"transition\": 30\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":940,"wires":[["5b86c7e3.891a28"]]},{"id":"46f6dfa7.9f0f5","type":"trigger","z":"1b9a9b6a.3dd0f5","name":"","op1":"","op2":"0","op1type":"str","op2type":"str","duration":"-5","extend":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":670,"y":640,"wires":[["8eb9db55.53b248"]]},{"id":"1272f69a.5ef0a9","type":"change","z":"1b9a9b6a.3dd0f5","name":"reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":700,"wires":[["46f6dfa7.9f0f5"]]},{"id":"c62f7125.90b54","type":"server-state-changed","z":"1b9a9b6a.3dd0f5","name":"","server":"a86c4410.e2a568","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.great_room_shuffler","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":230,"y":640,"wires":[["46f6dfa7.9f0f5","b95d68da.47ad88"],["1272f69a.5ef0a9"]]},{"id":"b95d68da.47ad88","type":"api-call-service","z":"1b9a9b6a.3dd0f5","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":700,"y":580,"wires":[[]]},{"id":"3bd1eb01.d5eec4","type":"ha-wait-until","z":"f7e7a8ac.19a538","name":"Wait for Motion Clear","server":"a86c4410.e2a568","outputs":1,"entityId":"group.indoor_motion_sensors","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":0,"timeoutType":"num","timeoutUnits":"seconds","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":1960,"y":380,"wires":[["bf934ed0.e3606"]]},{"id":"5ba9ebab.f14b54","type":"api-current-state","z":"f7e7a8ac.19a538","name":"Ledge Strips Off?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.ledge_strips","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1490,"y":380,"wires":[["e1af110c.053ec","3bd1eb01.d5eec4"],[]]},{"id":"bf934ed0.e3606","type":"delay","z":"f7e7a8ac.19a538","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2160,"y":380,"wires":[["fa2f7829.77f538"]]},{"id":"61f493cb.9192ec","type":"change","z":"f7e7a8ac.19a538","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":460,"wires":[["bf934ed0.e3606"]]},{"id":"dcebc7c4.b7c478","type":"api-call-service","z":"f7e7a8ac.19a538","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.ledge_strips","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2490,"y":380,"wires":[[]]},{"id":"f5e4b4c2.7f9178","type":"switch","z":"f7e7a8ac.19a538","name":"Sleep Mode?","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"sleep","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1750,"y":460,"wires":[["61f493cb.9192ec","3bd1eb01.d5eec4"]]},{"id":"4ee33966.4fc018","type":"trigger-state","z":"a5e69210.f37a9","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_select.automation_mode","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","x":190,"y":360,"wires":[["f6ca1b2c.4ecc08"],[]]},{"id":"f6ca1b2c.4ecc08","type":"change","z":"a5e69210.f37a9","name":"","rules":[{"t":"set","p":"automation_mode","pt":"global","to":"payload","tot":"msg"},{"t":"set","p":"automation_mode_prev","pt":"global","to":"data.event.old_state.state","tot":"msg"},{"t":"set","p":"automation_mode","pt":"flow","to":"payload","tot":"msg"},{"t":"set","p":"automation_mode_prev","pt":"flow","to":"data.event.old_state.state","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":360,"wires":[["f9d40f88.23d32","59ced8a4.fa6298","55a5682a.b3e308"]]},{"id":"f9d40f88.23d32","type":"switch","z":"a5e69210.f37a9","name":"New State == home","property":"automation_mode","propertyType":"flow","rules":[{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":360,"wires":[["57ed5a60.4b44f4","cc8a09f4.6f02f8","73d9a904.346e38"]]},{"id":"57ed5a60.4b44f4","type":"switch","z":"a5e69210.f37a9","name":"Previous State == sleep","property":"automation_mode_prev","propertyType":"flow","rules":[{"t":"eq","v":"sleep","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1010,"y":360,"wires":[["f7b5b8ac.a012d8","59038815.a82ea8","da9305f4.d776a8","32902140.62b29e","8a57290e.31b138","80ea63a5.b7559"]]},{"id":"59ced8a4.fa6298","type":"switch","z":"a5e69210.f37a9","name":"New State = away","property":"automation_mode","propertyType":"flow","rules":[{"t":"eq","v":"away","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":730,"y":820,"wires":[["2feef303.bbde4c","43154470.03f4ac","859ffe76.5bcf2","d08074ba.950c08","266ca4d3.d55f7c"]]},{"id":"2feef303.bbde4c","type":"api-call-service","z":"a5e69210.f37a9","name":"House Scene","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.house_scene_away","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":960,"y":640,"wires":[[]]},{"id":"43154470.03f4ac","type":"api-call-service","z":"a5e69210.f37a9","name":"Turn On Air Purifier","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"turn_on_air_purifier","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":880,"wires":[[]]},{"id":"859ffe76.5bcf2","type":"api-call-service","z":"a5e69210.f37a9","name":"Climate Away Mode","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"set_climate_away_mode","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":760,"wires":[[]]},{"id":"d08074ba.950c08","type":"api-current-state","z":"a5e69210.f37a9","name":"Sun below horizon?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"below_horizon","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sun.sun","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":970,"y":700,"wires":[["1f93db92.555774"],[]]},{"id":"cc8a09f4.6f02f8","type":"switch","z":"a5e69210.f37a9","name":"Previous State == away","property":"automation_mode_prev","propertyType":"flow","rules":[{"t":"eq","v":"away","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":440,"wires":[["fb0dd8fd.0e7008","e67d7695.0e1238","8784c199.6ad7f","a3e251bf.ff4f2"]]},{"id":"468a5f5.229c2a","type":"api-render-template","z":"bd7887b2.0cf798","name":"Living Room Dark? or Kitchen Dark? (True/False)","server":"a86c4410.e2a568","template":"{{ state_attr('sensor.hue_104_lux', 'dark') or state_attr('sensor.hue_100_lux', 'dark') }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":310,"y":100,"wires":[["316cd1e0.1e23ee"]]},{"id":"316cd1e0.1e23ee","type":"switch","z":"bd7887b2.0cf798","name":"True?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":100,"wires":[["9e0f3dee.1f2b6"],["5e9092f0.64e8fc"]]},{"id":"9e0f3dee.1f2b6","type":"change","z":"bd7887b2.0cf798","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":40,"wires":[["ea1b0561.e8d7a8"]]},{"id":"5e9092f0.64e8fc","type":"change","z":"bd7887b2.0cf798","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":160,"wires":[["ea1b0561.e8d7a8"]]},{"id":"fb0dd8fd.0e7008","type":"subflow:bd7887b2.0cf798","z":"a5e69210.f37a9","name":"","env":[],"x":1340,"y":440,"wires":[["938b3ab2.eab838"],[]]},{"id":"ea1b0561.e8d7a8","type":"moment","z":"bd7887b2.0cf798","name":"","topic":"","input":"","inputType":"date","inTz":"America/Chicago","adjAmount":0,"adjType":"days","adjDir":"add","format":"MMM DD, HH:mm","locale":"C","output":"timestamp","outputType":"msg","outTz":"America/Chicago","x":980,"y":100,"wires":[["4a48c0f0.5e053"]]},{"id":"4a48c0f0.5e053","type":"function","z":"bd7887b2.0cf798","name":"","func":"msg.payload = msg.payload + ' at ' + msg.timestamp;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":100,"wires":[[]]},{"id":"938b3ab2.eab838","type":"api-call-service","z":"a5e69210.f37a9","name":"Turn on indoor lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.house_scene_warm_welcome","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1560,"y":440,"wires":[[]]},{"id":"e67d7695.0e1238","type":"api-call-service","z":"a5e69210.f37a9","name":"Turn Off Air Purifier","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"turn_off_air_purifier","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1350,"y":560,"wires":[[]]},{"id":"8784c199.6ad7f","type":"api-call-service","z":"a5e69210.f37a9","name":"Set A/C to Home","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"resume_climate_schedule","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1350,"y":620,"wires":[["e17cbe62.cebda"]]},{"id":"a3e251bf.ff4f2","type":"api-current-state","z":"a5e69210.f37a9","name":"After Sunset?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"below_horizon","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sun.sun","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1340,"y":500,"wires":[["ec9b2b35.5798c8"],[]]},{"id":"e17cbe62.cebda","type":"delay","z":"a5e69210.f37a9","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1680,"y":620,"wires":[["1ca95420.96360c"]]},{"id":"1ca95420.96360c","type":"api-render-template","z":"a5e69210.f37a9","name":"Kaitlyn == Away and Climate Preset == Home?","server":"a86c4410.e2a568","template":"{{ states('person.kaitlyn') == 'not_home' and state_attr('climate.thermostat', 'preset_mode') == 'Home' }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":1940,"y":620,"wires":[["9e24e650.51c238"]]},{"id":"9e24e650.51c238","type":"switch","z":"a5e69210.f37a9","name":"True?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2190,"y":620,"wires":[["670a6b63.c2b7f4"]]},{"id":"670a6b63.c2b7f4","type":"api-call-service","z":"a5e69210.f37a9","name":"Set Climate Mode","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"climate","service":"set_preset_mode","entityId":"climate.thermostat","data":"{\"preset_mode\":\"Kaitlyn Away\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2350,"y":620,"wires":[[]]},{"id":"67e85155.6ad8c","type":"change","z":"c3c8a381.c1927","name":"NOOP","rules":[],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":160,"wires":[["ff59c515.6b4888","d5a4bceb.bd591","d8664183.3795c","76e1a905.a7ed98","de461db0.a14ff","3f6b787b.1dcc68"]]},{"id":"8928f1f3.842a","type":"delay","z":"f7e7a8ac.19a538","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1400,"y":60,"wires":[["f5fa066f.2366b8"]]},{"id":"55a5682a.b3e308","type":"switch","z":"a5e69210.f37a9","name":"New State = sleep","property":"automation_mode","propertyType":"flow","rules":[{"t":"eq","v":"sleep","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":730,"y":1200,"wires":[["8345aa59.7abf08","65adfac0.482614","29d77a27.8e2346","dd415a3e.5bfaa8","8270c3ee.a4db","a850ce29.1ecbb","2da987f2.586298"]]},{"id":"8345aa59.7abf08","type":"api-call-service","z":"a5e69210.f37a9","name":"Turn On Air Purifier","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"turn_on_air_purifier","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":1080,"wires":[[]]},{"id":"65adfac0.482614","type":"api-call-service","z":"a5e69210.f37a9","name":"Lights Script","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"lighting_scene_sleep_mode","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":950,"y":1140,"wires":[[]]},{"id":"29d77a27.8e2346","type":"api-call-service","z":"a5e69210.f37a9","name":"Turn Off Media Players","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"turn_off_media_players","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":980,"y":1200,"wires":[[]]},{"id":"dd415a3e.5bfaa8","type":"api-call-service","z":"a5e69210.f37a9","d":true,"name":"Lock Doors","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"lock_doors","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":950,"y":1260,"wires":[[]]},{"id":"8270c3ee.a4db","type":"api-current-state","z":"a5e69210.f37a9","name":"A/C on cool mode?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"cool","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"climate.thermostat","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":970,"y":1320,"wires":[["e0a5222f.f5e2d"],[]]},{"id":"e0a5222f.f5e2d","type":"api-call-service","z":"a5e69210.f37a9","name":"Turn on Bedroom Fan","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.master_bedroom_fan","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1230,"y":1320,"wires":[[]]},{"id":"f7b5b8ac.a012d8","type":"api-call-service","z":"a5e69210.f37a9","name":"Turn off bedroom fan","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.master_bedroom_fan","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1360,"y":320,"wires":[[]]},{"id":"89c7e772.7cd058","type":"trigger-state","z":"f7e7a8ac.19a538","name":"Man Cave Motion Sensor","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.hue_101_motion","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"ne26ukex9tr","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":310,"y":600,"wires":[["41627fa1.d7e1","9951145c.b66c08"],["c4540f2b.b52fe"]]},{"id":"c4540f2b.b52fe","type":"delay","z":"f7e7a8ac.19a538","name":"","pauseType":"delay","timeout":"90","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":650,"y":760,"wires":[["6c71659c.bf924c","1c3a560e.8f840a","6fc2c76d.67b6c8"]]},{"id":"41627fa1.d7e1","type":"change","z":"f7e7a8ac.19a538","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":660,"wires":[["c4540f2b.b52fe"]]},{"id":"6c71659c.bf924c","type":"api-call-service","z":"f7e7a8ac.19a538","name":"Man Cave Lights Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.man_cave_scene_off","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1000,"y":760,"wires":[[]]},{"id":"247d4339.1b89ac","type":"change","z":"c6727c1e.1d54f","name":"","rules":[{"t":"set","p":"group_id","pt":"flow","to":"group.guest_room_lights","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":1360,"wires":[["d901615b.f7a23"]]},{"id":"d901615b.f7a23","type":"switch","z":"c6727c1e.1d54f","name":"Event","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"dimmerSwitchOnPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchOnHoldEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessUpPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessUpHoldEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessDownPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchBrightnessDownHoldEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchOffPressEvent","vt":"flow"},{"t":"eq","v":"dimmerSwitchOffHoldEvent","vt":"flow"}],"checkall":"true","repair":false,"outputs":8,"x":1270,"y":1360,"wires":[["13aee46f.728cac"],[],["9cf631bd.dc19e"],["6d38bb2b.1889c4"],["66f41e8e.fbb03"],["95783ded.62a8b"],["3ebdb307.e0ac4c"],["3ebdb307.e0ac4c"]]},{"id":"9cf631bd.dc19e","type":"change","z":"c6727c1e.1d54f","name":"","rules":[{"t":"set","p":"group_id","pt":"msg","to":"group_id","tot":"flow"},{"t":"set","p":"light_id","pt":"msg","to":"light.guest_room_lights","tot":"str"},{"t":"set","p":"brightness_interval","pt":"msg","to":"50","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1480,"y":1320,"wires":[["c764b9a7.341c18"]]},{"id":"c764b9a7.341c18","type":"subflow:3b8908a.fcea8f8","z":"c6727c1e.1d54f","name":"","x":1730,"y":1320,"wires":[[]]},{"id":"6d38bb2b.1889c4","type":"change","z":"c6727c1e.1d54f","name":"Brightness Max","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group_id\":\"group.guest_room_lights\",\"service_data\":{\"brightness\":255,\"kelvin\":3000}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1480,"y":1380,"wires":[["118bc448.94d15c"]]},{"id":"118bc448.94d15c","type":"subflow:334bdfca.304fb","z":"c6727c1e.1d54f","name":"","env":[],"x":1690,"y":1380,"wires":[[]]},{"id":"66f41e8e.fbb03","type":"change","z":"c6727c1e.1d54f","name":"","rules":[{"t":"set","p":"group_id","pt":"msg","to":"group_id","tot":"flow"},{"t":"set","p":"light_id","pt":"msg","to":"light.guest_room_lights","tot":"str"},{"t":"set","p":"brightness_interval","pt":"msg","to":"50","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1480,"y":1440,"wires":[["716dc2b9.877aac"]]},{"id":"716dc2b9.877aac","type":"subflow:42ad5100.25527","z":"c6727c1e.1d54f","x":1740,"y":1440,"wires":[[]]},{"id":"95783ded.62a8b","type":"change","z":"c6727c1e.1d54f","name":"Brightness Min","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group_id\":\"group.guest_room_lights\",\"service_data\":{\"brightness\":3}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1480,"y":1500,"wires":[["8fa597da.1e0a38"]]},{"id":"8fa597da.1e0a38","type":"subflow:334bdfca.304fb","z":"c6727c1e.1d54f","name":"","env":[],"x":1690,"y":1500,"wires":[[]]},{"id":"3ebdb307.e0ac4c","type":"api-call-service","z":"c6727c1e.1d54f","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.guest_room_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1490,"y":1560,"wires":[[]]},{"id":"df89ff02.9c083","type":"range","z":"4d34c979.7acd48","minin":"-90","maxin":"90","minout":"127","maxout":"255","action":"clamp","round":true,"property":"payload.kelvin","name":"percent to brightness range","x":740,"y":460,"wires":[["1e1739bf.728646","729fcd15.435ee4"]]},{"id":"1e1739bf.728646","type":"change","z":"4d34c979.7acd48","name":"","rules":[{"t":"set","p":"circadian_brightness","pt":"flow","to":"payload.kelvin","tot":"msg"},{"t":"set","p":"circadian_brightness","pt":"global","to":"payload.kelvin","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":460,"wires":[[]]},{"id":"dfed7d73.6c5a","type":"trigger-state","z":"abbc1f2.48c95e","name":"Chill Mode On/Off","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"switch.chill_mode","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"vpuxluf92f9","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":270,"y":140,"wires":[["ab974a04.bc46a8","8e06128f.b784d","d82cf623.bb5438","7dc0898.b23fe78","6c65800f.523dd","91dd58d8.e9a328","7963588c.891828","165fc92b.c45ab7"],["ab974a04.bc46a8"]]},{"id":"ab974a04.bc46a8","type":"change","z":"abbc1f2.48c95e","name":"","rules":[{"t":"set","p":"chill_mode","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":80,"wires":[[]]},{"id":"8e06128f.b784d","type":"api-call-service","z":"abbc1f2.48c95e","name":"Turn Off Kitchen Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_off","entityId":"group.kitchen_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":520,"y":260,"wires":[[]]},{"id":"7dc0898.b23fe78","type":"api-call-service","z":"abbc1f2.48c95e","name":"Turn off overhead lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.master_bedroom_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":530,"y":380,"wires":[[]]},{"id":"d82cf623.bb5438","type":"api-current-state","z":"abbc1f2.48c95e","name":"Master Bedroom Lamps On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.master_bedroom_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":540,"y":320,"wires":[["4bf2f2ed.8de5fc"],[]]},{"id":"4bf2f2ed.8de5fc","type":"api-call-service","z":"abbc1f2.48c95e","name":"Make lamps warm","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.master_bedroom_lights","data":"{\"kelvin\":2000}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":790,"y":320,"wires":[[]]},{"id":"a850ce29.1ecbb","type":"api-call-service","z":"a5e69210.f37a9","name":"Turn Off Chill Mode","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.chill_mode","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":1380,"wires":[[]]},{"id":"95ea93c9.2e2c3","type":"api-current-state","z":"f7e7a8ac.19a538","name":"Man Cave Lights Off?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.man_cave_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1400,"y":600,"wires":[["f88ae45b.c55498"],[]]},{"id":"f88ae45b.c55498","type":"subflow:1c2e799b.e17e86","z":"f7e7a8ac.19a538","name":"","x":1640,"y":600,"wires":[[]]},{"id":"6c65800f.523dd","type":"api-current-state","z":"abbc1f2.48c95e","name":"Man Cave Lights On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.man_cave_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":520,"y":440,"wires":[["a8e770c3.0b013"],[]]},{"id":"a8e770c3.0b013","type":"subflow:1c2e799b.e17e86","z":"abbc1f2.48c95e","name":"","x":760,"y":440,"wires":[[]]},{"id":"87d58efd.f80f6","type":"trigger-state","z":"b388976.2f76968","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.back_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":390,"y":200,"wires":[["e8cdfa36.6a7948"],["df3dac5c.0dc28"]]},{"id":"64090718.ad3d68","type":"trigger-state","z":"b388976.2f76968","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.garage_entrance_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":410,"y":280,"wires":[["74d8020.5e9a9"],["600a62b6.75fabc"]]},{"id":"11ab1097.f6169f","type":"trigger-state","z":"b388976.2f76968","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.garage_ext_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":390,"y":380,"wires":[["4a5fc4b4.2228ac"],["657c104a.918d4"]]},{"id":"dd29af0c.d74e6","type":"trigger-state","z":"b388976.2f76968","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.front_bedroom_window","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"previous_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"old_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":410,"y":480,"wires":[["4ead004f.872cf"],["605d35bb.79602c"]]},{"id":"13a38bbf.2f0114","type":"trigger-state","z":"b388976.2f76968","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.rear_bedroom_window","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":410,"y":580,"wires":[["2653eeff.d1e6e2"],["eed8474d.3ccde8"]]},{"id":"c58ee016.43b8e","type":"trigger-state","z":"b388976.2f76968","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.master_bedroom_window","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":420,"y":680,"wires":[["e4f6e578.d96a68"],["62b0311e.bbc8d"]]},{"id":"beea8ed1.d0322","type":"trigger-state","z":"b388976.2f76968","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.back_office_windows","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":410,"y":780,"wires":[["a0fae351.bccb3"],["5dca23fa.3b08ec"]]},{"id":"a45479be.bc0148","type":"trigger-state","z":"b388976.2f76968","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.garage_windows","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":390,"y":880,"wires":[["116ada85.59a5c5"],["f9b84beb.942e28"]]},{"id":"e05917f5.ef82b8","type":"trigger-state","z":"b388976.2f76968","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.kitchen_windows","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":390,"y":980,"wires":[["5bccb861.601758"],["1e8af0a9.c5a04f"]]},{"id":"81b988da.d3efd8","type":"api-current-state","z":"b388976.2f76968","name":"Away Mode Armed?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"armed_away","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"alarm_control_panel.home_alarm","state_type":"str","state_location":"","override_payload":"none","entity_location":"alarm_data","override_data":"msg","blockInputOverrides":false,"x":1020,"y":320,"wires":[["81cdd173.c1d61","6336e240.e3d06c"],[]]},{"id":"81cdd173.c1d61","type":"api-call-service","z":"b388976.2f76968","name":"Trigger Alarm","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"alarm_control_panel","service":"alarm_trigger","entityId":"alarm_control_panel.home_alarm","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1330,"y":200,"wires":[[]]},{"id":"10ef751c.d42c0b","type":"api-render-template","z":"d1f48851.ea8a08","name":"Unavailable Lights","server":"a86c4410.e2a568","template":"{{ expand(\"group.back_yard_lights\") | selectattr(\"state\",\"eq\",\"unavailable\") | list | count > 0 }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":590,"y":620,"wires":[["e3e6c797.443f68"]]},{"id":"e3e6c797.443f68","type":"switch","z":"d1f48851.ea8a08","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":620,"wires":[["c8709b18.eba7e8"],["a5d0317a.433e2"]]},{"id":"966a6599.5440f8","type":"inject","z":"b388976.2f76968","name":"detected","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"entity_id\":\"binary_sensor.front_bedroom_window\",\"old_state\":{\"entity_id\":\"binary_sensor.front_bedroom_window\",\"state\":\"off\",\"attributes\":{\"friendly_name\":\"Front Bedroom Window\",\"device_class\":\"window\"},\"last_changed\":\"2020-08-08T18:05:14.442971+00:00\",\"last_updated\":\"2020-08-08T18:05:14.442971+00:00\",\"context\":{\"id\":\"ff52a43e0762483f955172a4aea3fb13\",\"parent_id\":null,\"user_id\":null}},\"new_state\":{\"entity_id\":\"binary_sensor.front_bedroom_window\",\"state\":\"on\",\"attributes\":{\"friendly_name\":\"Front Bedroom Window\",\"device_class\":\"window\"},\"last_changed\":\"2020-08-08T20:59:06.166960+00:00\",\"last_updated\":\"2020-08-08T20:59:06.166960+00:00\",\"context\":{\"id\":\"18cc562303ba4ec7b74c10e47298c3eb\",\"parent_id\":null,\"user_id\":null},\"timeSinceChangedMs\":11}}","payloadType":"json","x":100,"y":480,"wires":[["dd29af0c.d74e6"]]},{"id":"6996bb18.a409b4","type":"trigger-state","z":"b388976.2f76968","name":"Alarm Arming","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"alarm_control_panel.home_alarm","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"46vmalnv0uf","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"arming"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":300,"y":1260,"wires":[["e9b2dbf.e73ef28"],[]]},{"id":"f70d9113.f65f3","type":"trigger-state","z":"b388976.2f76968","name":"Alarm Pending","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"alarm_control_panel.home_alarm","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"4hxeiazpdr7","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"pending"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":300,"y":1320,"wires":[["29e6db8b.4aa2a4","dcf21a23.1e70d8"],[]]},{"id":"29e6db8b.4aa2a4","type":"api-call-service","z":"b388976.2f76968","name":"Chirp","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.chirp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":550,"y":1320,"wires":[["402cf348.e5d6dc"]]},{"id":"402cf348.e5d6dc","type":"delay","z":"b388976.2f76968","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":640,"y":1400,"wires":[["44199223.20216c"]]},{"id":"44199223.20216c","type":"api-current-state","z":"b388976.2f76968","name":"Still Pending?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"pending","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"alarm_control_panel.home_alarm","state_type":"str","state_location":"","override_payload":"none","entity_location":"alarm_data","override_data":"msg","blockInputOverrides":false,"x":800,"y":1400,"wires":[["29e6db8b.4aa2a4"],["2d2a63c2.dab34c","c62132a0.ee9ca"]]},{"id":"43e83d56.b976c4","type":"credentials","z":"b388976.2f76968","name":"","props":[{"value":"alarm_code","type":"flow"}],"x":1110,"y":40,"wires":[[]]},{"id":"fc300ca0.5302c","type":"inject","z":"b388976.2f76968","name":"Startup","props":[],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":940,"y":40,"wires":[["43e83d56.b976c4"]]},{"id":"2d2a63c2.dab34c","type":"api-current-state","z":"b388976.2f76968","name":"Disarmed?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"disarmed","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"alarm_control_panel.home_alarm","state_type":"str","state_location":"","override_payload":"none","entity_location":"alarm_data","override_data":"msg","blockInputOverrides":false,"x":1030,"y":1380,"wires":[["b2426847.d106c8"],[]]},{"id":"c62132a0.ee9ca","type":"api-current-state","z":"b388976.2f76968","name":"Triggered?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"triggered","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"alarm_control_panel.home_alarm","state_type":"str","state_location":"","override_payload":"none","entity_location":"alarm_data","override_data":"msg","blockInputOverrides":false,"x":1030,"y":1440,"wires":[[],[]]},{"id":"b2426847.d106c8","type":"api-call-service","z":"b388976.2f76968","name":"Two Medium Chirps","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.two_medium_chirps","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1250,"y":1280,"wires":[[]]},{"id":"e9b2dbf.e73ef28","type":"api-call-service","z":"b388976.2f76968","name":"Voice Announce - Arming in 1 minute","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_tasker_command","entityId":"","data":"{\"message\":\"arming_away\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":570,"y":1260,"wires":[["aaba9b89.321248"]]},{"id":"679ede47.e1795","type":"trigger-state","z":"b388976.2f76968","name":"Alarm Armed Home","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"alarm_control_panel.home_alarm","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"dg34bcx7u5a","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"armed_home"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":310,"y":1480,"wires":[["b8747154.2d07d","167d0be9.8d3f44"],[]]},{"id":"b8747154.2d07d","type":"api-call-service","z":"b388976.2f76968","name":"Voice Announce","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_tasker_command","entityId":"","data":"{\"message\":\"armed\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":640,"y":1460,"wires":[[]]},{"id":"2a72c34b.ab453c","type":"trigger-state","z":"b388976.2f76968","name":"Alarm Armed Away","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"alarm_control_panel.home_alarm","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"0lau23u0wmxd","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"armed_away"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":310,"y":1540,"wires":[["b8747154.2d07d","7e4ebc91.3e58b4","c146fe85.d6983"],[]]},{"id":"2254cb21.5f8a04","type":"trigger-state","z":"b388976.2f76968","name":"Alarm Armed Night","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"alarm_control_panel.home_alarm","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"gz0y4c58uq","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"armed_night"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":310,"y":1600,"wires":[["64cf3dfd.853694"],[]]},{"id":"37053882.5bc388","type":"api-current-state","z":"b388976.2f76968","name":"Night Mode Armed?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"armed_night","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"alarm_control_panel.home_alarm","state_type":"str","state_location":"","override_payload":"none","entity_location":"alarm_data","override_data":"msg","blockInputOverrides":false,"x":1020,"y":380,"wires":[["81cdd173.c1d61","c317f9ed.e72ca8"],[]]},{"id":"e4bdd866.8c7a28","type":"api-current-state","z":"b388976.2f76968","name":"Home Mode Armed?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"armed_home","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"alarm_control_panel.home_alarm","state_type":"str","state_location":"","override_payload":"none","entity_location":"alarm_data","override_data":"msg","blockInputOverrides":false,"x":1020,"y":440,"wires":[["81cdd173.c1d61","c317f9ed.e72ca8"],[]]},{"id":"ab13363e.742ce8","type":"trigger-state","z":"b388976.2f76968","name":"Alarm Triggered","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"alarm_control_panel.home_alarm","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"0xzhajpux37c","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"triggered"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":300,"y":1780,"wires":[["80d5299b.37bad8","b324dae7.b69328"],[]]},{"id":"80d5299b.37bad8","type":"api-call-service","z":"b388976.2f76968","name":"Buzzer On","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.buzzer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":490,"y":1720,"wires":[[]]},{"id":"93688633.d97858","type":"trigger-state","z":"b388976.2f76968","name":"Alarm Disarmed","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"alarm_control_panel.home_alarm","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"io01zn64i1m","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"disarmed"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":300,"y":1900,"wires":[["b389ec.82519618","cf87d94f.35c108","e616250.c4349d8","51b5e335.16b4ac","8566901b.65ff2","8f480d7.f6f9ff"],[]]},{"id":"8566901b.65ff2","type":"api-call-service","z":"b388976.2f76968","name":"Two Medium Chirps","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.two_medium_chirps","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":760,"y":1940,"wires":[[]]},{"id":"9951145c.b66c08","type":"trigger","z":"f7e7a8ac.19a538","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1140,"y":600,"wires":[["95ea93c9.2e2c3","b3ea202a.234cb"]]},{"id":"1c3a560e.8f840a","type":"change","z":"f7e7a8ac.19a538","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":660,"wires":[["9951145c.b66c08"]]},{"id":"137da3ab.8986fc","type":"trigger-state","z":"f7e7a8ac.19a538","name":"Kitchen Motion Sensor","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.hue_100_motion","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"4ptvod6svpc","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":140,"y":1000,"wires":[["57f1a4e.352015c","644af02d.e993e"],["a3bd8e51.51f0e","4f0d8d4d.702b54","219a4164.2fa7de"]]},{"id":"57f1a4e.352015c","type":"switch","z":"f7e7a8ac.19a538","name":"Home or Guest Mode","property":"$globalContext('automation_mode') in ['home', 'guest']","propertyType":"jsonata","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":380,"y":880,"wires":[["abcc4d2f.dda58","2c90d7f7.e46d98"]]},{"id":"abcc4d2f.dda58","type":"api-call-service","z":"f7e7a8ac.19a538","name":"Turn On Kitchen Tablet","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.samsung_tablet_1001_backlight","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":880,"wires":[[]]},{"id":"644af02d.e993e","type":"change","z":"f7e7a8ac.19a538","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":980,"wires":[["a3bd8e51.51f0e","4f0d8d4d.702b54","219a4164.2fa7de"]]},{"id":"a3bd8e51.51f0e","type":"delay","z":"f7e7a8ac.19a538","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":570,"y":1040,"wires":[["d2ac283.27e22d8"]]},{"id":"d2ac283.27e22d8","type":"api-call-service","z":"f7e7a8ac.19a538","name":"Turn Off Kitchen Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_off","entityId":"group.kitchen_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":780,"y":1040,"wires":[[]]},{"id":"4f0d8d4d.702b54","type":"delay","z":"f7e7a8ac.19a538","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":570,"y":1100,"wires":[["6a3e41ac.554b"]]},{"id":"6a3e41ac.554b","type":"api-call-service","z":"f7e7a8ac.19a538","name":"Turn Off Kitchen Tablet","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.samsung_tablet_1001_backlight","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":780,"y":1100,"wires":[[]]},{"id":"dcf21a23.1e70d8","type":"api-call-service","z":"b388976.2f76968","name":"Turn on Wall Tablet","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.wall_tablet_backlight","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":430,"y":1400,"wires":[[]]},{"id":"26ef210.46e93e","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Enable Photo Frame Timeout","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"setStringSetting\",\"key\":\"timeToScreensaverV2\",\"value\":120}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":720,"y":340,"wires":[["a8e00379.e7b0a"]]},{"id":"98155cf3.798b8","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":280,"wires":[["e307177f.8cb298"]]},{"id":"1eae8988.9fe006","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Disable Photo Frame","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"setStringSetting\",\"key\":\"timeToScreensaverV2\",\"value\":\"0\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":500,"y":500,"wires":[["c2f081ab.b6318"]]},{"id":"4c9fdb94.fbfb94","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":420,"wires":[["1eae8988.9fe006"]]},{"id":"e307177f.8cb298","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Turn on Wall Tablet","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.wall_tablet_backlight","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":490,"y":360,"wires":[["26ef210.46e93e"]]},{"id":"c2f081ab.b6318","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Stop Photo Frame","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"stopScreensaver\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":730,"y":480,"wires":[["c6209f31.51c68"]]},{"id":"a8e00379.e7b0a","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Disable Screen Timeout","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"setStringSetting\",\"key\":\"timeToScreenOffV2\",\"value\":0}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":320,"wires":[["795303f6.14568c"]]},{"id":"c6209f31.51c68","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Enable Screen Timeout","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"setStringSetting\",\"key\":\"timeToScreenOffV2\",\"value\":120}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":460,"wires":[["4c5c49f7.334f18"]]},{"id":"b9c2ea8c.8fbb98","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Disable Screensaver","links":["26e1f4da.58193c","ca4f26a.ada56d8","f9518712.046d78"],"x":315,"y":500,"wires":[["1eae8988.9fe006"]]},{"id":"e2dce7a5.8969b8","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Enable Screensaver","links":["7a6207f2.8103c8","f4cfc917.1a35c8"],"x":315,"y":360,"wires":[["e307177f.8cb298"]]},{"id":"23b73671.5ed63a","type":"api-call-service","z":"dbd2ebf4.b8f648","d":true,"name":"Man Cave Tablet Notification","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"lenovo_tablet_1002_tasker_command","entityId":"","data":"{\"message\":\"kaitlyn_home\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":540,"y":780,"wires":[[]]},{"id":"fb147e4a.c4bd4","type":"inject","z":"dbd2ebf4.b8f648","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":780,"wires":[["23b73671.5ed63a"]]},{"id":"7e4ebc91.3e58b4","type":"api-call-service","z":"b388976.2f76968","name":"Set Away","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.automation_mode","data":"{\"option\":\"away\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":1520,"wires":[[]]},{"id":"b389ec.82519618","type":"switch","z":"b388976.2f76968","name":"Away Mode?","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"away","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":710,"y":2000,"wires":[["b1986239.18d5e"]]},{"id":"b1986239.18d5e","type":"api-call-service","z":"b388976.2f76968","name":"Set Home","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.automation_mode","data":"{\"option\":\"home\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":860,"y":2000,"wires":[[]]},{"id":"54c92da1.385054","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Restart Kiosk App","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"restartApp\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":510,"y":620,"wires":[["e8816cde.093d5"]]},{"id":"659a2f1f.9ecfc","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Restart Wall Tablet Kiosk App","links":["3edcc891.065cf8"],"x":315,"y":660,"wires":[["54c92da1.385054"]]},{"id":"3edcc891.065cf8","type":"link out","z":"a5e69210.f37a9","name":"Restart Wall Tablet Kiosk App","links":["659a2f1f.9ecfc","acc93fef.df373"],"x":1435,"y":280,"wires":[]},{"id":"59038815.a82ea8","type":"delay","z":"a5e69210.f37a9","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1320,"y":280,"wires":[["3edcc891.065cf8"]]},{"id":"cf87d94f.35c108","type":"api-call-service","z":"b388976.2f76968","name":"Lighting Scene","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.house_scene_alarm_disarmed","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":700,"y":2060,"wires":[[]]},{"id":"b324dae7.b69328","type":"api-call-service","z":"b388976.2f76968","name":"Lighting Scene","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.house_scene_alarm_triggered","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":500,"y":1800,"wires":[[]]},{"id":"b5bcc84c.b19028","type":"api-call-service","z":"b388976.2f76968","name":"Turn Off Bypass","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.bypass_open_sensors","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":660,"y":2240,"wires":[[]]},{"id":"8ce04704.e22db8","type":"trigger-state","z":"b388976.2f76968","name":"All Doors and Window Sensors Clear","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"sensor.all_door_and_window_sensors","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"011a3r16mgwg","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":370,"y":2180,"wires":[["b5bcc84c.b19028"],[]]},{"id":"bac5c167.d0c78","type":"trigger-state","z":"b388976.2f76968","name":"Alarm Change State","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"alarm_control_panel.home_alarm","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":320,"y":2240,"wires":[["b5bcc84c.b19028"],[]]},{"id":"da9305f4.d776a8","type":"api-call-service","z":"a5e69210.f37a9","d":true,"name":"Turn Off Air Purifier","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"turn_off_air_purifier","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1350,"y":200,"wires":[[]]},{"id":"af64a0d7.be026","type":"api-call-service","z":"dbd2ebf4.b8f648","name":"Turn On Air Purifier","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"turn_on_air_purifier","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1150,"y":480,"wires":[[]]},{"id":"477af775.73c4c8","type":"server-events","z":"a0c38079.b2ea6","name":"Call Service","server":"a86c4410.e2a568","event_type":"call_service","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":220,"y":140,"wires":[["a5077696.979a68"]]},{"id":"a5077696.979a68","type":"switch","z":"a0c38079.b2ea6","name":"","property":"payload.event.service_data.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"script.ledge_strips_brightness_increase","vt":"str"},{"t":"eq","v":"script.ledge_strips_brightness_decrease","vt":"str"},{"t":"eq","v":"script.ledge_strips_brightness_max","vt":"str"},{"t":"eq","v":"script.ledge_strips_brightness_min","vt":"str"},{"t":"eq","v":"script.man_cave_auto_scene","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":390,"y":140,"wires":[["7028dcc2.2eaaa4"],["36a93d05.dcbea2"],["43eeb30b.b2716c"],["3c08ce0d.7c0a72"],["64186d4c.483804"]]},{"id":"d4efb57e.62ba88","type":"subflow:3b8908a.fcea8f8","z":"a0c38079.b2ea6","name":"","x":1090,"y":100,"wires":[[]]},{"id":"c408083c.b6f378","type":"subflow:42ad5100.25527","z":"a0c38079.b2ea6","name":"","x":1100,"y":160,"wires":[[]]},{"id":"7028dcc2.2eaaa4","type":"change","z":"a0c38079.b2ea6","name":"","rules":[{"t":"set","p":"group_id","pt":"msg","to":"group.ledge_strips","tot":"str"},{"t":"set","p":"light_id","pt":"msg","to":"light.ledge_strips","tot":"str"},{"t":"set","p":"brightness_interval","pt":"msg","to":"50","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":100,"wires":[["d4efb57e.62ba88"]]},{"id":"36a93d05.dcbea2","type":"change","z":"a0c38079.b2ea6","name":"","rules":[{"t":"set","p":"group_id","pt":"msg","to":"group.ledge_strips","tot":"str"},{"t":"set","p":"light_id","pt":"msg","to":"light.ledge_strips","tot":"str"},{"t":"set","p":"brightness_interval","pt":"msg","to":"50","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":160,"wires":[["c408083c.b6f378"]]},{"id":"f03cdd6d.8a02e","type":"subflow:334bdfca.304fb","z":"a0c38079.b2ea6","name":"","x":1070,"y":220,"wires":[[]]},{"id":"43eeb30b.b2716c","type":"change","z":"a0c38079.b2ea6","name":"Brightness Max","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group_id\":\"group.ledge_strips\",\"service_data\":{\"brightness\":255}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":220,"wires":[["f03cdd6d.8a02e"]]},{"id":"79ba6995.5701a8","type":"subflow:334bdfca.304fb","z":"a0c38079.b2ea6","name":"","x":1070,"y":280,"wires":[[]]},{"id":"3c08ce0d.7c0a72","type":"change","z":"a0c38079.b2ea6","name":"Brightness Min","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group_id\":\"group.ledge_strips\",\"service_data\":{\"brightness\":1}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":280,"wires":[["79ba6995.5701a8"]]},{"id":"64186d4c.483804","type":"subflow:1c2e799b.e17e86","z":"a0c38079.b2ea6","name":"","x":860,"y":340,"wires":[[]]},{"id":"a0e4e686.820378","type":"trigger-state","z":"b388976.2f76968","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.front_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":390,"y":120,"wires":[["68ab0362.f0411c"],["2d69e704.bf2258"]]},{"id":"5afd0c4a.a843d4","type":"trigger-state","z":"f7e7a8ac.19a538","name":"Master Bedroom Door Sensor","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.smartthings_201_openclose","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"27mve08a4lj","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"zw9b2leo11","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":290,"y":340,"wires":[["85a20790.d82f38"],[]]},{"id":"181fd8f4.908b17","type":"api-call-service","z":"b388976.2f76968","name":"disarm","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"alarm_control_panel","service":"alarm_disarm","entityId":"alarm_control_panel.home_alarm","data":"{\"code\":\"{{ flow.alarm_code }}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":610,"y":1140,"wires":[[]]},{"id":"a8c7b244.bf7d","type":"api-current-state","z":"b388976.2f76968","name":"Armed Night?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"armed_night","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"alarm_control_panel.home_alarm","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":440,"y":1140,"wires":[["181fd8f4.908b17"],[]]},{"id":"177e4adf.03b505","type":"link in","z":"b388976.2f76968","name":"Night Disarm","links":["32902140.62b29e"],"x":245,"y":1140,"wires":[["a8c7b244.bf7d"]]},{"id":"32902140.62b29e","type":"link out","z":"a5e69210.f37a9","name":"","links":["177e4adf.03b505"],"x":1275,"y":240,"wires":[]},{"id":"f666474a.e42a38","type":"link in","z":"b388976.2f76968","name":"Arm Night","links":["d00b5044.7fe72"],"x":255,"y":1200,"wires":[["51b08e7e.7f6b5"]]},{"id":"d00b5044.7fe72","type":"link out","z":"a5e69210.f37a9","name":"","links":["f666474a.e42a38"],"x":895,"y":1500,"wires":[]},{"id":"85a20790.d82f38","type":"api-current-state","z":"f7e7a8ac.19a538","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.time","state_type":"str","state_location":"time","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":570,"y":320,"wires":[["fb61a422.587aa8"]]},{"id":"46f4c91d.d3b7c8","type":"function","z":"f7e7a8ac.19a538","name":"Set msg.hour","func":"msg.hour = parseInt(msg.time.substring(0, 2));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":320,"wires":[["d6ebcc65.5a4d2"]]},{"id":"5b93866d.56e678","type":"link out","z":"b388976.2f76968","name":"","links":["e4c0f021.5e862","38b41825.cd7788"],"x":795,"y":2120,"wires":[]},{"id":"71513b70.d07824","type":"file in","z":"b62e4b55.b6e888","name":"auth","filename":"/config/.storage/auth","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":550,"y":140,"wires":[["833cfa89.049518"]]},{"id":"833cfa89.049518","type":"json","z":"b62e4b55.b6e888","name":"","property":"payload","action":"obj","pretty":false,"x":670,"y":140,"wires":[["2bd011b4.4f829e"]]},{"id":"2bd011b4.4f829e","type":"function","z":"b62e4b55.b6e888","name":"","func":"var user_id = msg.data.event.new_state.context.user_id;\nvar user_name = \"\";\n\nfor (var i = 0; i < msg.payload.data.users.length; i++) {\n    \n    var user = msg.payload.data.users[i];\n    \n    console.log(user.id);\n    \n    if (user.id == user_id) {\n        user_name = user.name;\n        break;\n    }\n}\n\nmsg.user_name = user_name == \"Hass.io\" ? \"Home Assistant\" : user_name;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":140,"wires":[["63bfcf7a.4ea8c"]]},{"id":"8ca2a17.9ca4d6","type":"change","z":"b62e4b55.b6e888","name":"","rules":[{"t":"set","p":"payload","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":140,"wires":[["71513b70.d07824"]]},{"id":"63bfcf7a.4ea8c","type":"change","z":"b62e4b55.b6e888","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":140,"wires":[[]]},{"id":"e616250.c4349d8","type":"subflow:b62e4b55.b6e888","z":"b388976.2f76968","name":"","x":660,"y":2120,"wires":[["5b93866d.56e678"]]},{"id":"6d37ac25.5ea394","type":"subflow:b62e4b55.b6e888","z":"b388976.2f76968","name":"","env":[],"x":810,"y":1620,"wires":[["46f359c0.64f9f8"]]},{"id":"46f359c0.64f9f8","type":"link out","z":"b388976.2f76968","name":"Event: Alarm Armed","links":["7633c4a1.2dd64c"],"x":955,"y":1620,"wires":[]},{"id":"37e192da.9eb87e","type":"api-call-service","z":"b388976.2f76968","name":"Arm (night)","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"alarm_control_panel","service":"alarm_arm_night","entityId":"alarm_control_panel.home_alarm","data":"{\"code\":\"{{ flow.alarm_code }}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":670,"y":1200,"wires":[[]]},{"id":"51b08e7e.7f6b5","type":"api-current-state","z":"b388976.2f76968","name":"Armed Night?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"armed_night","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"alarm_control_panel.home_alarm","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":440,"y":1200,"wires":[[],["37e192da.9eb87e"]]},{"id":"167d0be9.8d3f44","type":"change","z":"b388976.2f76968","name":"","rules":[{"t":"set","p":"alarm_state","pt":"msg","to":"Armed (Home)","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":1580,"wires":[["6d37ac25.5ea394"]]},{"id":"c146fe85.d6983","type":"change","z":"b388976.2f76968","name":"","rules":[{"t":"set","p":"alarm_state","pt":"msg","to":"Armed (Away)","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":1620,"wires":[["6d37ac25.5ea394"]]},{"id":"64cf3dfd.853694","type":"change","z":"b388976.2f76968","name":"","rules":[{"t":"set","p":"alarm_state","pt":"msg","to":"Armed (Night)","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":1660,"wires":[["6d37ac25.5ea394"]]},{"id":"6336e240.e3d06c","type":"api-current-state","z":"b388976.2f76968","name":"Anyone Home?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.anybody_home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1340,"y":320,"wires":[["b9ebbf01.9759a"],["c317f9ed.e72ca8"]]},{"id":"b9ebbf01.9759a","type":"link out","z":"b388976.2f76968","name":"","links":["24d7a09b.65081"],"x":1475,"y":300,"wires":[]},{"id":"c317f9ed.e72ca8","type":"link out","z":"b388976.2f76968","name":"","links":["914e2cf9.38a77"],"x":1475,"y":360,"wires":[]},{"id":"51b5e335.16b4ac","type":"api-call-service","z":"b388976.2f76968","name":"Buzzer Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.buzzer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":730,"y":1880,"wires":[[]]},{"id":"f8cbc43e.4cb128","type":"server-state-changed","z":"d0661cff.7e5c6","name":"","server":"a86c4410.e2a568","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.garage_entrance_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":300,"y":280,"wires":[["c57d8dd7.ad313","e5cad13b.177e6"],[]]},{"id":"c57d8dd7.ad313","type":"api-current-state","z":"d0661cff.7e5c6","name":"Laundry Room Motion?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.hue_103_motion","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":650,"y":340,"wires":[["f8b44983.889818"],[]]},{"id":"f8b44983.889818","type":"api-render-template","z":"d0661cff.7e5c6","name":"Garage Dark?","server":"a86c4410.e2a568","template":"{{ state_attr('sensor.hue_202_lux', 'dark') }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":880,"y":380,"wires":[["9f74b5f6.85a098"]]},{"id":"8762f445.cab608","type":"api-current-state","z":"d0661cff.7e5c6","name":"Garage Lights Off?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.garage_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1350,"y":340,"wires":[["b3356a2.af79698"],[]]},{"id":"b3356a2.af79698","type":"api-call-service","z":"d0661cff.7e5c6","name":"Turn On Garage Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_on","entityId":"group.garage_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1580,"y":340,"wires":[[]]},{"id":"9f74b5f6.85a098","type":"switch","z":"d0661cff.7e5c6","name":"True?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1050,"y":340,"wires":[["8762f445.cab608"],[]]},{"id":"e5cad13b.177e6","type":"api-call-service","z":"d0661cff.7e5c6","name":"Turn on Garage Tablet","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.lenovo_tablet_701_backlight","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":640,"y":280,"wires":[[]]},{"id":"eef4115f.e6fe9","type":"server-state-changed","z":"d0661cff.7e5c6","name":"","server":"a86c4410.e2a568","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.hue_202_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":280,"y":440,"wires":[["52e9485f.9b2758","f8b44983.889818","e5cad13b.177e6"],["e34ac367.9c691"]]},{"id":"ef7887f7.047b78","type":"trigger","z":"d0661cff.7e5c6","name":"","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":810,"y":560,"wires":[["224b1c60.04c934","e9bda396.dce79"]]},{"id":"b24b4dc8.7a6f2","type":"trigger-state","z":"d0661cff.7e5c6","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.ai_garage_person_occupancy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":250,"y":520,"wires":[["52e9485f.9b2758","948dbff6.fcc6a"],["abeb2166.9f88a"]]},{"id":"e34ac367.9c691","type":"api-current-state","z":"d0661cff.7e5c6","name":"Garage Not Occupied?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.ai_garage_person_occupancy","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":620,"y":480,"wires":[[],["ef7887f7.047b78"]]},{"id":"abeb2166.9f88a","type":"api-current-state","z":"d0661cff.7e5c6","name":"Not Garage Motion?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.hue_202_motion","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":620,"y":620,"wires":[["ef7887f7.047b78"],[]]},{"id":"52e9485f.9b2758","type":"change","z":"d0661cff.7e5c6","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":560,"wires":[["ef7887f7.047b78"]]},{"id":"224b1c60.04c934","type":"api-call-service","z":"d0661cff.7e5c6","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_off","entityId":"group.garage_lights_and_switches","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1020,"y":560,"wires":[[]]},{"id":"630ba1c5.b1d79","type":"trigger-state","z":"75ccec5b.f7e364","name":"Night Shift On/Off","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"switch.night_shift","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"vpuxluf92f9","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":330,"y":300,"wires":[["d3979976.f85678","66e3abc7.fb91e4"],["d3979976.f85678"]]},{"id":"d3979976.f85678","type":"change","z":"75ccec5b.f7e364","name":"","rules":[{"t":"set","p":"night_shift","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":300,"wires":[[]]},{"id":"e9bda396.dce79","type":"api-call-service","z":"d0661cff.7e5c6","name":"Turn Off Garage Tablet","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.lenovo_tablet_701_backlight","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1000,"y":620,"wires":[[]]},{"id":"8f236d44.4f323","type":"debug","z":"c6727c1e.1d54f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1010,"y":380,"wires":[]},{"id":"fb61a422.587aa8","type":"switch","z":"f7e7a8ac.19a538","name":"Sleep Mode?","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"sleep","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":770,"y":320,"wires":[["46f4c91d.d3b7c8"]]},{"id":"9d3b806a.93078","type":"api-current-state","z":"75ccec5b.f7e364","name":"","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.night_shift","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":390,"y":200,"wires":[["d3979976.f85678","1951974d.02d6d9"]]},{"id":"a37ab40e.8e5658","type":"api-current-state","z":"abbc1f2.48c95e","name":"switch.chill_mode","server":"a86c4410.e2a568","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.chill_mode","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":290,"y":80,"wires":[["ab974a04.bc46a8"]]},{"id":"9f9e46f8.163538","type":"inject","z":"a5e69210.f37a9","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1070,"y":100,"wires":[[]]},{"id":"5aeb3ca.74b29c4","type":"function","z":"f7e7a8ac.19a538","d":true,"name":"Set msg.hour","func":"msg.hour = parseInt(msg.time.substring(0, 2));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":400,"wires":[["7fb9bb75.e10934"]]},{"id":"7fb9bb75.e10934","type":"switch","z":"f7e7a8ac.19a538","d":true,"name":"msg.hour between 10 and 24 or 0 and 4","property":"hour","propertyType":"msg","rules":[{"t":"btwn","v":"22","vt":"num","v2":"23","v2t":"num"},{"t":"btwn","v":"0","vt":"num","v2":"3","v2t":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1200,"y":400,"wires":[[],[]]},{"id":"fa2f7829.77f538","type":"switch","z":"f7e7a8ac.19a538","name":"Sleep Mode?","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"sleep","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2310,"y":380,"wires":[["dcebc7c4.b7c478"]]},{"id":"9ff34595.4f4938","type":"trigger-state","z":"f7e7a8ac.19a538","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_select.automation_mode","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"tkw6munk39g","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"away"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":550,"y":500,"wires":[["41627fa1.d7e1","1c3a560e.8f840a"],[]]},{"id":"807a9e64.faf18","type":"trigger-state","z":"f7e7a8ac.19a538","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_select.automation_mode","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":550,"y":540,"wires":[["41627fa1.d7e1","1c3a560e.8f840a"],[]]},{"id":"729fcd15.435ee4","type":"api-call-service","z":"4d34c979.7acd48","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.circadian_brightness","data":"{\"value\":\"{{ payload.kelvin }}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1000,"y":520,"wires":[[]]},{"id":"bfc3e021.9cf61","type":"link in","z":"4d34c979.7acd48","name":"Auto Updater","links":["563153d7.8339fc"],"x":55,"y":1480,"wires":[["4f590f4.6f4faf"]]},{"id":"4f590f4.6f4faf","type":"api-current-state","z":"4d34c979.7acd48","name":"Man Cave Tablet On","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.man_cave_tablet_backlight","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":440,"y":1480,"wires":[["742d0676.57dbd8"],[]]},{"id":"742d0676.57dbd8","type":"api-call-service","z":"4d34c979.7acd48","name":"Set screen brightness","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.samsung_tablet_1002_backlight","data":"{\"brightness\":\"{{ flow.circadian_brightness }}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":780,"y":1480,"wires":[[]]},{"id":"8bebd260.74498","type":"api-call-service","z":"a5e69210.f37a9","name":"Turn off Tablets","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.samsung_tablet_1002_backlight","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":960,"y":1560,"wires":[[]]},{"id":"6174c0b7.c8e1","type":"inject","z":"a5e69210.f37a9","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":740,"y":1540,"wires":[["8bebd260.74498"]]},{"id":"fbcf1c9a.c042f","type":"trigger-state","z":"f7e7a8ac.19a538","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.garage_entrance_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"27mve08a4lj","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":390,"y":180,"wires":[["47e7655f.04452c"],[]]},{"id":"47e7655f.04452c","type":"api-current-state","z":"f7e7a8ac.19a538","name":"Laundry Lights Off?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.laundry_room_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":710,"y":180,"wires":[["60019f91.bbd3b"],[]]},{"id":"60019f91.bbd3b","type":"subflow:47ecb152.aed62","z":"f7e7a8ac.19a538","name":"","env":[],"x":960,"y":180,"wires":[[]]},{"id":"2464c0b4.008c8","type":"json","z":"644db6a5.3303b8","name":"Parse Json","property":"payload","action":"","pretty":false,"x":270,"y":80,"wires":[["877a83bb.67b9f"]]},{"id":"dc32e8ef.1c3c88","type":"change","z":"644db6a5.3303b8","d":true,"name":"Get Predictions","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.predictions","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":300,"wires":[["5f3453aa.b97d4c"]]},{"id":"5f3453aa.b97d4c","type":"split","z":"644db6a5.3303b8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":550,"y":300,"wires":[["e1cf19e1.e60798"]]},{"id":"e1cf19e1.e60798","type":"switch","z":"644db6a5.3303b8","name":"Object Class","property":"payload.object_class","propertyType":"msg","rules":[{"t":"eq","v":"car","vt":"str"},{"t":"eq","v":"truck","vt":"str"},{"t":"eq","v":"person","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":110,"y":540,"wires":[["e7159af6.13ab38"],["e7159af6.13ab38"],["beb71c4d.ed465"]]},{"id":"beb71c4d.ed465","type":"debug","z":"644db6a5.3303b8","name":"Person in driveway!","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":300,"y":600,"wires":[]},{"id":"e7159af6.13ab38","type":"switch","z":"644db6a5.3303b8","name":"Car/Truck Not Masked","property":"payload.is_masked","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":320,"y":500,"wires":[["d4b0f034.d300e"]]},{"id":"4be162e5.fa3cbc","type":"debug","z":"644db6a5.3303b8","name":"Car moving in driveway!","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":750,"y":500,"wires":[]},{"id":"bef2ccdc.a5b72","type":"debug","z":"644db6a5.3303b8","name":"Car parked in driveway!","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":750,"y":440,"wires":[]},{"id":"d4b0f034.d300e","type":"switch","z":"644db6a5.3303b8","name":"Smart Filtered","property":"payload.is_smart_filtered","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":470,"y":440,"wires":[["bef2ccdc.a5b72"],["4be162e5.fa3cbc"]]},{"id":"4bdb4f.8527f4b","type":"mqtt in","z":"644db6a5.3303b8","name":"","topic":"mqtt/lastwatch/driveway","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":120,"y":220,"wires":[["30869dc9.59f222","b9629a4f.225218"]]},{"id":"30869dc9.59f222","type":"json","z":"644db6a5.3303b8","name":"Parse Json","property":"payload","action":"","pretty":false,"x":370,"y":220,"wires":[["b9629a4f.225218"]]},{"id":"4d1f350.2bf5ecc","type":"function","z":"c6727c1e.1d54f","name":"","func":"var hue = Math.floor(Math.random() * 361);\nvar saturation = 80 + Math.floor(Math.random() * 21);\n\nmsg.payload = {\n    \"domain\": \"light\",\n    \"service\": \"turn_on\",\n    \"data\": {\n        \"hs_color\": [hue, saturation],\n        \"brightness\": 255\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1560,"y":2300,"wires":[["80b96f42.496cd"]]},{"id":"80b96f42.496cd","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn on Ledge Strips","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ledge_strips","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1730,"y":2300,"wires":[[]]},{"id":"ce1c0e1c.c6edc","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn On Ledge Strips","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ledge_strips_deconz, light.living_room_lamps_deconz","data":"{\"brightness\":255,\"kelvin\":3200}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1820,"y":2140,"wires":[[]]},{"id":"649866ea.c5fe08","type":"api-current-state","z":"c6727c1e.1d54f","name":"TV Backlight on?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.flex_strip_105","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1810,"y":2200,"wires":[["90ccdb46.832188"],[]]},{"id":"90ccdb46.832188","type":"api-call-service","z":"c6727c1e.1d54f","name":"Update TV Backlight","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.flex_strip_105","data":"{\"brightness\":255,\"kelvin\":3200}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2040,"y":2200,"wires":[[]]},{"id":"6f191a67.1ddc04","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn off Ledge Fluxer","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1320,"y":1920,"wires":[["aa112e0a.20945"]]},{"id":"aa112e0a.20945","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn off Ledge Shuffler","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.great_room_shuffler","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1560,"y":1920,"wires":[["513aab29.14c124","8d426aed.45e228","22f0ade7.11ff92"]]},{"id":"513aab29.14c124","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn On Ledge Strips","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ledge_strips_deconz","data":"{\"brightness\":100,\"kelvin\":2600}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1800,"y":1920,"wires":[[]]},{"id":"8d426aed.45e228","type":"api-current-state","z":"c6727c1e.1d54f","name":"TV Backlight on?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.flex_strip_105","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1790,"y":1980,"wires":[["3bf97bcf.c7aea4"],[]]},{"id":"3bf97bcf.c7aea4","type":"api-call-service","z":"c6727c1e.1d54f","name":"Update TV Backlight","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.flex_strip_105","data":"{\"brightness\":100,\"kelvin\":2600}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2020,"y":1980,"wires":[[]]},{"id":"9ddcbf6b.417fb","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn on lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.living_room_lamps_deconz, light.ledge_strips_deconz","data":"{\"brightness\":255}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1400,"y":2060,"wires":[["1c076326.2f54fd"]]},{"id":"1c076326.2f54fd","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn off Ledge Fluxer","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1640,"y":2060,"wires":[["ce79c75e.65aa28"]]},{"id":"ea7cc6ea.e0d958","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn off Ledge Fluxer","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1560,"y":1700,"wires":[["bc2e9498.52d3b8"]]},{"id":"bc2e9498.52d3b8","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn off Ledge Shuffler","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.great_room_shuffler","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1780,"y":1700,"wires":[["df55f470.366468"]]},{"id":"fbdde8c4.58faa8","type":"api-current-state","z":"c6727c1e.1d54f","name":"Fluxer On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.ledge_fluxer","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1310,"y":1760,"wires":[["ea7cc6ea.e0d958"],["28a12c4b.36e8d4"]]},{"id":"df55f470.366468","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn off lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.ledge_strips_deconz, light.living_room_lamps_deconz","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2060,"y":1700,"wires":[[]]},{"id":"369d6449.dc106c","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn on Ledge Fluxer","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1800,"y":1760,"wires":[["3a4a208f.41f11"]]},{"id":"3a4a208f.41f11","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn on lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ledge_strips_deconz, light.living_room_lamps_deconz","data":"{\"brightness\":255,\"kelvin\":3200}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2040,"y":1760,"wires":[[]]},{"id":"ac5de963.445b28","type":"inject","z":"c6727c1e.1d54f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1850,"y":1620,"wires":[["df55f470.366468"]]},{"id":"28a12c4b.36e8d4","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn off Ledge Shuffler","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.great_room_shuffler","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1560,"y":1760,"wires":[["369d6449.dc106c"]]},{"id":"22f0ade7.11ff92","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn On Lamps","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.living_room_lamps_deconz","data":"{\"brightness\":100,\"kelvin\":2600}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1780,"y":1860,"wires":[[]]},{"id":"e3798c4d.3c4dc","type":"inject","z":"abbc1f2.48c95e","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":40,"wires":[["a37ab40e.8e5658"]]},{"id":"2395b03f.31aac","type":"inject","z":"abbc1f2.48c95e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":260,"y":500,"wires":[["91dd58d8.e9a328"]]},{"id":"91dd58d8.e9a328","type":"link out","z":"abbc1f2.48c95e","name":"Chill Mode On","links":["fd170957.857908"],"x":435,"y":500,"wires":[]},{"id":"aaba9b89.321248","type":"link out","z":"b388976.2f76968","name":"","links":["fd170957.857908"],"x":755,"y":1260,"wires":[]},{"id":"8f480d7.f6f9ff","type":"link out","z":"b388976.2f76968","name":"","links":["8257cbb.d961538"],"x":675,"y":1840,"wires":[]},{"id":"6fc2c76d.67b6c8","type":"link out","z":"f7e7a8ac.19a538","name":"","links":["4aa1fc95.34b874"],"x":915,"y":820,"wires":[]},{"id":"b3ea202a.234cb","type":"link out","z":"f7e7a8ac.19a538","name":"Man Cave Motion Triggered","links":["393e3884.ca7ce8"],"x":1315,"y":660,"wires":[]},{"id":"cf39c9f7.970ce8","type":"api-current-state","z":"af9f7dc8.af217","name":"Great Room Lights On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.all_living_room_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":450,"y":200,"wires":[["5e3be4ed.bd7ebc"],["9e792dab.d46f3"]]},{"id":"5e3be4ed.bd7ebc","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn Great Room Lights Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"group.all_living_room_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":710,"y":200,"wires":[[]]},{"id":"9e792dab.d46f3","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn On Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ledge_strips_deconz, light.living_room_lamps_deconz","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":670,"y":260,"wires":[["96bc3b46.6c2c68"]]},{"id":"96bc3b46.6c2c68","type":"api-call-service","z":"af9f7dc8.af217","name":"Flux","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":820,"y":260,"wires":[[]]},{"id":"89d8a1c9.1ff21","type":"link in","z":"af9f7dc8.af217","name":"Great Room","links":[],"x":255,"y":260,"wires":[["cf39c9f7.970ce8"]]},{"id":"6d2fb8e8.9fe878","type":"mqtt in","z":"af9f7dc8.af217","name":"","topic":"/hass/smart-light-toggle/great-room","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":160,"y":200,"wires":[["cf39c9f7.970ce8"]]},{"id":"697a98dc.a42538","type":"mqtt in","z":"af9f7dc8.af217","name":"","topic":"/hass/smart-light-toggle/kitchen","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":150,"y":340,"wires":[["7bb3f790.07c988"]]},{"id":"7bb3f790.07c988","type":"api-current-state","z":"af9f7dc8.af217","name":"Kitchen Lights On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.kitchen_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":430,"y":340,"wires":[["1f7ba36b.1b97bd"],["79f999fd.2777b8"]]},{"id":"1f7ba36b.1b97bd","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn Kitchen Lights Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_off","entityId":"group.kitchen_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":340,"wires":[[]]},{"id":"79f999fd.2777b8","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn On Kitchen Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.cabinet_lights, switch.bar_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":400,"wires":[["dcd06447.79cd38"]]},{"id":"dcd06447.79cd38","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn On Kitchen Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.kitchen_table_lights","data":"{\"brightness\":64}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":900,"y":400,"wires":[[]]},{"id":"d1d93f55.c95f7","type":"link in","z":"af9f7dc8.af217","name":"Kitchen","links":[],"x":255,"y":400,"wires":[["7bb3f790.07c988"]]},{"id":"eae49396.80e47","type":"mqtt in","z":"af9f7dc8.af217","name":"","topic":"/hass/smart-light-toggle/bedroom","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":150,"y":480,"wires":[["be4dded3.c3578"]]},{"id":"be4dded3.c3578","type":"api-current-state","z":"af9f7dc8.af217","name":"Bedroom Lights On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.master_bedroom_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":440,"y":480,"wires":[["e6e12564.a9a388"],["9f3cc7f5.c92cf8"]]},{"id":"e6e12564.a9a388","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn Bedroom Lights Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_off","entityId":"group.master_bedroom_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":690,"y":480,"wires":[[]]},{"id":"ddad42cd.f483a","type":"link in","z":"af9f7dc8.af217","name":"Bedroom","links":[],"x":255,"y":540,"wires":[["be4dded3.c3578"]]},{"id":"9f3cc7f5.c92cf8","type":"subflow:ea924b33.c97d48","z":"af9f7dc8.af217","name":"","x":700,"y":540,"wires":[[]]},{"id":"cf017c4e.b00af","type":"mqtt in","z":"af9f7dc8.af217","name":"","topic":"/hass/smart-light-toggle/guest-room","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":160,"y":620,"wires":[["88704655.cd52a8"]]},{"id":"88704655.cd52a8","type":"api-current-state","z":"af9f7dc8.af217","name":"Guest Room Lights On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.guest_room_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":450,"y":620,"wires":[["76e9d663.bab5e8"],["d2eb0a17.34d458"]]},{"id":"76e9d663.bab5e8","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn Guest Room Lights Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_off","entityId":"group.guest_room_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":720,"y":620,"wires":[[]]},{"id":"8035e2fd.d7e55","type":"link in","z":"af9f7dc8.af217","name":"Guest Room","links":[],"x":255,"y":680,"wires":[["88704655.cd52a8"]]},{"id":"d2eb0a17.34d458","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn On Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.guest_room_lights","data":"{\"brightness\":255,\"kelvin\":3000}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":680,"wires":[[]]},{"id":"97aa3947.9bd318","type":"mqtt in","z":"af9f7dc8.af217","name":"","topic":"/hass/smart-light-toggle/man-cave","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":160,"y":760,"wires":[["897a9696.d0fcd8"]]},{"id":"897a9696.d0fcd8","type":"api-current-state","z":"af9f7dc8.af217","name":"Man Cave Lights On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.man_cave_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":440,"y":760,"wires":[["dd401187.44222"],["727f70db.c3a08"]]},{"id":"dd401187.44222","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn Man Cave Lights Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_off","entityId":"group.man_cave_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":710,"y":760,"wires":[[]]},{"id":"ef386b76.165428","type":"link in","z":"af9f7dc8.af217","name":"Man Cave","links":[],"x":255,"y":820,"wires":[["897a9696.d0fcd8"]]},{"id":"727f70db.c3a08","type":"subflow:1c2e799b.e17e86","z":"af9f7dc8.af217","name":"","x":700,"y":820,"wires":[[]]},{"id":"4828f452.6f3a5c","type":"mqtt in","z":"af9f7dc8.af217","name":"","topic":"/hass/smart-light-toggle/garage","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":150,"y":900,"wires":[["9c1a5007.b79bd"]]},{"id":"9c1a5007.b79bd","type":"api-current-state","z":"af9f7dc8.af217","name":"Garage Lights On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.garage_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":430,"y":900,"wires":[["ac82b4f1.b47278"],["40a3f948.2a6798"]]},{"id":"ac82b4f1.b47278","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn Garage Lights Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_off","entityId":"group.garage_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":700,"y":900,"wires":[[]]},{"id":"dec3efdc.d762a","type":"link in","z":"af9f7dc8.af217","name":"Garage","links":[],"x":255,"y":960,"wires":[["9c1a5007.b79bd"]]},{"id":"40a3f948.2a6798","type":"api-call-service","z":"af9f7dc8.af217","name":"Turn On Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.garage_lights","data":"{\"brightness\":255,\"kelvin\":4000}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":960,"wires":[[]]},{"id":"877a83bb.67b9f","type":"function","z":"644db6a5.3303b8","name":"","func":"// jshint esversion: 6\n\nlet cars = [];\n\ncars = msg.predictions.filter((p) => {\n   return p.object_class == car\n    \n});\n\nmsg.cars = cars;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":80,"wires":[["ac97cfbd.33c2c"]]},{"id":"6cd445a5.b5bd2c","type":"inject","z":"644db6a5.3303b8","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"detection_event\":{\"id\":435625,\"image_file_name\":\"events/annke101sd.20210123_113103414.jpg\",\"created_at\":\"2021-01-23T17:31:04.000000Z\",\"updated_at\":\"2021-01-23T17:31:04.000000Z\",\"image_dimensions\":\"640x480\",\"occurred_at\":\"2021-01-23 17:31:04\",\"image_url\":\"http://192.168.1.96/api/events/435625/img\"},\"detection_profile\":{\"id\":14,\"created_at\":\"2020-12-29T17:33:59.000000Z\",\"updated_at\":\"2020-12-29T17:36:32.000000Z\",\"name\":\"Driveway Objects (neg)\",\"slug\":\"driveway-objects-neg\",\"file_pattern\":\"annke101sd\",\"object_classes\":[\"person\",\"bicycle\",\"car\",\"motorcycle\",\"airplane\",\"bus\",\"train\",\"truck\",\"boat\",\"bird\",\"cat\",\"dog\",\"horse\",\"sheep\",\"cow\",\"bear\"],\"min_confidence\":\"0.45\",\"use_regex\":false,\"use_mask\":1,\"is_active\":1,\"is_enabled\":1,\"deleted_at\":null,\"is_scheduled\":0,\"start_time\":null,\"end_time\":null,\"use_smart_filter\":true,\"smart_filter_precision\":\"0.65\",\"is_negative\":true,\"automations\":[{\"id\":24,\"detection_profile_id\":14,\"automation_config_type\":\"mqtt_publish_configs\",\"automation_config_id\":2,\"created_at\":\"2020-12-29T17:34:01.000000Z\",\"updated_at\":\"2020-12-29T17:34:01.000000Z\",\"deleted_at\":null}]},\"predictions\":[{\"id\":389625,\"detection_event_id\":435625,\"object_class\":\"car\",\"confidence\":\"0.75\",\"x_min\":328,\"x_max\":382,\"y_min\":32,\"y_max\":61,\"created_at\":\"2021-01-23T17:31:05.000000Z\",\"updated_at\":\"2021-01-23T17:31:05.000000Z\",\"detection_profile_id\":14,\"is_masked\":1,\"is_smart_filtered\":0},{\"id\":389626,\"detection_event_id\":435625,\"object_class\":\"car\",\"confidence\":\"0.89\",\"x_min\":349,\"x_max\":462,\"y_min\":49,\"y_max\":105,\"created_at\":\"2021-01-23T17:31:05.000000Z\",\"updated_at\":\"2021-01-23T17:31:05.000000Z\",\"detection_profile_id\":14,\"is_masked\":1,\"is_smart_filtered\":0},{\"id\":389627,\"detection_event_id\":435625,\"object_class\":\"car\",\"confidence\":\"0.89\",\"x_min\":113,\"x_max\":243,\"y_min\":67,\"y_max\":196,\"created_at\":\"2021-01-23T17:31:05.000000Z\",\"updated_at\":\"2021-01-23T17:31:05.000000Z\",\"detection_profile_id\":14,\"is_masked\":0,\"is_smart_filtered\":1}]}","payloadType":"json","x":110,"y":80,"wires":[["2464c0b4.008c8"]]},{"id":"ac97cfbd.33c2c","type":"debug","z":"644db6a5.3303b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":570,"y":80,"wires":[]},{"id":"ecd56130.96b0f","type":"link in","z":"47850f9e.3112f","name":"Great Room Bright","links":[],"x":215,"y":120,"wires":[["72d78d1e.ae3c94"]]},{"id":"9a988af3.1e1ef8","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/great-room/bright","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":280,"y":80,"wires":[["72d78d1e.ae3c94"]]},{"id":"7b855990.840308","type":"api-call-service","z":"47850f9e.3112f","name":"Great Room Bright","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ledge_strips_deconz, light.living_room_lamps_deconz","data":"{\"brightness\":255,\"kelvin\":4300}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":790,"y":120,"wires":[["1111b48b.387f5b"]]},{"id":"deaf86aa.946dd8","type":"link in","z":"47850f9e.3112f","name":"Kitchen Bright","links":[],"x":315,"y":1140,"wires":[["81674456.e8d558"]]},{"id":"74fd8998.b4c2f8","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/kitchen/bright","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":190,"y":1100,"wires":[["81674456.e8d558"]]},{"id":"81674456.e8d558","type":"api-call-service","z":"47850f9e.3112f","name":"Kitchen Bright","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.kitchen_lights","data":"{\"brightness\":255}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":460,"y":1100,"wires":[[]]},{"id":"5b0ea7f0.3ec688","type":"link in","z":"47850f9e.3112f","name":"Master Bedroom Bright","links":[],"x":315,"y":1280,"wires":[["97db99c8.7e16d8"]]},{"id":"28dffeff.33c152","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/master-bedroom/bright","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":220,"y":1220,"wires":[["97db99c8.7e16d8"]]},{"id":"97db99c8.7e16d8","type":"api-call-service","z":"47850f9e.3112f","name":"Master Bedroom Bright","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.master_bedroom_lamps_deconz","data":"{\"brightness\":255,\"kelvin\": 4000}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":530,"y":1220,"wires":[["91c7399f.f95398"]]},{"id":"91c7399f.f95398","type":"api-call-service","z":"47850f9e.3112f","name":"Master Bedroom Bright","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.master_bedroom_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":790,"y":1220,"wires":[[]]},{"id":"ca97b57d.6c5c28","type":"inject","z":"47850f9e.3112f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":260,"y":1320,"wires":[["97db99c8.7e16d8"]]},{"id":"60de6af3.3b8db4","type":"inject","z":"47850f9e.3112f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1180,"wires":[["81674456.e8d558"]]},{"id":"3d9513ce.83516c","type":"credentials","z":"2ef67aae.d4bfe6","name":"","props":[{"value":"kiosk_password","type":"flow"},{"value":"tasker_url","type":"flow"}],"x":310,"y":40,"wires":[[]]},{"id":"3bf94652.a9a5ea","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payloadType":"str","x":120,"y":40,"wires":[["3d9513ce.83516c"]]},{"id":"7cc08269.038b6c","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Front Door Chime","links":["68ab0362.f0411c"],"x":315,"y":1900,"wires":[["6e9293f.ec37a6c"]]},{"id":"87a3fb13.7b5178","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/front-door-chime","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":190,"y":1860,"wires":[["6e9293f.ec37a6c"]]},{"id":"6e9293f.ec37a6c","type":"change","z":"2ef67aae.d4bfe6","name":"","rules":[{"t":"set","p":"message","pt":"msg","to":"front_door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":1860,"wires":[["2603f4f6.93de2c"]]},{"id":"1ec57f40.0115e1","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1820,"wires":[["6e9293f.ec37a6c"]]},{"id":"76dee972.a65e48","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Back Door Chime","links":["e8cdfa36.6a7948"],"x":315,"y":2040,"wires":[["fc7eda6f.288d28"]]},{"id":"bd32d0c1.627d6","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/back-door-chime","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":190,"y":2000,"wires":[["fc7eda6f.288d28"]]},{"id":"fc7eda6f.288d28","type":"change","z":"2ef67aae.d4bfe6","name":"","rules":[{"t":"set","p":"message","pt":"msg","to":"back_door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":2000,"wires":[["6d9840f0.56c24"]]},{"id":"169422b0.997d0d","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1960,"wires":[["fc7eda6f.288d28"]]},{"id":"342ddbc0.f0a844","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Garage Entry Door Chime","links":["74d8020.5e9a9"],"x":315,"y":2180,"wires":[["bbc3d43d.801718"]]},{"id":"8f09d441.f7ccb8","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/garage-entry-door-chime","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":220,"y":2140,"wires":[["bbc3d43d.801718"]]},{"id":"bbc3d43d.801718","type":"change","z":"2ef67aae.d4bfe6","name":"","rules":[{"t":"set","p":"message","pt":"msg","to":"garage_entry_door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":2180,"wires":[["dfec471c.3b8a98"]]},{"id":"e29d6700.793798","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":300,"y":2100,"wires":[["bbc3d43d.801718"]]},{"id":"68ab0362.f0411c","type":"link out","z":"b388976.2f76968","name":"Front Door Opened","links":["28d33856.694228","2a0c4381.f97c2c","3ad76d79.37db92","7cc08269.038b6c","d6b5adcc.2a27"],"x":595,"y":100,"wires":[]},{"id":"e8cdfa36.6a7948","type":"link out","z":"b388976.2f76968","name":"Back Door Opened","links":["28d33856.694228","2a0c4381.f97c2c","3ad76d79.37db92","76dee972.a65e48","d6b5adcc.2a27"],"x":595,"y":180,"wires":[]},{"id":"74d8020.5e9a9","type":"link out","z":"b388976.2f76968","name":"Garage Entrance Door Opened","links":["28d33856.694228","2a0c4381.f97c2c","342ddbc0.f0a844","3ad76d79.37db92","d6b5adcc.2a27"],"x":635,"y":260,"wires":[]},{"id":"14de544.a0b82ac","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/enable-screensaver","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":200,"y":320,"wires":[["e307177f.8cb298"]]},{"id":"d723762.725a688","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/disable-screensaver","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":200,"y":460,"wires":[["1eae8988.9fe006"]]},{"id":"2159f4fc.29516c","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":580,"wires":[["54c92da1.385054"]]},{"id":"bfc5513a.fd077","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/restart-kiosk-app","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":190,"y":620,"wires":[["54c92da1.385054"]]},{"id":"7963588c.891828","type":"link out","z":"abbc1f2.48c95e","name":"","links":[],"x":435,"y":540,"wires":[]},{"id":"ee132697.ae6bc8","type":"function","z":"644db6a5.3303b8","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":640,"wires":[[]]},{"id":"bfa041b7.a7587","type":"link in","z":"47850f9e.3112f","name":"Great Room Warm White","links":["e6bb7917.e655d8"],"x":215,"y":260,"wires":[["5a127904.ba5af8"]]},{"id":"a6153121.e74b8","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/great-room/warm-white","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":300,"y":220,"wires":[["5a127904.ba5af8"]]},{"id":"822e8f37.b5b81","type":"api-call-service","z":"47850f9e.3112f","name":"Great Room Warm White","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ledge_strips_deconz, light.living_room_lamps_deconz","data":"{\"brightness\":255,\"kelvin\":3000}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":770,"y":260,"wires":[["173ce7e1.6879c8"]]},{"id":"72d78d1e.ae3c94","type":"api-call-service","z":"47850f9e.3112f","name":"Turn Off Flux","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":590,"y":120,"wires":[["7b855990.840308"]]},{"id":"5a127904.ba5af8","type":"api-call-service","z":"47850f9e.3112f","name":"Turn Off Flux","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":550,"y":260,"wires":[["822e8f37.b5b81"]]},{"id":"e6bb7917.e655d8","type":"link out","z":"c3c8a381.c1927","name":"Sunset while home","links":["bfa041b7.a7587","76e9c039.9c3a6"],"x":995,"y":120,"wires":[]},{"id":"7deb9b3f.d78564","type":"inject","z":"47850f9e.3112f","name":"test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":300,"wires":[["5a127904.ba5af8"]]},{"id":"bf0a2c28.5b51f","type":"inject","z":"47850f9e.3112f","name":"test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":160,"wires":[["72d78d1e.ae3c94"]]},{"id":"1111b48b.387f5b","type":"api-current-state","z":"47850f9e.3112f","name":"TV Backlight on?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.flex_strip_105","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1010,"y":120,"wires":[["c39a8da5.a841f"],[]]},{"id":"c39a8da5.a841f","type":"api-call-service","z":"47850f9e.3112f","name":"Update TV Backlight","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.flex_strip_105","data":"{\"brightness\":255,\"kelvin\":4300}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1240,"y":120,"wires":[[]]},{"id":"173ce7e1.6879c8","type":"api-current-state","z":"47850f9e.3112f","name":"TV Backlight on?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.flex_strip_105","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":990,"y":260,"wires":[["9bcf7cfe.58306"],[]]},{"id":"9bcf7cfe.58306","type":"api-call-service","z":"47850f9e.3112f","name":"Update TV Backlight","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.flex_strip_105","data":"{\"brightness\":255,\"kelvin\":3000}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1200,"y":260,"wires":[[]]},{"id":"4cf83d44.d9b484","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/great-room/flux","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":280,"y":500,"wires":[["d915b90c.454df8"]]},{"id":"652cda22.40a244","type":"inject","z":"47850f9e.3112f","name":"test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":580,"wires":[["d915b90c.454df8"]]},{"id":"296a5d54.eae412","type":"link in","z":"47850f9e.3112f","name":"Great Room Flux","links":["165fc92b.c45ab7","2ee0772c.2d5578","d83276ce.f08da8","bf7dbf35.c8b7"],"x":215,"y":540,"wires":[["d915b90c.454df8"]]},{"id":"165fc92b.c45ab7","type":"link out","z":"abbc1f2.48c95e","name":"","links":["296a5d54.eae412","815dabf1.08cdf8","ba57a2df.7f331"],"x":435,"y":160,"wires":[]},{"id":"b9629a4f.225218","type":"debug","z":"644db6a5.3303b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":490,"y":160,"wires":[]},{"id":"64321111.9e4ec","type":"inject","z":"644db6a5.3303b8","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"detection_event\":{\"id\":443755,\"image_file_name\":\"events/annke101sd.20210129_064211911 - Copy.jpg\",\"created_at\":\"2021-01-29T15:43:49.000000Z\",\"updated_at\":\"2021-01-29T15:43:49.000000Z\",\"image_dimensions\":\"640x480\",\"occurred_at\":\"2021-01-29 15:43:49\",\"image_url\":\"http://192.168.1.96/api/events/443755/img\"},\"detection_profile\":{\"id\":12,\"created_at\":\"2020-12-29T15:37:16.000000Z\",\"updated_at\":\"2020-12-29T15:37:16.000000Z\",\"name\":\"Driveway Objects\",\"slug\":\"driveway-objects\",\"file_pattern\":\"annke101sd\",\"object_classes\":[\"person\",\"bicycle\",\"car\",\"motorcycle\",\"airplane\",\"bus\",\"train\",\"truck\",\"boat\",\"bird\",\"cat\",\"dog\",\"horse\",\"sheep\",\"cow\",\"bear\"],\"min_confidence\":\"0.45\",\"use_regex\":false,\"use_mask\":1,\"is_active\":1,\"is_enabled\":1,\"deleted_at\":null,\"is_scheduled\":0,\"start_time\":null,\"end_time\":null,\"use_smart_filter\":true,\"smart_filter_precision\":\"0.65\",\"is_negative\":false,\"automations\":[{\"id\":22,\"detection_profile_id\":12,\"automation_config_type\":\"mqtt_publish_configs\",\"automation_config_id\":2,\"created_at\":\"2020-12-29T15:38:31.000000Z\",\"updated_at\":\"2020-12-29T15:38:31.000000Z\",\"deleted_at\":null}]},\"predictions\":{\"car\":[{\"id\":407662,\"detection_event_id\":443755,\"object_class\":\"car\",\"confidence\":\"0.73\",\"x_min\":112,\"x_max\":152,\"y_min\":75,\"y_max\":148,\"created_at\":\"2021-01-29T15:43:49.000000Z\",\"updated_at\":\"2021-01-29T15:43:49.000000Z\",\"detection_profile_id\":12,\"is_masked\":0,\"is_smart_filtered\":0},{\"id\":407663,\"detection_event_id\":443755,\"object_class\":\"car\",\"confidence\":\"0.77\",\"x_min\":169,\"x_max\":269,\"y_min\":63,\"y_max\":130,\"created_at\":\"2021-01-29T15:43:49.000000Z\",\"updated_at\":\"2021-01-29T15:43:49.000000Z\",\"detection_profile_id\":12,\"is_masked\":0,\"is_smart_filtered\":0}],\"person\":[{\"id\":407664,\"detection_event_id\":443755,\"object_class\":\"person\",\"confidence\":\"0.81\",\"x_min\":289,\"x_max\":311,\"y_min\":54,\"y_max\":136,\"created_at\":\"2021-01-29T15:43:50.000000Z\",\"updated_at\":\"2021-01-29T15:43:50.000000Z\",\"detection_profile_id\":12,\"is_masked\":0,\"is_smart_filtered\":0}],\"car_filtered\":[{\"id\":407665,\"detection_event_id\":443755,\"object_class\":\"car\",\"confidence\":\"0.86\",\"x_min\":126,\"x_max\":246,\"y_min\":71,\"y_max\":190,\"created_at\":\"2021-01-29T15:43:50.000000Z\",\"updated_at\":\"2021-01-29T15:43:50.000000Z\",\"detection_profile_id\":12,\"is_masked\":0,\"is_smart_filtered\":1}],\"car_masked\":[{\"id\":407666,\"detection_event_id\":443755,\"object_class\":\"car\",\"confidence\":\"0.89\",\"x_min\":332,\"x_max\":445,\"y_min\":47,\"y_max\":109,\"created_at\":\"2021-01-29T15:43:50.000000Z\",\"updated_at\":\"2021-01-29T15:43:50.000000Z\",\"detection_profile_id\":12,\"is_masked\":1,\"is_smart_filtered\":0}]}}","payloadType":"json","x":150,"y":160,"wires":[["b9629a4f.225218"]]},{"id":"a7b00f86.547e6","type":"inject","z":"75ccec5b.f7e364","name":"","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","x":170,"y":200,"wires":[["9d3b806a.93078"]]},{"id":"66e3abc7.fb91e4","type":"api-current-state","z":"75ccec5b.f7e364","name":"Kaitlyn Home","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"home","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.kaitlyn","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":550,"y":440,"wires":[["1799472a.c30f49"],[]]},{"id":"1799472a.c30f49","type":"link out","z":"75ccec5b.f7e364","name":"","links":["27e3490c.d6d6b6"],"x":675,"y":440,"wires":[]},{"id":"842ed01a.96edb","type":"switch","z":"dbd2ebf4.b8f648","name":"Night Shift?","property":"night_shift","propertyType":"global","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":600,"wires":[["cb03a92b.e9cf28"]]},{"id":"cb03a92b.e9cf28","type":"link out","z":"dbd2ebf4.b8f648","name":"Kaitlyn Arrives Home","links":["27e3490c.d6d6b6"],"x":635,"y":600,"wires":[]},{"id":"8acff23.019581","type":"api-call-service","z":"6ce2b51b.d6eccc","name":"Turn on screen","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"man_cave_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"screenOn\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":160,"wires":[["bb9c4e42.89a5f"]]},{"id":"19c258fe.7ce2d7","type":"link in","z":"6ce2b51b.d6eccc","name":"Action: Show Cameras","links":["31a3a1b8.8e941e","80cabe41.f92be"],"x":435,"y":200,"wires":[["8acff23.019581"]]},{"id":"13a18c06.8aa544","type":"inject","z":"6ce2b51b.d6eccc","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":120,"wires":[["8acff23.019581"]]},{"id":"76b4a2fa.3831bc","type":"mqtt in","z":"6ce2b51b.d6eccc","name":"","topic":"/hass/kiosk/man-cave-tablet/show-cameras","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":320,"y":160,"wires":[["8acff23.019581"]]},{"id":"bb9c4e42.89a5f","type":"api-call-service","z":"6ce2b51b.d6eccc","name":"Bring app to foreground","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"man_cave_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"toForeground\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":870,"y":160,"wires":[["f4113049.88817"]]},{"id":"f4113049.88817","type":"api-call-service","z":"6ce2b51b.d6eccc","name":"Navigate","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"man_cave_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"loadURL\", \"url\":\"http://192.168.1.53:8123/man-cave-tablet/cameras\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1120,"y":160,"wires":[[]]},{"id":"80cabe41.f92be","type":"link out","z":"dbd2ebf4.b8f648","name":"","links":["19c258fe.7ce2d7"],"x":435,"y":660,"wires":[]},{"id":"60cd4663.653fc8","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":140,"wires":[["ada02dc4.f166b"]]},{"id":"b5fbdc0f.77d94","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/toggle-screensaver","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":200,"y":180,"wires":[["ada02dc4.f166b"]]},{"id":"14702956.6f8747","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Toggle Screensaver","links":[],"x":315,"y":220,"wires":[["ada02dc4.f166b"]]},{"id":"4c5c49f7.334f18","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.wall_tablet_screensaver","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1240,"y":440,"wires":[[]]},{"id":"795303f6.14568c","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.wall_tablet_screensaver","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1220,"y":300,"wires":[[]]},{"id":"ada02dc4.f166b","type":"api-current-state","z":"2ef67aae.d4bfe6","name":"Screensaver On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.wall_tablet_screensaver","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":490,"y":180,"wires":[["26e1f4da.58193c"],["7a6207f2.8103c8"]]},{"id":"26e1f4da.58193c","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["b9c2ea8c.8fbb98"],"x":615,"y":160,"wires":[]},{"id":"7a6207f2.8103c8","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["e2dce7a5.8969b8"],"x":615,"y":200,"wires":[]},{"id":"2c90d7f7.e46d98","type":"api-render-template","z":"f7e7a8ac.19a538","name":"Kitchen Dark? (True/False)","server":"a86c4410.e2a568","template":"{{ state_attr('sensor.hue_100_lux', 'dark') }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":640,"y":940,"wires":[["45d86be4.0c4e34"]]},{"id":"45d86be4.0c4e34","type":"switch","z":"f7e7a8ac.19a538","name":"True?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":850,"y":940,"wires":[["ba9c5dbe.a2924"]]},{"id":"ba9c5dbe.a2924","type":"api-current-state","z":"f7e7a8ac.19a538","name":"Ledge Strips off?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.ledge_strips_deconz","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1030,"y":940,"wires":[["1b08859c.1cac5a"],[]]},{"id":"1b08859c.1cac5a","type":"api-call-service","z":"f7e7a8ac.19a538","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.flex_strip_110","data":"{\"brightness\":255,\"kelvin\":\"{{ global.circadian_kelvin }}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1230,"y":940,"wires":[[]]},{"id":"83179bb5.2b2f48","type":"inject","z":"f7e7a8ac.19a538","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":390,"y":940,"wires":[["2c90d7f7.e46d98"]]},{"id":"219a4164.2fa7de","type":"delay","z":"f7e7a8ac.19a538","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":560,"y":1160,"wires":[["2f8f04fb.7ff86c"]]},{"id":"2f8f04fb.7ff86c","type":"api-current-state","z":"f7e7a8ac.19a538","name":"Kitchen Lights Off?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"group.kitchen_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":770,"y":1160,"wires":[["db451f88.0559e"],[]]},{"id":"db451f88.0559e","type":"api-current-state","z":"f7e7a8ac.19a538","name":"Kitchen Ledge On?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.flex_strip_110","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":970,"y":1160,"wires":[["94ae60b5.41692"],[]]},{"id":"94ae60b5.41692","type":"api-current-state","z":"f7e7a8ac.19a538","name":"Other Ledge Off?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.flex_strip_104","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1170,"y":1160,"wires":[["a9456191.08a25"],[]]},{"id":"a9456191.08a25","type":"api-call-service","z":"f7e7a8ac.19a538","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.flex_strip_110","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1370,"y":1160,"wires":[[]]},{"id":"3b5a4d22.e80df2","type":"inject","z":"f7e7a8ac.19a538","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":560,"y":1220,"wires":[["2f8f04fb.7ff86c"]]},{"id":"232bb4d0.c4817c","type":"link out","z":"dbd2ebf4.b8f648","name":"","links":["eb9805e6.cdcc88"],"x":1075,"y":540,"wires":[]},{"id":"e3dd58be.f8fad8","type":"debug","z":"c6727c1e.1d54f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":370,"y":260,"wires":[]},{"id":"cd290726.8e73a8","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/presence/garage-car/on","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":280,"y":260,"wires":[["4ba26dfd.83f214"]]},{"id":"c2d88f8d.b113d","type":"comment","z":"d390bbbb.863388","name":"","info":"could make a node to trigger a camera to refresh the sensor","x":500,"y":160,"wires":[]},{"id":"edf6e07b.87fa7","type":"ha-entity","z":"d390bbbb.863388","name":"ai_garage_car_occupancy","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"AI Garage Car Occupancy"},{"property":"device_class","value":"occupancy"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":940,"y":260,"wires":[[]]},{"id":"4ba26dfd.83f214","type":"change","z":"d390bbbb.863388","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":260,"wires":[["edf6e07b.87fa7"]]},{"id":"3e8dee1e.4dd972","type":"change","z":"d390bbbb.863388","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":320,"wires":[["edf6e07b.87fa7"]]},{"id":"bfed6d99.8219d","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/presence/garage-car/off","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":280,"y":320,"wires":[["3e8dee1e.4dd972"]]},{"id":"553a9a93.c8fd34","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/presence/great-room-person/on","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":310,"y":420,"wires":[["62964969.b5d8c8"]]},{"id":"62964969.b5d8c8","type":"trigger","z":"d390bbbb.863388","name":"","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"120","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":570,"y":420,"wires":[["29345937.9d8f16","d1ef34aa.ad4c28"],["29345937.9d8f16"]]},{"id":"29345937.9d8f16","type":"ha-entity","z":"d390bbbb.863388","name":"ai_great_room_person_occupancy","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"AI Great Room Person Occupancy"},{"property":"device_class","value":"occupancy"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":820,"y":420,"wires":[["fb903ff5.f04cf"]]},{"id":"d1ef34aa.ad4c28","type":"link out","z":"d390bbbb.863388","name":"Great Room Person Presence On","links":["e7ae0e8a.9355e"],"x":695,"y":380,"wires":[]},{"id":"e7ae0e8a.9355e","type":"link in","z":"f7e7a8ac.19a538","name":"Set Home Mode (4AM-8PM)","links":["d1ef34aa.ad4c28","716f2c7d.14c4a4"],"x":395,"y":300,"wires":[["85a20790.d82f38"]]},{"id":"63396b44.6708c4","type":"inject","z":"d390bbbb.863388","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":420,"y":380,"wires":[["62964969.b5d8c8"]]},{"id":"8a57290e.31b138","type":"link out","z":"a5e69210.f37a9","name":"","links":["b4293cc0.6613f"],"x":1275,"y":360,"wires":[]},{"id":"4f6dfd44.3fa9c4","type":"http request","z":"644db6a5.3303b8","name":"Last Watch - Great Room Person","method":"PUT","ret":"txt","paytoqs":"ignore","url":"http://192.168.1.96/api/profiles/great-room-person-hd/status","tls":"","persist":false,"proxy":"","authType":"","x":560,"y":800,"wires":[[]]},{"id":"32cfefe9.89b4a","type":"change","z":"644db6a5.3303b8","name":"Enable","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"status\": \"enabled\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":800,"wires":[["4f6dfd44.3fa9c4"]]},{"id":"bc7b4583.f65898","type":"link in","z":"644db6a5.3303b8","name":"Enable Great Room Person Profile","links":[],"x":135,"y":800,"wires":[["32cfefe9.89b4a"]]},{"id":"3c3932da.8cfa4e","type":"change","z":"644db6a5.3303b8","name":"Disable","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"status\": \"disabled\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":860,"wires":[["4f6dfd44.3fa9c4"]]},{"id":"460e399e.bc6808","type":"link in","z":"644db6a5.3303b8","name":"Disable Great Room Person Profile","links":[],"x":135,"y":860,"wires":[["3c3932da.8cfa4e"]]},{"id":"36b0ec66.2e6be4","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/presence/driveway-person/on","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":300,"y":540,"wires":[["239f6e8.e390492"]]},{"id":"239f6e8.e390492","type":"trigger","z":"d390bbbb.863388","name":"","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"120","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":610,"y":540,"wires":[["4d15e4f3.ecb27c"],["4d15e4f3.ecb27c"]]},{"id":"4d15e4f3.ecb27c","type":"ha-entity","z":"d390bbbb.863388","name":"ai_driveway_person_occupancy","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"AI Driveway Person Occupancy"},{"property":"device_class","value":"occupancy"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":850,"y":540,"wires":[["d00131ca.b790a"]]},{"id":"9140a55a.e3a738","type":"inject","z":"d390bbbb.863388","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":500,"wires":[["239f6e8.e390492"]]},{"id":"311d02e4.756ace","type":"link in","z":"b0806f39.3a32c","name":"","links":["d00131ca.b790a","4bb32fb6.71c5e"],"x":125,"y":160,"wires":[["cdf958f6.655a78"]]},{"id":"7bcac3ef.0cd94c","type":"trigger","z":"b0806f39.3a32c","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"overrideDelay":false,"units":"ms","reset":"0","bytopic":"all","topic":"topic","outputs":1,"x":780,"y":160,"wires":[["ff5d2584.3d2d48"]]},{"id":"991ff06d.5bc39","type":"trigger","z":"b0806f39.3a32c","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"2","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":620,"y":220,"wires":[["7bcac3ef.0cd94c","7c9e47c0.609168"]]},{"id":"cad92c58.5af15","type":"switch","z":"b0806f39.3a32c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":160,"wires":[["7bcac3ef.0cd94c"],["991ff06d.5bc39"]]},{"id":"fb903ff5.f04cf","type":"link out","z":"d390bbbb.863388","name":"Great Room Person Presence","links":[],"x":1015,"y":420,"wires":[]},{"id":"d00131ca.b790a","type":"link out","z":"d390bbbb.863388","name":"Driveway Person Presence","links":["311d02e4.756ace","e8cf491f.ceb3d8"],"x":1035,"y":540,"wires":[]},{"id":"ff5d2584.3d2d48","type":"link out","z":"b0806f39.3a32c","name":"","links":["29634c14.8236c4"],"x":915,"y":160,"wires":[]},{"id":"ff6ea1e0.84b31","type":"api-call-service","z":"47850f9e.3112f","name":"Turn On Kitchen Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.cabinet_lights, switch.bar_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":540,"y":960,"wires":[["7709b6eb.bbae18"]]},{"id":"7709b6eb.bbae18","type":"api-call-service","z":"47850f9e.3112f","name":"Turn On Kitchen Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.kitchen_table_lights","data":"{\"brightness\":64}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":760,"y":960,"wires":[[]]},{"id":"29634c14.8236c4","type":"link in","z":"47850f9e.3112f","name":"Kitchen On","links":["ff5d2584.3d2d48"],"x":375,"y":1000,"wires":[["ff6ea1e0.84b31"]]},{"id":"1f1f36c4.67a4d9","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/kitchen/on","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":240,"y":960,"wires":[["ff6ea1e0.84b31"]]},{"id":"14d11246.46163e","type":"inject","z":"47850f9e.3112f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":1040,"wires":[["ff6ea1e0.84b31"]]},{"id":"b1c8ef7f.1a9f2","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/presence/driveway-car/on","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":330,"y":660,"wires":[["5355e87d.637ff8"]]},{"id":"dcc65b42.c526c8","type":"ha-entity","z":"d390bbbb.863388","name":"ai_driveway_car_occupancy","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"AI Driveway Car Occupancy"},{"property":"device_class","value":"occupancy"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1080,"y":660,"wires":[["223dcef1.1b2622"]]},{"id":"5355e87d.637ff8","type":"change","z":"d390bbbb.863388","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":660,"wires":[["9387f8d0.1d46e8","dcc65b42.c526c8"]]},{"id":"2fadad41.4d0592","type":"change","z":"d390bbbb.863388","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":720,"wires":[["9387f8d0.1d46e8","2a23eb7.412ba14"]]},{"id":"c7136f78.0f15","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/presence/driveway-car/off","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":330,"y":720,"wires":[["2fadad41.4d0592"]]},{"id":"b66b976e.2d58e8","type":"link out","z":"d390bbbb.863388","name":"Driveway Car Presence","links":["81289dc1.32fa5","cbcd22e4.c090c","c6035139.242ca"],"x":1455,"y":660,"wires":[]},{"id":"223dcef1.1b2622","type":"trigger","z":"d390bbbb.863388","name":"","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"0","extend":false,"overrideDelay":false,"units":"ms","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":1330,"y":660,"wires":[["b66b976e.2d58e8"]]},{"id":"cbcd22e4.c090c","type":"link in","z":"b0806f39.3a32c","name":"","links":["b66b976e.2d58e8","c4b221f8.dd6c7"],"x":195,"y":440,"wires":[["2a30f639.bbff2a"]]},{"id":"c0678b1c.b46318","type":"switch","z":"b0806f39.3a32c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":440,"wires":[["2ee0772c.2d5578"],[]]},{"id":"2ee0772c.2d5578","type":"link out","z":"b0806f39.3a32c","name":"","links":["296a5d54.eae412","6eef592f.b005f8"],"x":615,"y":420,"wires":[]},{"id":"7c9e47c0.609168","type":"api-current-state","z":"b0806f39.3a32c","name":"Driveway Car Present?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.driveway_car_presence","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":830,"y":220,"wires":[[],["5759d400.d112dc"]]},{"id":"5759d400.d112dc","type":"api-call-service","z":"b0806f39.3a32c","name":"Turn Kitchen Lights Off","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"homeassistant","service":"turn_off","entityId":"group.kitchen_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1100,"y":220,"wires":[[]]},{"id":"ee1bfb3b.a7f628","type":"comment","z":"b0806f39.3a32c","name":"person in driveway - turn on kitchen lights for 2 hours","info":"","x":440,"y":100,"wires":[]},{"id":"aaaa4c94.9ca98","type":"comment","z":"b0806f39.3a32c","name":"person in driveway - dont turn off kitchen lights if theres a car in the driveway","info":"","x":850,"y":280,"wires":[]},{"id":"1ccffac9.540cb5","type":"comment","z":"b0806f39.3a32c","name":"car arrives - turn on great room lights","info":"","x":410,"y":380,"wires":[]},{"id":"a2dd27af.fdb128","type":"comment","z":"b0806f39.3a32c","name":"car leaves - turn off indoor lights","info":"","x":390,"y":500,"wires":[]},{"id":"cd9a6a7f.8ff098","type":"comment","z":"b0806f39.3a32c","name":"Door unlocked - send message","info":"","x":410,"y":640,"wires":[]},{"id":"9387f8d0.1d46e8","type":"trigger","z":"d390bbbb.863388","name":"","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"2","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":810,"y":720,"wires":[["dcc65b42.c526c8"]]},{"id":"f824ecf0.57a8b","type":"http request","z":"4bc9cecd.d3884","name":"Trigger annke101hd_clone","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.1.31:81/admin?trigger&camera=annke101hd_clone&user=admin&pw={{{bi_password}}}","tls":"","persist":false,"proxy":"","authType":"","x":660,"y":220,"wires":[[]]},{"id":"8571f532.301888","type":"credentials","z":"4bc9cecd.d3884","name":"","props":[{"value":"bi_password","type":"flow"},{"value":"bi_username","type":"flow"},{"value":"bi_url","type":"flow"}],"x":390,"y":120,"wires":[[]]},{"id":"ee4e93fd.ad21f","type":"inject","z":"4bc9cecd.d3884","name":"Startup","props":[],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":220,"y":120,"wires":[["8571f532.301888"]]},{"id":"eb186279.18e0a","type":"link in","z":"4bc9cecd.d3884","name":"Trigger annke101hd_clone","links":["55bdcf0e.28b0d"],"x":255,"y":220,"wires":[["5c3089df.429688"]]},{"id":"55bdcf0e.28b0d","type":"link out","z":"d390bbbb.863388","name":"","links":["eb186279.18e0a"],"x":915,"y":780,"wires":[]},{"id":"2a23eb7.412ba14","type":"trigger","z":"d390bbbb.863388","name":"","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"1","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":810,"y":780,"wires":[["55bdcf0e.28b0d"]]},{"id":"5c3089df.429688","type":"change","z":"4bc9cecd.d3884","name":"","rules":[{"t":"set","p":"bi_password","pt":"msg","to":"bi_password","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":220,"wires":[["f824ecf0.57a8b"]]},{"id":"d903eb6c.ee2318","type":"comment","z":"d390bbbb.863388","name":"Re-trigger camera to check for car presence again","info":"","x":930,"y":820,"wires":[]},{"id":"de461db0.a14ff","type":"switch","z":"c3c8a381.c1927","name":"IF (VACATION, SUNSET)","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"topic = \"sun.sun\" and $globalContext('automation_mode') = \"vacation\" and payload = \"below_horizon\"","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":80,"wires":[["52166b5b.b4f2c4","d9cfbe8d.f6c8b"]]},{"id":"2022ff29.3fa27","type":"link in","z":"47850f9e.3112f","name":"House - vacation","links":["52166b5b.b4f2c4"],"x":215,"y":400,"wires":[["1951e52b.a8437b"]]},{"id":"c71876f6.7f5f48","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/house/vacation","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":280,"y":360,"wires":[["1951e52b.a8437b"]]},{"id":"42cd1d50.a904a4","type":"inject","z":"47850f9e.3112f","name":"test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":440,"wires":[["1951e52b.a8437b"]]},{"id":"1951e52b.a8437b","type":"api-call-service","z":"47850f9e.3112f","name":"Turn On Kitchen Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.kitchen_table_lights","data":"{\"brightness\":64}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":600,"y":420,"wires":[["cad61bea.f9eb98"]]},{"id":"cad61bea.f9eb98","type":"api-call-service","z":"47850f9e.3112f","name":"Turn on garage lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.ikea_outlet_101","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":820,"y":420,"wires":[["bf7dbf35.c8b7"]]},{"id":"d915b90c.454df8","type":"api-call-service","z":"47850f9e.3112f","name":"Great Room On","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ledge_strips_deconz, light.living_room_lamps_deconz","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":540,"wires":[["72794add.42ae74"]]},{"id":"72794add.42ae74","type":"api-call-service","z":"47850f9e.3112f","name":"Turn On Flux","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":810,"y":540,"wires":[[]]},{"id":"bf7dbf35.c8b7","type":"link out","z":"47850f9e.3112f","name":"","links":["296a5d54.eae412","6eef592f.b005f8"],"x":955,"y":420,"wires":[]},{"id":"52166b5b.b4f2c4","type":"link out","z":"c3c8a381.c1927","name":"","links":["2022ff29.3fa27"],"x":995,"y":80,"wires":[]},{"id":"3f6b787b.1dcc68","type":"switch","z":"c3c8a381.c1927","name":"IF (VACATION, 12AM)","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"topic = \"sensor.time\" and payload = \"00:00\" and $globalContext('automation_mode') = \"vacation\"","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":400,"wires":[["377ac75d.560438"]]},{"id":"377ac75d.560438","type":"api-call-service","z":"c3c8a381.c1927","name":"Lights Script","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"script","service":"lighting_scene_sleep_mode","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1050,"y":400,"wires":[[]]},{"id":"971eff7a.94004","type":"trigger-state","z":"b0806f39.3a32c","name":"Front Door Unlock","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"lock.assa_abloy_yale_push_button_deadbolt_yrd210_101_locked","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"unlocked","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":270,"y":700,"wires":[["3f910f94.6b9ac"],[]]},{"id":"c1ce423f.e11f8","type":"link out","z":"b0806f39.3a32c","name":"","links":["1491a482.9c6e2b"],"x":575,"y":700,"wires":[]},{"id":"3f910f94.6b9ac","type":"switch","z":"b0806f39.3a32c","name":"vacation","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"vacation","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":460,"y":700,"wires":[["c1ce423f.e11f8"]]},{"id":"6d666079.02f98","type":"link out","z":"b0806f39.3a32c","name":"","links":["2a0c4381.f97c2c"],"x":655,"y":820,"wires":[]},{"id":"52d75c2a.57b7a4","type":"switch","z":"b0806f39.3a32c","name":"","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"vacation","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":820,"wires":[["6d666079.02f98"]]},{"id":"48bd4c57.ac2974","type":"trigger-state","z":"b0806f39.3a32c","d":true,"name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.front_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"previous_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"old_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":330,"y":820,"wires":[["52d75c2a.57b7a4"],[]]},{"id":"ae81639f.429ee","type":"trigger-state","z":"b0806f39.3a32c","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.back_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":330,"y":880,"wires":[["3d76082d.048fa8"],[]]},{"id":"3d76082d.048fa8","type":"switch","z":"b0806f39.3a32c","name":"","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"vacation","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":880,"wires":[["81642025.a4a0a"]]},{"id":"81642025.a4a0a","type":"link out","z":"b0806f39.3a32c","name":"","links":["e072fb0b.81dc48"],"x":655,"y":880,"wires":[]},{"id":"a5c30bfd.f77cf8","type":"trigger-state","z":"b0806f39.3a32c","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.garage_entrance_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":370,"y":940,"wires":[["2c11fe7f.9d3992"],[]]},{"id":"2c11fe7f.9d3992","type":"switch","z":"b0806f39.3a32c","name":"","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"vacation","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":670,"y":940,"wires":[["1968d322.5b5bad"]]},{"id":"1968d322.5b5bad","type":"link out","z":"b0806f39.3a32c","name":"","links":["68d21224.d3cbdc"],"x":775,"y":940,"wires":[]},{"id":"24ec76e.4456e8a","type":"trigger-state","z":"b0806f39.3a32c","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.garage_ext_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"l750zhi0ls","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"fq4xu70oqn","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":350,"y":1000,"wires":[["1b26a8a9.dd3437"],[]]},{"id":"1b26a8a9.dd3437","type":"switch","z":"b0806f39.3a32c","name":"","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"vacation","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":610,"y":1000,"wires":[["145cd41b.5511fc"]]},{"id":"145cd41b.5511fc","type":"link out","z":"b0806f39.3a32c","name":"","links":["6bfb8c52.dffd74"],"x":715,"y":1000,"wires":[]},{"id":"2a30f639.bbff2a","type":"switch","z":"b0806f39.3a32c","name":"vacation","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"vacation","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":320,"y":440,"wires":[["c0678b1c.b46318"]]},{"id":"80ea63a5.b7559","type":"link out","z":"a5e69210.f37a9","name":"","links":[],"x":1275,"y":160,"wires":[]},{"id":"2da987f2.586298","type":"link out","z":"a5e69210.f37a9","name":"","links":["f498ff5d.3a8d5"],"x":895,"y":1040,"wires":[]},{"id":"cdf958f6.655a78","type":"switch","z":"b0806f39.3a32c","name":"vacation","property":"automation_mode","propertyType":"global","rules":[{"t":"eq","v":"vacation","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":260,"y":160,"wires":[["cad92c58.5af15"]]},{"id":"b2486600.5d4d58","type":"server-events","z":"644db6a5.3303b8","name":"Folder Watcher Event","server":"a86c4410.e2a568","event_type":"folder_watcher","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"x":200,"y":1340,"wires":[["e5863ecc.68c6c"]]},{"id":"e5863ecc.68c6c","type":"switch","z":"644db6a5.3303b8","name":"Filter \"modified\" events","property":"payload.event.event_type","propertyType":"msg","rules":[{"t":"eq","v":"modified","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":420,"y":1340,"wires":[["42051c2c.54d954"]]},{"id":"42051c2c.54d954","type":"switch","z":"644db6a5.3303b8","name":"AI Profile Name","property":"payload.event.file","propertyType":"msg","rules":[{"t":"eq","v":"driveway-person-4k.jpg","vt":"str"},{"t":"eq","v":"driveway-vehicle-4k.jpg","vt":"str"},{"t":"eq","v":"doorbell-person-hd.jpg","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":620,"y":1340,"wires":[["9b7b21d9.703c6"],["9b617573.d3db98"],["207af7fa.d77048"]]},{"id":"9b7b21d9.703c6","type":"api-call-service","z":"644db6a5.3303b8","d":true,"name":"Android Notification - Person in Driveway","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"title\":\"Person in Driveway!\",\"message\":\"Person dectected in the driveway.\",\"data\":{\"tag\":\"driveway_person_alert\",\"image\":\"local/images/ai_alerts/driveway-person-4k.jpg\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":900,"y":1280,"wires":[[]]},{"id":"9b617573.d3db98","type":"api-call-service","z":"644db6a5.3303b8","d":true,"name":"Android Notification - Car in Driveway","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"title\":\"Car in Driveway!\",\"message\":\"Car detected in the driveway.\",\"data\":{\"tag\":\"driveway_var_alert\",\"image\":\"local/images/ai_alerts/driveway-vehicle-4k.jpg\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":890,"y":1340,"wires":[[]]},{"id":"65480f88.ca985","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/great-room/ledge-flux","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":300,"y":640,"wires":[["11a7b3c7.afde5c"]]},{"id":"9c28509f.ef98f","type":"inject","z":"47850f9e.3112f","name":"test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":720,"wires":[["11a7b3c7.afde5c"]]},{"id":"11a7b3c7.afde5c","type":"api-call-service","z":"47850f9e.3112f","name":"Great Room On","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ledge_strips_deconz","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":680,"wires":[["cb688e8.f004c7"]]},{"id":"cb688e8.f004c7","type":"api-call-service","z":"47850f9e.3112f","name":"Turn On Flux","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":810,"y":680,"wires":[[]]},{"id":"b4293cc0.6613f","type":"link in","z":"47850f9e.3112f","name":"Great Room - Ledge Flux","links":["8a57290e.31b138"],"x":175,"y":680,"wires":[["11a7b3c7.afde5c"]]},{"id":"e081f04d.a83cb","type":"mqtt in","z":"644db6a5.3303b8","name":"","topic":"mqtt/lastwatch/test","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":130,"y":700,"wires":[["1bb21fed.6e104"]]},{"id":"d5911028.847eb","type":"debug","z":"644db6a5.3303b8","name":"debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":450,"y":700,"wires":[]},{"id":"1bb21fed.6e104","type":"json","z":"644db6a5.3303b8","name":"Parse Json","property":"payload","action":"","pretty":false,"x":310,"y":700,"wires":[["d5911028.847eb"]]},{"id":"28d33856.694228","type":"link in","z":"b388976.2f76968","name":"Away Mode Armed? Trigger Alarm","links":["68ab0362.f0411c","e8cdfa36.6a7948","74d8020.5e9a9","4a5fc4b4.2228ac","4ead004f.872cf","2653eeff.d1e6e2","e4f6e578.d96a68","a0fae351.bccb3","116ada85.59a5c5","5bccb861.601758"],"x":855,"y":320,"wires":[["81b988da.d3efd8"]]},{"id":"d6b5adcc.2a27","type":"link in","z":"b388976.2f76968","name":"Night Mode Armed? Trigger Alarm","links":["68ab0362.f0411c","e8cdfa36.6a7948","74d8020.5e9a9","4a5fc4b4.2228ac","4ead004f.872cf","2653eeff.d1e6e2","e4f6e578.d96a68","a0fae351.bccb3","116ada85.59a5c5","5bccb861.601758"],"x":855,"y":380,"wires":[["37053882.5bc388"]]},{"id":"3ad76d79.37db92","type":"link in","z":"b388976.2f76968","name":"Home Mode Armed? Trigger Alarm","links":["68ab0362.f0411c","e8cdfa36.6a7948","74d8020.5e9a9","4a5fc4b4.2228ac","4ead004f.872cf","2653eeff.d1e6e2","e4f6e578.d96a68","a0fae351.bccb3","116ada85.59a5c5","5bccb861.601758"],"x":855,"y":440,"wires":[["e4bdd866.8c7a28"]]},{"id":"4a5fc4b4.2228ac","type":"link out","z":"b388976.2f76968","name":"Garage External Door Opened","links":["28d33856.694228","2a0c4381.f97c2c","3ad76d79.37db92","d6b5adcc.2a27"],"x":595,"y":360,"wires":[]},{"id":"4ead004f.872cf","type":"link out","z":"b388976.2f76968","name":"Front Bedroom Window Opened","links":["28d33856.694228","3ad76d79.37db92","5ef2d578.6f6e6c","d6b5adcc.2a27"],"x":635,"y":460,"wires":[]},{"id":"2653eeff.d1e6e2","type":"link out","z":"b388976.2f76968","name":"Rear Bedroom Window Opened","links":["28d33856.694228","3ad76d79.37db92","5ef2d578.6f6e6c","d6b5adcc.2a27"],"x":635,"y":560,"wires":[]},{"id":"e4f6e578.d96a68","type":"link out","z":"b388976.2f76968","name":"Master Bedroom Window Opened","links":["28d33856.694228","3ad76d79.37db92","5ef2d578.6f6e6c","d6b5adcc.2a27"],"x":655,"y":660,"wires":[]},{"id":"a0fae351.bccb3","type":"link out","z":"b388976.2f76968","name":"Back Office Windows Opened","links":["28d33856.694228","3ad76d79.37db92","5ef2d578.6f6e6c","d6b5adcc.2a27"],"x":655,"y":760,"wires":[]},{"id":"116ada85.59a5c5","type":"link out","z":"b388976.2f76968","name":"Garage Windows Opened","links":["28d33856.694228","3ad76d79.37db92","5ef2d578.6f6e6c","d6b5adcc.2a27"],"x":615,"y":860,"wires":[]},{"id":"5bccb861.601758","type":"link out","z":"b388976.2f76968","name":"Kitchen Windows Opened","links":["28d33856.694228","3ad76d79.37db92","5ef2d578.6f6e6c","d6b5adcc.2a27"],"x":615,"y":960,"wires":[]},{"id":"ede6371e.64bda8","type":"trigger-state","z":"b388976.2f76968","name":"Front Door Unlock","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"lock.assa_abloy_yale_push_button_deadbolt_yrd210_101_locked","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"unlocked","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":1090,"y":540,"wires":[["99f4b97b.0ec628"],["cc006224.b6a76"]]},{"id":"2d69e704.bf2258","type":"link out","z":"b388976.2f76968","name":"Front Door Closed","links":["240ff702.8ebc88"],"x":595,"y":140,"wires":[]},{"id":"df3dac5c.0dc28","type":"link out","z":"b388976.2f76968","name":"Back Door Closed","links":["240ff702.8ebc88"],"x":595,"y":220,"wires":[]},{"id":"600a62b6.75fabc","type":"link out","z":"b388976.2f76968","name":"Garage Entrance Door Closed","links":["240ff702.8ebc88"],"x":635,"y":300,"wires":[]},{"id":"657c104a.918d4","type":"link out","z":"b388976.2f76968","name":"Garage External Door Closed","links":["240ff702.8ebc88"],"x":595,"y":400,"wires":[]},{"id":"605d35bb.79602c","type":"link out","z":"b388976.2f76968","name":"Front Bedroom Window Closed","links":["3da53769.3a9388"],"x":635,"y":500,"wires":[]},{"id":"eed8474d.3ccde8","type":"link out","z":"b388976.2f76968","name":"Rear Bedroom Window Closed","links":["3da53769.3a9388"],"x":635,"y":600,"wires":[]},{"id":"62b0311e.bbc8d","type":"link out","z":"b388976.2f76968","name":"Master Bedroom Window Closed","links":["3da53769.3a9388"],"x":655,"y":700,"wires":[]},{"id":"5dca23fa.3b08ec","type":"link out","z":"b388976.2f76968","name":"Back Office Windows Closed","links":["3da53769.3a9388"],"x":655,"y":800,"wires":[]},{"id":"f9b84beb.942e28","type":"link out","z":"b388976.2f76968","name":"Garage Windows Closed","links":["3da53769.3a9388"],"x":615,"y":900,"wires":[]},{"id":"1e8af0a9.c5a04f","type":"link out","z":"b388976.2f76968","name":"Kitchen Windows Closed","links":["3da53769.3a9388"],"x":615,"y":1000,"wires":[]},{"id":"99f4b97b.0ec628","type":"link out","z":"b388976.2f76968","name":"Front Door Unlocked","links":["19903d24.41aa63"],"x":1215,"y":520,"wires":[]},{"id":"cc006224.b6a76","type":"link out","z":"b388976.2f76968","name":"Front Door Locked","links":["2310a571.02ee6a"],"x":1215,"y":560,"wires":[]},{"id":"590b5c0b.7eca44","type":"trigger-state","z":"b388976.2f76968","name":"Garage Entrance Door Unlocked","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"lock.assa_abloy_yale_push_button_deadbolt_yrd210_102_locked","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"unlocked","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":1130,"y":640,"wires":[["be1812cf.78047"],["1ec0e6b0.b52609"]]},{"id":"be1812cf.78047","type":"link out","z":"b388976.2f76968","name":"Garage Entrance Door Unlocked","links":["19903d24.41aa63"],"x":1295,"y":620,"wires":[]},{"id":"1ec0e6b0.b52609","type":"link out","z":"b388976.2f76968","name":"Garage Entrance Door Locked","links":["2310a571.02ee6a"],"x":1295,"y":660,"wires":[]},{"id":"7f7da07b.65229","type":"server-state-changed","z":"d0661cff.7e5c6","name":"","server":"a86c4410.e2a568","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.hue_105_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":280,"y":400,"wires":[["f8b44983.889818","e5cad13b.177e6","52e9485f.9b2758"],["e34ac367.9c691"]]},{"id":"1295a71f.7eb549","type":"http request","z":"4bc9cecd.d3884","name":"Trigger eufy101","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.1.31:81/admin?trigger&camera=eufy101&user=admin&pw={{{bi_password}}}","tls":"","persist":false,"proxy":"","authType":"","x":620,"y":280,"wires":[[]]},{"id":"52c62552.3c117c","type":"link in","z":"4bc9cecd.d3884","name":"Trigger eufy101","links":["5b9cba14.a36b44"],"x":255,"y":280,"wires":[["3437b4e9.93f57c"]]},{"id":"3437b4e9.93f57c","type":"change","z":"4bc9cecd.d3884","name":"","rules":[{"t":"set","p":"bi_password","pt":"msg","to":"bi_password","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":280,"wires":[["1295a71f.7eb549"]]},{"id":"818853dd.40f75","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/presence/garage/person","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":310,"y":1180,"wires":[["69f4b17.a09e95"]]},{"id":"e00292de.abaad","type":"ha-entity","z":"d390bbbb.863388","name":"ai_garage_person_occupancy","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"AI Garage Person Presence"},{"property":"device_class","value":"occupancy"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":850,"y":1180,"wires":[[]]},{"id":"69f4b17.a09e95","type":"trigger","z":"d390bbbb.863388","name":"","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"120","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":570,"y":1180,"wires":[["e00292de.abaad"],["e00292de.abaad"]]},{"id":"8d6f5dc0.223","type":"inject","z":"d390bbbb.863388","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":600,"y":1280,"wires":[["e00292de.abaad"]]},{"id":"6b1f157e.c85e8c","type":"inject","z":"d390bbbb.863388","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":590,"y":1240,"wires":[["e00292de.abaad"]]},{"id":"d90045ca.d40278","type":"credentials","z":"7acad338.91f38c","name":"","props":[{"value":"chat_id","type":"flow"},{"value":"token","type":"flow"},{"value":"kiosk_photo_url","type":"flow"},{"value":"","type":"msg"}],"x":310,"y":60,"wires":[[]]},{"id":"805221bf.62544","type":"inject","z":"7acad338.91f38c","name":"","props":[],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payloadType":"str","x":120,"y":60,"wires":[["d90045ca.d40278"]]},{"id":"24d7a09b.65081","type":"link in","z":"7acad338.91f38c","name":"Telegram Notification - Alarm Pending","links":["b9ebbf01.9759a"],"x":195,"y":160,"wires":[["1709a4dc.eadb2b"]]},{"id":"98783b59.ad1f38","type":"link in","z":"7acad338.91f38c","name":"","links":["d37d2e76.85f7f","181c3f46.b81061","6b609e49.31ff1","fbfc5c72.b3024","f0b061a7.a9631","67c8a0b2.544c1","4a5ef5df.0418ec","b72d1cfc.d4a88","cae095e3.a561a8","84a22d32.30d97","ade2cdd8.302d6","b0ae6b83.e7cb68","dcc0f844.c14818","c491aaf5.ff00c8","ff1a6b21.77bdf8","d9957cce.5ca98","43b5bea7.ad49d","764fa50f.38921c","bae1e705.483258","a28a3be1.9713e8"],"x":495,"y":60,"wires":[["37b1e390.c2a65c"]]},{"id":"d37d2e76.85f7f","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":835,"y":160,"wires":[]},{"id":"7aedb35f.d746fc","type":"inject","z":"7acad338.91f38c","name":"","props":[{"p":"data","v":"{\"event\":{\"new_state\":{\"attributes\":{\"friendly_name\":\"Front Door\"}}}}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":170,"y":200,"wires":[["1709a4dc.eadb2b"]]},{"id":"38b41825.cd7788","type":"link in","z":"7acad338.91f38c","name":"Telegram Notification - Alarm Disarmed","links":["5b93866d.56e678"],"x":195,"y":260,"wires":[["bf501a6b.2251f8"]]},{"id":"d3ccff49.403ae","type":"inject","z":"7acad338.91f38c","name":"","props":[{"p":"user_name","v":"Andrew","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":170,"y":300,"wires":[["bf501a6b.2251f8"]]},{"id":"181c3f46.b81061","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":995,"y":300,"wires":[]},{"id":"bf501a6b.2251f8","type":"switch","z":"7acad338.91f38c","name":"Disarmed from Wall Panel?","property":"user_name","propertyType":"msg","rules":[{"t":"eq","v":"Wall Panel","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":440,"y":260,"wires":[["ef66db7a.785218","2d3f69a7.23de46"],["ef66db7a.785218"]]},{"id":"7633c4a1.2dd64c","type":"link in","z":"7acad338.91f38c","name":"Telegram Notification - Alarm Armed","links":["46f359c0.64f9f8"],"x":195,"y":400,"wires":[["65b2cfbb.ede47"]]},{"id":"b2ac2986.b3a158","type":"delay","z":"7acad338.91f38c","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":900,"y":300,"wires":[["181c3f46.b81061"]]},{"id":"57069115.8de74","type":"server-state-changed","z":"7acad338.91f38c","name":"Kaitlyn Home","server":"a86c4410.e2a568","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"person.kaitlyn","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":130,"y":520,"wires":[["d5396e7c.879ff"],[]]},{"id":"6b609e49.31ff1","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":755,"y":520,"wires":[]},{"id":"3cfb63d9.bc7adc","type":"server-state-changed","z":"7acad338.91f38c","name":"Kaitlyn Away","server":"a86c4410.e2a568","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"person.kaitlyn","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"not_home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":130,"y":580,"wires":[["d0d58473.859ac8"],[]]},{"id":"fbfc5c72.b3024","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":755,"y":580,"wires":[]},{"id":"21ca7fd3.24b87","type":"inject","z":"7acad338.91f38c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":460,"wires":[["d5396e7c.879ff"]]},{"id":"3e526033.965dc","type":"inject","z":"7acad338.91f38c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":640,"wires":[["d0d58473.859ac8"]]},{"id":"4a5ef5df.0418ec","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":575,"y":720,"wires":[]},{"id":"2a0c4381.f97c2c","type":"link in","z":"7acad338.91f38c","name":"Door Opened","links":["68ab0362.f0411c","6d666079.02f98","e8cdfa36.6a7948","74d8020.5e9a9","4a5fc4b4.2228ac"],"x":275,"y":720,"wires":[["178f978d.95dc08"]]},{"id":"ade2cdd8.302d6","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":535,"y":1100,"wires":[]},{"id":"c491aaf5.ff00c8","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":575,"y":840,"wires":[]},{"id":"5ef2d578.6f6e6c","type":"link in","z":"7acad338.91f38c","name":"Window Opened","links":["4ead004f.872cf","2653eeff.d1e6e2","e4f6e578.d96a68","a0fae351.bccb3","116ada85.59a5c5","5bccb861.601758"],"x":275,"y":840,"wires":[["450766ce.6ee828"]]},{"id":"ff1a6b21.77bdf8","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":575,"y":780,"wires":[]},{"id":"240ff702.8ebc88","type":"link in","z":"7acad338.91f38c","name":"Door Closed","links":["2d69e704.bf2258","df3dac5c.0dc28","600a62b6.75fabc","657c104a.918d4"],"x":275,"y":780,"wires":[["559ab027.c5c89"]]},{"id":"d9957cce.5ca98","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":575,"y":900,"wires":[]},{"id":"3da53769.3a9388","type":"link in","z":"7acad338.91f38c","name":"Window Closed","links":["605d35bb.79602c","eed8474d.3ccde8","62b0311e.bbc8d","5dca23fa.3b08ec","f9b84beb.942e28","1e8af0a9.c5a04f"],"x":275,"y":900,"wires":[["8be3b4b5.bb1cb8"]]},{"id":"43b5bea7.ad49d","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":575,"y":960,"wires":[]},{"id":"19903d24.41aa63","type":"link in","z":"7acad338.91f38c","name":"Door Unlocked","links":["99f4b97b.0ec628","be1812cf.78047"],"x":275,"y":960,"wires":[["90b0aae6.9da678"]]},{"id":"764fa50f.38921c","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":575,"y":1020,"wires":[]},{"id":"2310a571.02ee6a","type":"link in","z":"7acad338.91f38c","name":"Door Locked","links":["cc006224.b6a76","1ec0e6b0.b52609"],"x":275,"y":1020,"wires":[["fbc3ab5a.84f248"]]},{"id":"ecc0090d.3de628","type":"http request","z":"7acad338.91f38c","name":"Send Telegram Text Message","method":"GET","ret":"txt","paytoqs":"ignore","url":"https://api.telegram.org/bot{{{token}}}/sendMessage?chat_id={{{chat_id}}}&text={{{text}}}","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":60,"wires":[[]]},{"id":"37b1e390.c2a65c","type":"change","z":"7acad338.91f38c","name":"","rules":[{"t":"set","p":"chat_id","pt":"msg","to":"chat_id","tot":"flow"},{"t":"set","p":"token","pt":"msg","to":"token","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":60,"wires":[["ecc0090d.3de628"]]},{"id":"178f978d.95dc08","type":"template","z":"7acad338.91f38c","name":"Door opened","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%F0%9F%9A%AA {{data.event.new_state.attributes.friendly_name}} opened!","output":"str","x":410,"y":720,"wires":[["4a5ef5df.0418ec"]]},{"id":"559ab027.c5c89","type":"template","z":"7acad338.91f38c","name":"Door closed","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%F0%9F%9A%AA {{data.event.new_state.attributes.friendly_name}} opened!","output":"str","x":410,"y":780,"wires":[["ff1a6b21.77bdf8"]]},{"id":"450766ce.6ee828","type":"template","z":"7acad338.91f38c","name":"Window opened!","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%E2%AC%86 {{data.event.new_state.attributes.friendly_name}} opened!","output":"str","x":430,"y":840,"wires":[["c491aaf5.ff00c8"]]},{"id":"8be3b4b5.bb1cb8","type":"template","z":"7acad338.91f38c","name":"Window closed.","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%E2%AC%87 {{data.event.new_state.attributes.friendly_name}} closed.","output":"str","x":420,"y":900,"wires":[["d9957cce.5ca98"]]},{"id":"90b0aae6.9da678","type":"template","z":"7acad338.91f38c","name":"Door unlocked!","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%F0%9F%94%93 {{data.event.new_state.attributes.friendly_name}} {{data.event.new_state.attributes.lock_status}}","output":"str","x":420,"y":960,"wires":[["43b5bea7.ad49d"]]},{"id":"fbc3ab5a.84f248","type":"template","z":"7acad338.91f38c","name":"Door locked","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%F0%9F%94%92 {{data.event.new_state.attributes.friendly_name}} {{data.event.new_state.attributes.lock_status}}","output":"str","x":410,"y":1020,"wires":[["764fa50f.38921c"]]},{"id":"d5396e7c.879ff","type":"change","z":"7acad338.91f38c","name":"Variables","rules":[{"t":"set","p":"text","pt":"msg","to":"%F0%9F%9A%98 Kaitlyn is home!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":520,"wires":[["6b609e49.31ff1"]]},{"id":"d0d58473.859ac8","type":"change","z":"7acad338.91f38c","name":"Variables","rules":[{"t":"set","p":"text","pt":"msg","to":"%F0%9F%9A%97 Kaitlyn is away for now.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":580,"wires":[["fbfc5c72.b3024"]]},{"id":"65b2cfbb.ede47","type":"template","z":"7acad338.91f38c","name":"Alarm armed","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%F0%9F%94%90 Alarm was {{alarm_state}} by {{user_name}}","output":"str","x":550,"y":400,"wires":[["bae1e705.483258"]]},{"id":"bae1e705.483258","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":655,"y":400,"wires":[]},{"id":"1709a4dc.eadb2b","type":"template","z":"7acad338.91f38c","name":"Alarm triggered","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%E2%9D%97 Alarm triggered by {{data.event.new_state.attributes.friendly_name}}","output":"str","x":500,"y":160,"wires":[["d37d2e76.85f7f"]]},{"id":"d4c1e9c5.4ea678","type":"http request","z":"7acad338.91f38c","name":"Get Image From Tablet","method":"GET","ret":"bin","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":940,"y":240,"wires":[["fd2b540f.94b1c8"]]},{"id":"19fd7ba9.c73ae4","type":"http request","z":"7acad338.91f38c","name":"Send Telegram Photo Message","method":"POST","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1450,"y":240,"wires":[[]]},{"id":"fd2b540f.94b1c8","type":"function","z":"7acad338.91f38c","name":"Set Header and Payload","func":"var photo = msg.payload;\n\nmsg = {};\n\nmsg.url = \"https://api.telegram.org/bot\" + flow.get(\"token\") + \"/sendPhoto?chat_id=\" + flow.get(\"chat_id\");\n\nmsg.payload = {\n    \"photo\": photo\n};\n\nmsg.headers = {};\nmsg.headers['Content-Type'] = 'multipart/form-data';\nmsg.headers['Accept'] = 'application/json';\n\nmsg.payload = {\n    'photo': {\n        value: photo,\n        options: {\n            filename: 'fully-camshot.jpg',\n            contentType: 'image/jpeg', // This is optionnal\n        }\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1170,"y":240,"wires":[["19fd7ba9.c73ae4"]]},{"id":"ef66db7a.785218","type":"template","z":"7acad338.91f38c","name":"Alarm disarmed","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%F0%9F%94%93 Alarm was disarmed by {{user_name}}","output":"str","x":720,"y":300,"wires":[["b2ac2986.b3a158"]]},{"id":"2d3f69a7.23de46","type":"change","z":"7acad338.91f38c","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"kiosk_photo_url","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":240,"wires":[["d4c1e9c5.4ea678"]]},{"id":"311b2d64.dc8f12","type":"link in","z":"2ef67aae.d4bfe6","name":"Profile: Away","links":["266ca4d3.d55f7c"],"x":315,"y":2320,"wires":[["55e2010c.75e58"]]},{"id":"ca4f26a.ada56d8","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["b9c2ea8c.8fbb98","c2323107.c76c1","eb9805e6.cdcc88"],"x":635,"y":2280,"wires":[]},{"id":"34b423e9.1961fc","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":2240,"wires":[["55e2010c.75e58"]]},{"id":"40cdbbb2.2b73a4","type":"function","z":"2ef67aae.d4bfe6","name":"Tasker Message","func":"msg.url = flow.get(\"tasker_url\") + msg.message\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":80,"wires":[["c86ec3f9.e2c7c"]]},{"id":"c86ec3f9.e2c7c","type":"http request","z":"2ef67aae.d4bfe6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1230,"y":80,"wires":[[]]},{"id":"31861573.18cc9a","type":"link in","z":"2ef67aae.d4bfe6","name":"Tasker Message","links":["63bbbfb3.df9ea","2e9ee194.a0e64e","2603f4f6.93de2c","6d9840f0.56c24","dfec471c.3b8a98","5cfdb299.fe3b0c","a3e97f60.6b30a","87869f8.b64d86"],"x":855,"y":80,"wires":[["40cdbbb2.2b73a4"]]},{"id":"2603f4f6.93de2c","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["31861573.18cc9a"],"x":575,"y":1860,"wires":[]},{"id":"6d9840f0.56c24","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["31861573.18cc9a"],"x":575,"y":2000,"wires":[]},{"id":"dfec471c.3b8a98","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["31861573.18cc9a"],"x":615,"y":2180,"wires":[]},{"id":"55e2010c.75e58","type":"change","z":"2ef67aae.d4bfe6","name":"","rules":[],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":2280,"wires":[["ca4f26a.ada56d8","7e09b7bc.11f7a8"]]},{"id":"1951974d.02d6d9","type":"debug","z":"75ccec5b.f7e364","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":760,"y":200,"wires":[]},{"id":"7c5057b9.4c72b8","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/away-mode","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":200,"y":2280,"wires":[["55e2010c.75e58"]]},{"id":"7e09b7bc.11f7a8","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Set Away","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.automation_mode","data":"{\"option\":\"away\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":2320,"wires":[[]]},{"id":"92b1e9e3.93dd58","type":"http request","z":"644db6a5.3303b8","name":"Last Watch - Driveway Person Man Cave Tablet Alerts","method":"PUT","ret":"txt","paytoqs":"ignore","url":"http://192.168.1.96/api/profiles/driveway-person-man-cave-tablet-alerts-4k/status","tls":"","persist":false,"proxy":"","authType":"","x":620,"y":940,"wires":[[]]},{"id":"ec5e1696.e45208","type":"change","z":"644db6a5.3303b8","name":"Enable","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"status\": \"enabled\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":940,"wires":[["92b1e9e3.93dd58"]]},{"id":"36e32454.b9f9ac","type":"change","z":"644db6a5.3303b8","name":"Disable","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"status\": \"disabled\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":1000,"wires":[["92b1e9e3.93dd58"]]},{"id":"c59fb1b9.b1c19","type":"http request","z":"644db6a5.3303b8","name":"Last Watch - Driveway Person Wall Tablet Alerts","method":"PUT","ret":"txt","paytoqs":"ignore","url":"http://192.168.1.96/api/profiles/driveway-person-wall-tablet-alerts-4k/status","tls":"","persist":false,"proxy":"","authType":"","x":600,"y":1080,"wires":[[]]},{"id":"2fa48b8c.c92964","type":"change","z":"644db6a5.3303b8","name":"Enable","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"status\": \"enabled\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":1080,"wires":[["c59fb1b9.b1c19"]]},{"id":"b57d7fd9.1eb67","type":"change","z":"644db6a5.3303b8","name":"Disable","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"status\": \"disabled\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":1140,"wires":[["c59fb1b9.b1c19"]]},{"id":"d0c9f47c.c70648","type":"link in","z":"644db6a5.3303b8","name":"Enable Driveway Person Man Cave Tablet Alerts","links":[],"x":135,"y":940,"wires":[["ec5e1696.e45208"]]},{"id":"fd0d3303.2cec6","type":"link in","z":"644db6a5.3303b8","name":"Disable Driveway Person Man Cave Tablet Alerts","links":[],"x":135,"y":1000,"wires":[["36e32454.b9f9ac"]]},{"id":"aa99d57a.4d3418","type":"link in","z":"644db6a5.3303b8","name":"Enable Driveway Person Wall Tablet Alerts","links":[],"x":135,"y":1080,"wires":[["2fa48b8c.c92964"]]},{"id":"c2323107.c76c1","type":"link in","z":"644db6a5.3303b8","name":"Disable Driveway Person Wall Tablet Alerts","links":["ca4f26a.ada56d8","fa02e14e.83e7f","f9518712.046d78"],"x":135,"y":1140,"wires":[["b57d7fd9.1eb67"]]},{"id":"266ca4d3.d55f7c","type":"link out","z":"a5e69210.f37a9","name":"","links":["311b2d64.dc8f12"],"x":895,"y":820,"wires":[]},{"id":"541581c9.1410f","type":"link in","z":"2ef67aae.d4bfe6","name":"Profile: Home","links":["73d9a904.346e38"],"x":315,"y":2480,"wires":[["6da67ff9.cc354"]]},{"id":"f4cfc917.1a35c8","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["6eac8ad9.a51394","e2dce7a5.8969b8","eb9805e6.cdcc88"],"x":635,"y":2440,"wires":[]},{"id":"65f5138a.f820ec","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":2400,"wires":[["6da67ff9.cc354"]]},{"id":"6da67ff9.cc354","type":"change","z":"2ef67aae.d4bfe6","name":"","rules":[],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":2440,"wires":[["f4cfc917.1a35c8","96bcc6d4.31f258"]]},{"id":"92fe9135.c8f45","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/home-mode","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":200,"y":2440,"wires":[["6da67ff9.cc354"]]},{"id":"96bcc6d4.31f258","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Set Home","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.automation_mode","data":"{\"option\":\"home\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":2480,"wires":[[]]},{"id":"4ea29558.ef8b7c","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Wall Tablet Backlight","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.wall_tablet_backlight","data":"{\"brightness\":\"255\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":600,"y":780,"wires":[[]]},{"id":"6eac8ad9.a51394","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Screen Brightness Full","links":["f4cfc917.1a35c8"],"x":335,"y":820,"wires":[["4ea29558.ef8b7c"]]},{"id":"7f194ebe.af68f","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":300,"y":740,"wires":[["4ea29558.ef8b7c"]]},{"id":"729cecc6.dfa3d4","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/screen/bright","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":220,"y":780,"wires":[["4ea29558.ef8b7c"]]},{"id":"39a5b6f0.ccd26a","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Wall Tablet Backlight","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.wall_tablet_backlight","data":"{\"brightness\":\"69\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":920,"wires":[[]]},{"id":"3b485ac7.0a3176","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Screen Brightness Dim","links":["dfc54883.e44098","f9518712.046d78"],"x":335,"y":960,"wires":[["39a5b6f0.ccd26a"]]},{"id":"ba4e7571.8ce1f8","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":300,"y":880,"wires":[["39a5b6f0.ccd26a"]]},{"id":"66ff03d0.8bda9c","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/screen/dim","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":210,"y":920,"wires":[["39a5b6f0.ccd26a"]]},{"id":"89ee62bd.4b50b","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Wall Tablet Backlight","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.wall_tablet_backlight","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":1060,"wires":[[]]},{"id":"5bacb989.be6028","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Screen Off","links":[],"x":335,"y":1100,"wires":[["89ee62bd.4b50b"]]},{"id":"f9f0fc57.6aaba","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":300,"y":1020,"wires":[["89ee62bd.4b50b"]]},{"id":"d3db30e3.3a6d2","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/screen/off","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":210,"y":1060,"wires":[["89ee62bd.4b50b"]]},{"id":"73d9a904.346e38","type":"link out","z":"a5e69210.f37a9","name":"","links":["541581c9.1410f"],"x":915,"y":320,"wires":[]},{"id":"815dabf1.08cdf8","type":"link in","z":"2ef67aae.d4bfe6","name":"Profile: Wind Down","links":["165fc92b.c45ab7"],"x":315,"y":2640,"wires":[["5a9fb02.345805"]]},{"id":"dfc54883.e44098","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["3b485ac7.0a3176","a55b10ce.08ffd"],"x":635,"y":2600,"wires":[]},{"id":"5af1f009.77861","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":2560,"wires":[["5a9fb02.345805"]]},{"id":"5a9fb02.345805","type":"change","z":"2ef67aae.d4bfe6","name":"","rules":[],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":2600,"wires":[["dfc54883.e44098"]]},{"id":"ac7a4fe6.985c3","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/chill-mode","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":210,"y":2600,"wires":[["5a9fb02.345805"]]},{"id":"27e3490c.d6d6b6","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Mute","links":["1799472a.c30f49","cb03a92b.e9cf28","ab08b031.73345"],"x":315,"y":1440,"wires":[["1b71c2bf.5b302d"]]},{"id":"c9959bda.3833a8","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/volume/mute","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":240,"y":1400,"wires":[["1b71c2bf.5b302d"]]},{"id":"1b71c2bf.5b302d","type":"change","z":"2ef67aae.d4bfe6","name":"","rules":[{"t":"set","p":"message","pt":"msg","to":"0=:=set_volume","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":1400,"wires":[["63bbbfb3.df9ea","8dfdba5a.a05468"]]},{"id":"5c4ce8e9.1a3778","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1360,"wires":[["1b71c2bf.5b302d"]]},{"id":"eb9805e6.cdcc88","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Volume High","links":["232bb4d0.c4817c","ca4f26a.ada56d8","f4cfc917.1a35c8","f9518712.046d78","3a64dfd8.e70d"],"x":315,"y":1580,"wires":[["8d589953.d1d918"]]},{"id":"1a70a403.c1997c","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/volume/high","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":240,"y":1540,"wires":[["8d589953.d1d918"]]},{"id":"de185f00.4ebe9","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1500,"wires":[["8d589953.d1d918"]]},{"id":"63bbbfb3.df9ea","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["31861573.18cc9a"],"x":895,"y":1400,"wires":[]},{"id":"2e9ee194.a0e64e","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["31861573.18cc9a"],"x":1095,"y":1540,"wires":[]},{"id":"a55b10ce.08ffd","type":"link in","z":"2ef67aae.d4bfe6","name":"Action: Volume Low","links":["dfc54883.e44098"],"x":315,"y":1700,"wires":[["8c888a74.0c4fb8"]]},{"id":"fc7403a6.bfbd9","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/volume/low","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":230,"y":1660,"wires":[["8c888a74.0c4fb8"]]},{"id":"b20bfd84.f520d","type":"change","z":"2ef67aae.d4bfe6","name":"","rules":[{"t":"set","p":"message","pt":"msg","to":"5=:=set_volume","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":1660,"wires":[["87869f8.b64d86","8dfdba5a.a05468"]]},{"id":"730ce47b.736dac","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1620,"wires":[["8c888a74.0c4fb8"]]},{"id":"87869f8.b64d86","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["31861573.18cc9a"],"x":1075,"y":1660,"wires":[]},{"id":"f498ff5d.3a8d5","type":"link in","z":"2ef67aae.d4bfe6","name":"Profile: Sleep","links":["2da987f2.586298"],"x":315,"y":2800,"wires":[["d966a10e.5c761"]]},{"id":"f9518712.046d78","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["3b485ac7.0a3176","b9c2ea8c.8fbb98","c2323107.c76c1","eb9805e6.cdcc88"],"x":635,"y":2760,"wires":[]},{"id":"a72de756.220598","type":"inject","z":"2ef67aae.d4bfe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":2720,"wires":[["d966a10e.5c761"]]},{"id":"d966a10e.5c761","type":"change","z":"2ef67aae.d4bfe6","name":"","rules":[],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":2760,"wires":[["f9518712.046d78"]]},{"id":"69608f2.b44d67","type":"mqtt in","z":"2ef67aae.d4bfe6","name":"","topic":"/hass/kiosk/wall-tablet/sleep-mode","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":220,"y":2760,"wires":[["d966a10e.5c761"]]},{"id":"68b77b0e.5b7bb4","type":"inject","z":"9baffb82.f57ff8","name":"","props":[],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":150,"y":80,"wires":[["14cfab3d.ba1965"]]},{"id":"83a03aa4.e7ae08","type":"link in","z":"9baffb82.f57ff8","name":"Telegram Alert - Alarm Pending","links":["c317f9ed.e72ca8"],"x":175,"y":300,"wires":[["564a4905.dd1f78"]]},{"id":"5193b170.eb8ef","type":"link in","z":"9baffb82.f57ff8","name":"","links":["6a2d6e5e.11788","994acfb5.e211b"],"x":595,"y":80,"wires":[["f32eca40.489458"]]},{"id":"994acfb5.e211b","type":"link out","z":"9baffb82.f57ff8","name":"","links":["5193b170.eb8ef"],"x":795,"y":300,"wires":[]},{"id":"564a4905.dd1f78","type":"template","z":"9baffb82.f57ff8","name":"Alarm triggered","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%E2%9D%97 Alarm triggered by {{data.event.new_state.attributes.friendly_name}}","output":"str","x":480,"y":300,"wires":[["994acfb5.e211b"]]},{"id":"14cfab3d.ba1965","type":"credentials","z":"9baffb82.f57ff8","name":"","props":[{"value":"chat_id","type":"flow"},{"value":"token","type":"flow"}],"x":330,"y":80,"wires":[[]]},{"id":"990b6c32.3ffcd","type":"http request","z":"9baffb82.f57ff8","name":"Send Telegram Text Message","method":"GET","ret":"txt","paytoqs":"ignore","url":"https://api.telegram.org/bot{{{token}}}/sendMessage?chat_id={{{chat_id}}}&text={{{text}}}","tls":"","persist":false,"proxy":"","authType":"","x":970,"y":80,"wires":[["ce842908.f96538"]]},{"id":"e1b4cb41.41a888","type":"inject","z":"9baffb82.f57ff8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":330,"y":420,"wires":[["564a4905.dd1f78"]]},{"id":"ce842908.f96538","type":"debug","z":"9baffb82.f57ff8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1210,"y":80,"wires":[]},{"id":"f32eca40.489458","type":"change","z":"9baffb82.f57ff8","name":"","rules":[{"t":"set","p":"chat_id","pt":"msg","to":"chat_id","tot":"flow"},{"t":"set","p":"token","pt":"msg","to":"token","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":80,"wires":[["990b6c32.3ffcd"]]},{"id":"15fdaa8.c254e56","type":"template","z":"7acad338.91f38c","name":"Garage opened!","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%E2%AC%86 Garage door opened!","output":"str","x":420,"y":1100,"wires":[["ade2cdd8.302d6"]]},{"id":"99421491.9aca88","type":"trigger-state","z":"7acad338.91f38c","name":"Garage Door Open","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"cover.garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"open","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":210,"y":1100,"wires":[["15fdaa8.c254e56"],[]]},{"id":"8e13867.4594678","type":"trigger-state","z":"7acad338.91f38c","name":"Garage Door Closed","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"cover.garage_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"closed","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":200,"y":1160,"wires":[["4d9a1c59.a68944"],[]]},{"id":"4d9a1c59.a68944","type":"template","z":"7acad338.91f38c","name":"Garage closed","field":"text","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"%E2%AC%87 Garage door closed.","output":"str","x":420,"y":1160,"wires":[["a28a3be1.9713e8"]]},{"id":"a28a3be1.9713e8","type":"link out","z":"7acad338.91f38c","name":"","links":["98783b59.ad1f38"],"x":535,"y":1160,"wires":[]},{"id":"d2b472fe.0ab2f","type":"mqtt in","z":"6ce2b51b.d6eccc","name":"","topic":"/hass/kiosk/man-cave-tablet/screen/bright","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":320,"y":300,"wires":[["dcf4dcf7.5fbac"]]},{"id":"f452e4c4.8b3108","type":"inject","z":"6ce2b51b.d6eccc","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":260,"wires":[["dcf4dcf7.5fbac"]]},{"id":"393e3884.ca7ce8","type":"link in","z":"6ce2b51b.d6eccc","name":"Action: Screen Brightness Bright","links":["b3ea202a.234cb"],"x":455,"y":340,"wires":[["dcf4dcf7.5fbac"]]},{"id":"dcf4dcf7.5fbac","type":"api-call-service","z":"6ce2b51b.d6eccc","name":"Backlight","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.man_cave_tablet_backlight","data":"{\"brightness\": \"255\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":600,"y":300,"wires":[[]]},{"id":"9944a034.a0f1c","type":"mqtt in","z":"6ce2b51b.d6eccc","name":"","topic":"/hass/kiosk/man-cave-tablet/screen/dim","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":310,"y":440,"wires":[["1e3d79d2.abdc96"]]},{"id":"4c8fad48.8e0584","type":"inject","z":"6ce2b51b.d6eccc","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":400,"wires":[["1e3d79d2.abdc96"]]},{"id":"ba57a2df.7f331","type":"link in","z":"6ce2b51b.d6eccc","name":"Action: Screen Brightness Dim","links":["165fc92b.c45ab7"],"x":455,"y":480,"wires":[["1e3d79d2.abdc96"]]},{"id":"1e3d79d2.abdc96","type":"api-call-service","z":"6ce2b51b.d6eccc","name":"Backlight","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.man_cave_tablet_backlight","data":"{\"brightness\":\"69\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":600,"y":440,"wires":[[]]},{"id":"2867632d.27fd6c","type":"mqtt in","z":"6ce2b51b.d6eccc","name":"","topic":"/hass/kiosk/man-cave-tablet/screen/off","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":310,"y":580,"wires":[["79c3e437.bc72cc"]]},{"id":"28f932c8.ac2c1e","type":"inject","z":"6ce2b51b.d6eccc","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":540,"wires":[["79c3e437.bc72cc"]]},{"id":"4aa1fc95.34b874","type":"link in","z":"6ce2b51b.d6eccc","name":"Action: Screen Off","links":["6fc2c76d.67b6c8","eca51371.38624"],"x":455,"y":620,"wires":[["79c3e437.bc72cc"]]},{"id":"79c3e437.bc72cc","type":"api-call-service","z":"6ce2b51b.d6eccc","name":"Backlight","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.man_cave_tablet_backlight","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":600,"y":580,"wires":[[]]},{"id":"e489c82d.7ea418","type":"server-events","z":"ba1d0806.5d5398","name":"Call Service","server":"a86c4410.e2a568","event_type":"call_service","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":150,"y":100,"wires":[["686631ca.e5256"]]},{"id":"686631ca.e5256","type":"switch","z":"ba1d0806.5d5398","name":"script.voice_command_show_cameras_on_man_cave_tablet","property":"payload.event.service_data.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"script.voice_command_show_cameras_on_man_cave_tablet","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":100,"wires":[["31a3a1b8.8e941e"]]},{"id":"31a3a1b8.8e941e","type":"link out","z":"ba1d0806.5d5398","name":"","links":["19c258fe.7ce2d7"],"x":755,"y":100,"wires":[]},{"id":"eca51371.38624","type":"link out","z":"c6727c1e.1d54f","name":"","links":["4aa1fc95.34b874"],"x":1375,"y":620,"wires":[]},{"id":"948dbff6.fcc6a","type":"api-current-state","z":"d0661cff.7e5c6","name":"Temp >= 78?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"78","halt_if_type":"num","halt_if_compare":"gte","override_topic":false,"entity_id":"sensor.hue_202_temp","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":590,"y":700,"wires":[["f50f435b.6cc8c"],[]]},{"id":"f50f435b.6cc8c","type":"api-call-service","z":"d0661cff.7e5c6","name":"Turn on fan","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.ikea_outlet_103","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":770,"y":700,"wires":[[]]},{"id":"6e544bfe.89aa14","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/great-room/night-light","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":280,"y":800,"wires":[["fbdc2dba.9c422"]]},{"id":"99beb962.473558","type":"inject","z":"47850f9e.3112f","name":"test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":230,"y":880,"wires":[["fbdc2dba.9c422"]]},{"id":"fbdc2dba.9c422","type":"api-call-service","z":"47850f9e.3112f","name":"Turn Off Flux","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.ledge_fluxer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":590,"y":840,"wires":[["af845e9a.d057e"]]},{"id":"c4525701.7d4e78","type":"link in","z":"47850f9e.3112f","name":"Great Room - Night Light","links":["e1af110c.053ec"],"x":155,"y":840,"wires":[["fbdc2dba.9c422"]]},{"id":"af845e9a.d057e","type":"api-call-service","z":"47850f9e.3112f","name":"Great Room On","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.flex_strip_109,light.flex_strip_110","data":"{\"brightness\":140,\"kelvin\":2250}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":800,"y":840,"wires":[[]]},{"id":"e1af110c.053ec","type":"link out","z":"f7e7a8ac.19a538","name":"Night light","links":["c4525701.7d4e78"],"x":1675,"y":320,"wires":[]},{"id":"a98e8ef2.cbf6b","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/motion/driveway-car","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":310,"y":920,"wires":[["f518be1f.d765c"]]},{"id":"f518be1f.d765c","type":"trigger","z":"d390bbbb.863388","name":"","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"30","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":550,"y":920,"wires":[["511b6b36.76f174"],["511b6b36.76f174"]]},{"id":"511b6b36.76f174","type":"ha-entity","z":"d390bbbb.863388","name":"ai_driveway_car_motion","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"AI Driveway Car Motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":770,"y":920,"wires":[[]]},{"id":"11bbc80e.a189b8","type":"trigger","z":"d390bbbb.863388","name":"","op1":"{\"state\":\"on\",\"attributes\":{\"icon\":\"mdi:account\"}}","op2":"{\"state\":\"off\",\"attributes\":{\"icon\":\"mdi:account-outline\"}}","op1type":"json","op2type":"json","duration":"120","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":1370,"y":260,"wires":[[],[]]},{"id":"5613b6b.317ad48","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/motion/garage-car","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":310,"y":1020,"wires":[["daf9e6ed.5c4b98"]]},{"id":"daf9e6ed.5c4b98","type":"trigger","z":"d390bbbb.863388","name":"","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"30","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":550,"y":1020,"wires":[["56b5dd13.0428f4"],["56b5dd13.0428f4"]]},{"id":"56b5dd13.0428f4","type":"ha-entity","z":"d390bbbb.863388","name":"ai_garage_car_motion","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"AI Garage Car Motion"},{"property":"device_class","value":"motion"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":760,"y":1020,"wires":[[]]},{"id":"a7c5267c.29d928","type":"ha-entity","z":"2ef67aae.d4bfe6","name":"Mute Wall Tablet","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"Mute Wall Tablet"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:volume-mute"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":true,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":620,"y":1480,"wires":[["1b71c2bf.5b302d"],["207f6ca6.3b14e4"]]},{"id":"87cfa76f.336818","type":"api-current-state","z":"2ef67aae.d4bfe6","name":"Not Muted?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","override_topic":false,"entity_id":"switch.mute_wall_tablet","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":730,"y":1540,"wires":[["207f6ca6.3b14e4"],[]]},{"id":"8d589953.d1d918","type":"switch","z":"2ef67aae.d4bfe6","name":"Not Night Shift?","property":"night_shift","propertyType":"global","rules":[{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":560,"y":1540,"wires":[["87cfa76f.336818"]]},{"id":"207f6ca6.3b14e4","type":"change","z":"2ef67aae.d4bfe6","name":"","rules":[{"t":"set","p":"message","pt":"msg","to":"12=:=set_volume","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":1540,"wires":[["2e9ee194.a0e64e","8dfdba5a.a05468"]]},{"id":"8c888a74.0c4fb8","type":"switch","z":"2ef67aae.d4bfe6","name":"Not Night Shift?","property":"night_shift","propertyType":"global","rules":[{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":1660,"wires":[["5d3ebb65.7612d4"]]},{"id":"5d3ebb65.7612d4","type":"api-current-state","z":"2ef67aae.d4bfe6","name":"Not Muted?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","override_topic":false,"entity_id":"switch.mute_wall_tablet","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":730,"y":1660,"wires":[["b20bfd84.f520d"],[]]},{"id":"95bfe2de.5d2c1","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/outside-scene/sunset","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":220,"y":1420,"wires":[["385cdedd.f3f662"]]},{"id":"874fa33f.17b66","type":"api-call-service","z":"47850f9e.3112f","name":"Turn on back yard lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.back_yard_lights","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":690,"y":1420,"wires":[[]]},{"id":"8e1120ba.fee02","type":"api-call-service","z":"47850f9e.3112f","name":"Turn on side yard light","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ge_softwhite_101","data":"{\"brightness\":255}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":1480,"wires":[[]]},{"id":"45dd25cd.4b840c","type":"api-call-service","z":"47850f9e.3112f","name":"Turn off patio light","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.ge_softwhite_104","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":670,"y":1540,"wires":[[]]},{"id":"385cdedd.f3f662","type":"switch","z":"47850f9e.3112f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"else"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":1420,"wires":[["874fa33f.17b66","8e1120ba.fee02","45dd25cd.4b840c"]]},{"id":"4f79247f.19a44c","type":"link in","z":"47850f9e.3112f","name":"Outside Scene - Sunset","links":["d9cfbe8d.f6c8b","ec9b2b35.5798c8"],"x":335,"y":1460,"wires":[["385cdedd.f3f662"]]},{"id":"5649e79c.251bf8","type":"inject","z":"47850f9e.3112f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1500,"wires":[["385cdedd.f3f662"]]},{"id":"97672d1a.3bbd5","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/outside-scene/sunrise","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":220,"y":1600,"wires":[["f6ecd389.01478"]]},{"id":"c921fc58.0f0cf","type":"api-call-service","z":"47850f9e.3112f","name":"Turn off back yard lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.back_yard_lights","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":690,"y":1600,"wires":[[]]},{"id":"cc535324.5f07a","type":"api-call-service","z":"47850f9e.3112f","name":"Turn off side yard light","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.ge_softwhite_101","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":1660,"wires":[[]]},{"id":"fec383f7.63989","type":"api-call-service","z":"47850f9e.3112f","name":"Turn off patio light","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.ge_softwhite_104","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":670,"y":1720,"wires":[[]]},{"id":"f6ecd389.01478","type":"switch","z":"47850f9e.3112f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"else"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":1600,"wires":[["c921fc58.0f0cf","cc535324.5f07a","fec383f7.63989"]]},{"id":"ba50af65.45a5b","type":"link in","z":"47850f9e.3112f","name":"Outside Scene - Sunrise","links":["4f2dc313.64e01c"],"x":335,"y":1640,"wires":[["f6ecd389.01478"]]},{"id":"edf0c942.ab36e8","type":"inject","z":"47850f9e.3112f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1680,"wires":[["f6ecd389.01478"]]},{"id":"6d2c24a.5eb6cdc","type":"mqtt in","z":"47850f9e.3112f","name":"","topic":"/hass/scene/outside-scene/security","qos":"2","datatype":"auto","broker":"e7767a8a.ec2a28","x":220,"y":1780,"wires":[["43fcde5d.314c7"]]},{"id":"821b2a69.91a718","type":"api-call-service","z":"47850f9e.3112f","name":"Turn off back yard lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.back_yard_lights","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":690,"y":1780,"wires":[[]]},{"id":"60e6f3c8.fdcc5c","type":"api-call-service","z":"47850f9e.3112f","name":"Turn on side yard light","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ge_softwhite_101","data":"{\"brightness\":255}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":1840,"wires":[[]]},{"id":"d20bfe0.ad0d7","type":"api-call-service","z":"47850f9e.3112f","name":"Turn on patio light","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.ge_softwhite_104","data":"{\"brightness\":50}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":670,"y":1900,"wires":[[]]},{"id":"43fcde5d.314c7","type":"switch","z":"47850f9e.3112f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"else"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":1780,"wires":[["821b2a69.91a718","60e6f3c8.fdcc5c","d20bfe0.ad0d7"]]},{"id":"ae0851c1.fa262","type":"link in","z":"47850f9e.3112f","name":"Outside Scene - Security","links":["6f320f36.e8e79","1f93db92.555774"],"x":335,"y":1820,"wires":[["43fcde5d.314c7"]]},{"id":"182ad3ec.a42a6c","type":"inject","z":"47850f9e.3112f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1860,"wires":[["43fcde5d.314c7"]]},{"id":"d9cfbe8d.f6c8b","type":"link out","z":"c3c8a381.c1927","name":"","links":["4f79247f.19a44c"],"x":995,"y":160,"wires":[]},{"id":"6f320f36.e8e79","type":"link out","z":"c3c8a381.c1927","name":"","links":["ae0851c1.fa262"],"x":995,"y":220,"wires":[]},{"id":"4f2dc313.64e01c","type":"link out","z":"c3c8a381.c1927","name":"","links":["ba50af65.45a5b"],"x":995,"y":280,"wires":[]},{"id":"1f93db92.555774","type":"link out","z":"a5e69210.f37a9","name":"","links":["ae0851c1.fa262"],"x":1115,"y":700,"wires":[]},{"id":"ec9b2b35.5798c8","type":"link out","z":"a5e69210.f37a9","name":"","links":["4f79247f.19a44c"],"x":1475,"y":500,"wires":[]},{"id":"741d75fd.e0135c","type":"trigger-state","z":"2ef67aae.d4bfe6","name":"Doorbell Rung","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.front_door_doorbell","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":220,"y":3000,"wires":[["b0291746.cff2c8"],[]]},{"id":"b0291746.cff2c8","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Turn on screen","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"screenOn\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":410,"y":3000,"wires":[["b8514a52.6e3fd8"]]},{"id":"b8514a52.6e3fd8","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Bring app to foreground","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"toForeground\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":2980,"wires":[["4cbd748a.3d9d9c"]]},{"id":"4cbd748a.3d9d9c","type":"api-call-service","z":"2ef67aae.d4bfe6","name":"Navigate to view","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"wall_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"loadURL\", \"url\":\"http://192.168.1.53:8123/wall-tablet/doorbell-cameras\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":830,"y":2960,"wires":[[]]},{"id":"c255c0dd.74358","type":"api-call-service","z":"47850f9e.3112f","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"reload","entityId":"","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":540,"y":2120,"wires":[["5d8f0fb1.710dc"]]},{"id":"5d8f0fb1.710dc","type":"api-call-service","z":"47850f9e.3112f","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.man_cave_scene_new","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":750,"y":2120,"wires":[[]]},{"id":"ae20c17.40bc94","type":"inject","z":"47850f9e.3112f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":2120,"wires":[["c255c0dd.74358"]]},{"id":"59973e98.1e302","type":"inject","z":"644db6a5.3303b8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":630,"y":1280,"wires":[["9b7b21d9.703c6"]]},{"id":"76de9022.066f5","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/presence/doorbell/person","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":230,"y":1460,"wires":[["d1bcf9f7.542b08"]]},{"id":"5cf088d1.758e88","type":"ha-entity","z":"d390bbbb.863388","name":"ai_doorbell_person_occupancy","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"AI Doorbell Person Presence"},{"property":"device_class","value":"occupancy"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":770,"y":1460,"wires":[[]]},{"id":"d1bcf9f7.542b08","type":"trigger","z":"d390bbbb.863388","name":"","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"120","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":2,"x":490,"y":1460,"wires":[["5cf088d1.758e88"],["5cf088d1.758e88"]]},{"id":"bc978e63.fadc1","type":"inject","z":"d390bbbb.863388","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":520,"y":1560,"wires":[["5cf088d1.758e88"]]},{"id":"36a436b7.e84afa","type":"inject","z":"d390bbbb.863388","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":510,"y":1520,"wires":[["5cf088d1.758e88"]]},{"id":"aef1215f.16e18","type":"api-call-service","z":"644db6a5.3303b8","name":"Android Notification - Person at Front Door","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"title\":\"Someone is at the Front Door!\",\"message\":\"Person detected by the doorbell camera\",\"data\":{\"clickAction\":\"/sub-doorbell/0\",\"tag\":\"doorbell_person_alert\",\"image\":\"local/images/ai_alerts/doorbell-person-hd.jpg\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1230,"y":1420,"wires":[[]]},{"id":"207af7fa.d77048","type":"trigger","z":"644db6a5.3303b8","name":"Block until driveway is clear","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"0","extend":false,"overrideDelay":false,"units":"min","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":900,"y":1420,"wires":[["aef1215f.16e18","47ae275b.890048","24369329.1e76fc"]]},{"id":"e8cf491f.ceb3d8","type":"link in","z":"644db6a5.3303b8","name":"","links":["d00131ca.b790a"],"x":475,"y":1440,"wires":[["bff8c8fe.2f3478"]]},{"id":"bff8c8fe.2f3478","type":"switch","z":"644db6a5.3303b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":1440,"wires":[["207af7fa.d77048"]]},{"id":"c92040fc.e9a11","type":"mqtt in","z":"d390bbbb.863388","name":"","topic":"hass/sensor/presence/doorbell/person","qos":"0","datatype":"auto","broker":"e7767a8a.ec2a28","x":310,"y":580,"wires":[["239f6e8.e390492"]]},{"id":"84b9263f.f19558","type":"link in","z":"d390bbbb.863388","name":"Trigger Driveway Person Presence","links":["47ae275b.890048"],"x":445,"y":620,"wires":[["239f6e8.e390492"]]},{"id":"47ae275b.890048","type":"link out","z":"644db6a5.3303b8","name":"","links":["84b9263f.f19558"],"x":1075,"y":1480,"wires":[]},{"id":"24369329.1e76fc","type":"api-call-service","z":"644db6a5.3303b8","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"shell_command","service":"save_doorbell_image","entityId":"","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1250,"y":1360,"wires":[[]]},{"id":"bac58c66.5f742","type":"inject","z":"644db6a5.3303b8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":880,"y":1480,"wires":[["aef1215f.16e18","47ae275b.890048"]]},{"id":"eee39604.8ef2b8","type":"http request","z":"4bc9cecd.d3884","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.1.31:81/json","tls":"","persist":false,"proxy":"","authType":"basic","x":370,"y":479,"wires":[["50f198a5.c6c868"]]},{"id":"c6af662b.605458","type":"change","z":"4bc9cecd.d3884","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.cmd","pt":"msg","to":"cliplist","tot":"str"},{"t":"set","p":"payload.camera","pt":"msg","to":"annke101hd","tot":"str"},{"t":"set","p":"payload.view","pt":"msg","to":"all","tot":"str"},{"t":"set","p":"payload.startdate","pt":"msg","to":"startdate","tot":"msg"},{"t":"set","p":"payload.enddate","pt":"msg","to":"enddate","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":480,"wires":[["eee39604.8ef2b8"]]},{"id":"50f198a5.c6c868","type":"json","z":"4bc9cecd.d3884","name":"","property":"payload","action":"","pretty":false,"x":510,"y":480,"wires":[["537b633f.24177c"]]},{"id":"52dd2800.6136b8","type":"moment","z":"4bc9cecd.d3884","name":"","topic":"","input":"","inputType":"date","inTz":"America/Chicago","adjAmount":"7","adjType":"days","adjDir":"subtract","format":"X","locale":"C","output":"start_date","outputType":"msg","outTz":"America/Chicago","x":400,"y":400,"wires":[["4b21df86.c560f"]]},{"id":"f296342.c7530c8","type":"inject","z":"4bc9cecd.d3884","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":400,"wires":[["52dd2800.6136b8"]]},{"id":"4b21df86.c560f","type":"moment","z":"4bc9cecd.d3884","name":"","topic":"","input":"","inputType":"date","inTz":"America/Chicago","adjAmount":"0","adjType":"days","adjDir":"subtract","format":"X","locale":"C","output":"end_date","outputType":"msg","outTz":"America/Chicago","x":630,"y":400,"wires":[["c6af662b.605458"]]},{"id":"2e8eff4e.44529","type":"inject","z":"4bc9cecd.d3884","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":320,"wires":[["3437b4e9.93f57c"]]},{"id":"537b633f.24177c","type":"function","z":"4bc9cecd.d3884","name":"","func":"function dateFormat(UNIX_timestamp){\n  // Months array\n var months_arr = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n\n // Convert timestamp to milliseconds\n var date = new Date(UNIX_timestamp*1000);\n\n // Year\n var year = date.getFullYear();\n\n // Month\n var month = months_arr[date.getMonth()];\n\n // Day\n var day = date.getDate();\n\n // Hours\n var hours = date.getHours();\n\n // Minutes\n var minutes = \"0\" + date.getMinutes();\n\n // Seconds\n var seconds = \"0\" + date.getSeconds();\n\n // Display date time in MM-dd-yyyy h:m:s format\n return month+'-'+day+'-'+year+' '+hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);\n}\n\nvar numSensors = 10;\n\nvar output = [];\n\nfor (var i = 0; i < numSensors; i++) {\n    output[i] = {\n        \"payload\": {\n            \"state\": flow.get(\"bi_url\") + \"/ui3.htm?maximize=1&rec=\" + msg.payload.data[i].path,\n            \"attributes\": {\n                \"thumbUrl\": flow.get(\"bi_url\") + \"/thumbs/\" + msg.payload.data[i].path,\n                \"path\": msg.payload.data[i].path,\n                \"name\": \"annke101hd Clip \" + i,\n                \"date\": dateFormat(msg.payload.data[i].date)\n            }\n        }\n    }\n}\n\nreturn output;","outputs":10,"noerr":0,"initialize":"","finalize":"","x":660,"y":540,"wires":[["27f1c18a.cdd26e"],["7923397c.15e658"],["2eefbc34.9f8ed4"],["b0e38bce.ad6748"],["ab1b666a.832208"],["4d0d4b26.08be44"],["b59e0da2.419f8"],["d94f7843.df35c8"],["96dbdff4.7e5cb"],["e230b35b.66355"]]},{"id":"27f1c18a.cdd26e","type":"ha-entity","z":"4bc9cecd.d3884","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"annke101hd_clip"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":910,"y":420,"wires":[[]]},{"id":"7923397c.15e658","type":"ha-entity","z":"4bc9cecd.d3884","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"annke101hd_clip"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":910,"y":480,"wires":[[]]},{"id":"2eefbc34.9f8ed4","type":"ha-entity","z":"4bc9cecd.d3884","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"annke101hd_clip"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":910,"y":540,"wires":[[]]},{"id":"b0e38bce.ad6748","type":"ha-entity","z":"4bc9cecd.d3884","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"annke101hd_clip"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":910,"y":600,"wires":[[]]},{"id":"ab1b666a.832208","type":"ha-entity","z":"4bc9cecd.d3884","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"annke101hd_clip"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":910,"y":660,"wires":[[]]},{"id":"4d0d4b26.08be44","type":"ha-entity","z":"4bc9cecd.d3884","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"annke101hd_clip"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":910,"y":720,"wires":[[]]},{"id":"b59e0da2.419f8","type":"ha-entity","z":"4bc9cecd.d3884","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"annke101hd_clip"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":910,"y":780,"wires":[[]]},{"id":"d94f7843.df35c8","type":"ha-entity","z":"4bc9cecd.d3884","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"annke101hd_clip"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":910,"y":840,"wires":[[]]},{"id":"96dbdff4.7e5cb","type":"ha-entity","z":"4bc9cecd.d3884","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"annke101hd_clip"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":910,"y":900,"wires":[[]]},{"id":"e230b35b.66355","type":"ha-entity","z":"4bc9cecd.d3884","name":"","server":"a86c4410.e2a568","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"annke101hd_clip"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":910,"y":960,"wires":[[]]},{"id":"8dfdba5a.a05468","type":"debug","z":"2ef67aae.d4bfe6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1350,"y":1520,"wires":[]},{"id":"43b793c3.84959c","type":"api-current-state","z":"2ef67aae.d4bfe6","name":"Muted?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.mute_wall_tablet","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":900,"y":620,"wires":[["ab08b031.73345"],[]]},{"id":"ab08b031.73345","type":"link out","z":"2ef67aae.d4bfe6","name":"","links":["27e3490c.d6d6b6"],"x":995,"y":620,"wires":[]},{"id":"e8816cde.093d5","type":"trigger","z":"2ef67aae.d4bfe6","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":730,"y":620,"wires":[["43b793c3.84959c"]]},{"id":"51cdd13b.6effe","type":"trigger-state","z":"6ce2b51b.d6eccc","name":"Doorbell Rung","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.front_door_doorbell","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":380,"y":720,"wires":[["90d6ae10.78661"],[]]},{"id":"90d6ae10.78661","type":"api-call-service","z":"6ce2b51b.d6eccc","name":"Turn on screen","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"man_cave_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"screenOn\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":570,"y":720,"wires":[["d0c1d223.e4d97"]]},{"id":"d0c1d223.e4d97","type":"api-call-service","z":"6ce2b51b.d6eccc","name":"Bring app to foreground","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"man_cave_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"toForeground\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":780,"y":720,"wires":[["1d9b684.9bfb598"]]},{"id":"1d9b684.9bfb598","type":"api-call-service","z":"6ce2b51b.d6eccc","name":"Navigate","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"rest_command","service":"man_cave_tablet_kiosk_command","entityId":"","data":"{\"cmd\":\"loadURL\",\"url\":\"http://192.168.1.53:8123/man-cave-tablet/cameras\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":970,"y":720,"wires":[[]]},{"id":"f7496fc9.7e403","type":"inject","z":"6ce2b51b.d6eccc","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":780,"wires":[["90d6ae10.78661"]]},{"id":"4c31f2b2.94f04c","type":"inject","z":"2ef67aae.d4bfe6","name":"test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":2960,"wires":[["b0291746.cff2c8"]]},{"id":"3f054ecd.8fd592","type":"trigger-state","z":"aa7cb008.caa93","name":"","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.front_door_doorbell","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":360,"y":240,"wires":[["626c9c60.424654"],[]]},{"id":"ab287ee4.ae309","type":"http request","z":"aa7cb008.caa93","name":"","method":"GET","ret":"bin","paytoqs":"ignore","url":"http://192.168.1.31:81/image/doorbell?s=50","tls":"","persist":false,"proxy":"","authType":"basic","x":860,"y":240,"wires":[["516dec89.76ed74"]]},{"id":"516dec89.76ed74","type":"file","z":"aa7cb008.caa93","name":"","filename":"/config/www/images/doorbell-press-alert.jpg","appendNewline":false,"createDir":false,"overwriteFile":"true","encoding":"none","x":1120,"y":240,"wires":[["e1a99c51.24f4d"]]},{"id":"87cacc56.37195","type":"inject","z":"aa7cb008.caa93","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":490,"y":200,"wires":[["626c9c60.424654"]]},{"id":"e1a99c51.24f4d","type":"api-call-service","z":"aa7cb008.caa93","name":"Android Notification - Doorbell","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"notify","service":"{{ global.notify_service_andrews_phone }}","entityId":"","data":"{\"title\":\"Someone rang the doorbell!\",\"message\":\"Tap to view live feed\",\"data\":{\"clickAction\":\"/sub-doorbell/0\",\"tag\":\"doorbell_button_alert\",\"image\":\"local/images/doorbell-press-alert.jpg\"}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1440,"y":240,"wires":[[]]},{"id":"626c9c60.424654","type":"trigger","z":"aa7cb008.caa93","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"30","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":680,"y":240,"wires":[["ab287ee4.ae309"]]},{"id":"13aee46f.728cac","type":"api-call-service","z":"c6727c1e.1d54f","name":"Turn On Guest Room Lights","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.guest_room_lights","data":"{\"brightness\":255,\"kelvin\":3000}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1520,"y":1260,"wires":[[]]},{"id":"d04d00b3.cff2e","type":"trigger-state","z":"d0661cff.7e5c6","name":"Garage Chromecast goes from OFF/IDLE to PLAYING","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"media_player.garage_tv","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"previous_state","comparatorType":"includes","comparatorValueDatatype":"list","comparatorValue":"idle, off","propertyValue":"old_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":260,"y":800,"wires":[["b26b5b84.5d5758"],[]]},{"id":"b26b5b84.5d5758","type":"api-call-service","z":"d0661cff.7e5c6","name":"HEOS Speaker - Select AUX In","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"media_player","service":"select_source","entityId":"media_player.portable_speaker","data":"{\"source\":\"Portable Speaker - AUX In\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":630,"y":800,"wires":[["7422933.82c316c"]]},{"id":"7422933.82c316c","type":"api-call-service","z":"d0661cff.7e5c6","name":"HEOS Speaker - Set Volume 50%","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"media_player","service":"volume_set","entityId":"media_player.portable_speaker","data":"{\"volume_level\":\"0.5\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":800,"wires":[["34c3bdda.867ae2"]]},{"id":"34c3bdda.867ae2","type":"api-call-service","z":"d0661cff.7e5c6","name":"Garage Chromecast - Set Volume 50%","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"media_player","service":"volume_set","entityId":"media_player.garage_tv","data":"{\"volume_level\":\"0.5\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1230,"y":800,"wires":[[]]},{"id":"2eb05a3a.da2a86","type":"inject","z":"d0661cff.7e5c6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":840,"wires":[["b26b5b84.5d5758"]]},{"id":"2fdada27.dfadb6","type":"trigger-state","z":"d0661cff.7e5c6","name":"Garage Chromecast goes from OFF","server":"a86c4410.e2a568","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"media_player.garage_tv","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":310,"y":900,"wires":[["d31796e1.0403d8"],[]]},{"id":"d31796e1.0403d8","type":"api-render-template","z":"d0661cff.7e5c6","name":"Is HEOS source set to AUX?","server":"a86c4410.e2a568","template":"{{ state_attr(\"media_player.portable_speaker\", \"source\") == \"Portable Speaker - AUX In\" }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":620,"y":900,"wires":[["d446d16b.5406c"]]},{"id":"d446d16b.5406c","type":"switch","z":"d0661cff.7e5c6","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":810,"y":900,"wires":[["76ff3aef.dd60c4"]]},{"id":"76ff3aef.dd60c4","type":"api-call-service","z":"d0661cff.7e5c6","name":"HEOS Speaker - Stop","server":"a86c4410.e2a568","version":1,"debugenabled":false,"service_domain":"media_player","service":"media_stop","entityId":"media_player.portable_speaker","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":980,"y":900,"wires":[[]]},{"id":"a69145d9.7dd0e8","type":"api-current-state","z":"dbd2ebf4.b8f648","name":"Is Weekday?","server":"a86c4410.e2a568","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.is_weekday","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":710,"y":420,"wires":[["f9c13132.596af"],[]]}]