###################################################################
#
# Lights
# ------
#
#   This package contains configuration for lighting automation.
#
# Features
# --------
# 
#  * Define light groups (creates single light entities)
#  * Sync kitchen cabinet lights
#  * 
#
###################################################################


light:
- platform: group
  name: Living Room Lights
  entities:
    - light.couch_lamp
    - light.love_seat_lamp
- platform: group
  name: Guest Room Lights
  entities:
    - light.guest_room_lamp_1
    - light.guest_room_lamp_2
    - light.guest_room_ambience
- platform: group
  name: Master Bedroom Lights
  entities:
    - light.kp_bedside
    - light.andrew_bedside
- platform: group
  name: Man-cave Lights
  entities:
    - light.man_cave
    - light.man_cave_ambience
    - light.man_cave_dimmable
- platform: group
  name: Laundry Room Lights
  entities:
    - light.laundry_room_light_1
    - light.laundry_room_light_2
- platform: group
  name: Driveway Lights
  entities:
  - light.driveway_light_1
  - light.driveway_light_2
- platform: group
  name: Interior Lights
  entities:
  - light.couch_lamp
  - light.love_seat_lamp
  - light.man_cave_ambience
  - light.guest_room_ambience
  - light.guest_room_lamp_1
  - light.guest_room_lamp_2
  - light.kp_bedside
  - light.andrew_bedside
  - light.man_cave
  - light.man_cave_dimmable
  - light.laundry_room_light_1
  - light.laundry_room_light_2

input_select:
  # Current Mode variable
  automation_mode:
    name: Wake-up Time
    icon: mdi:timer
    options:
    - '00:00'
    - '00:15'
    - '00:30'
    - '00:45'
    - '01:00'
    - '01:15'
    - '01:30'
    - '01:45'
    - '02:00'
    - '02:15'
    - '02:30'
    - '02:45'
    - '03:00'
    - '03:15'
    - '03:30'
    - '03:45'
    - '04:00'
    - '04:15'
    - '04:30'
    - '04:45'
    - '05:00'
    - '05:15'
    - '05:30'
    - '05:45'
    - '06:00'
    - '06:15'
    - '06:30'
    - '06:45'
    - '07:00'
    - '07:15'
    - '07:30'
    - '07:45'
    - '08:00'
    - '08:15'
    - '08:30'
    - '08:45'
    - '09:00'
    - '09:15'
    - '09:30'
    - '09:45'
    - '10:00'
    - '10:15'
    - '10:30'
    - '10:45'
    - '11:00'
    - '11:15'
    - '11:30'
    - '11:45'
    - '12:00'
    - '12:15'
    - '12:30'
    - '12:45'
    - '13:00'
    - '13:15'
    - '13:30'
    - '13:45'
    - '14:00'
    - '14:15'
    - '14:30'
    - '14:45'
    - '15:00'
    - '15:15'
    - '15:30'
    - '15:45'
    - '16:00'
    - '16:15'
    - '16:30'
    - '16:45'
    - '17:00'
    - '17:15'
    - '17:30'
    - '17:45'
    - '18:00'
    - '18:15'
    - '18:30'
    - '18:45'
    - '19:00'
    - '19:15'
    - '19:30'
    - '19:45'
    - '20:00'
    - '20:15'
    - '20:30'
    - '20:45'
    - '21:00'
    - '21:15'
    - '21:30'
    - '21:45'
    - '22:00'
    - '22:15'
    - '22:30'
    - '22:45'
    - '23:00'
    - '23:15'
    - '23:30'
    - '23:45'
    

automation:
- alias: 10:00PM [Garage Closed] - Dim Driveway Lights
  trigger:
  - platform: time
    at: '22:00:00'
  condition:
  - condition: state
    entity_id: binary_sensor.openclose_12
    state: 'off'
  action:
  - data:
      brightness: '1'
      entity_id: light.driveway_lights
    service: light.turn_on

- alias: Kitchen Cabinet Lights - Off Sync
  trigger:
  - entity_id: switch.power_outlet_1
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: switch.power_outlet_2
    service: switch.turn_off

- alias: Kitchen Cabinet Lights - On Sync
  trigger:
  - entity_id: switch.power_outlet_1
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: switch.power_outlet_2
    service: switch.turn_on

- alias: Sunrise - Exterior Lights Off
  trigger:
  - entity_id: sun.sun
    from: below_horizon
    platform: state
    to: above_horizon
  condition: []
  action:
  - data:
      entity_id: light.driveway_lights
    service: light.turn_off

- alias: Front Door Multisensor - Turn on Driveway Lights
  trigger:
  - below: '10'
    entity_id: sensor.lightlevel_21
    for: 00:05:00
    platform: numeric_state
  condition:
  - condition: time
    after: '16:00:00'
    before: '23:59:00'
  action:
  - data:
      brightness: '255'
      entity_id: light.driveway_lights
    service: light.turn_on

- alias: Front Door Multi Sensor - Turn Inside Lights On
  trigger:
  - below: '100'
    entity_id: sensor.lightlevel_21
    for:
      minutes: 5
    platform: numeric_state
  condition:
  - condition: state
    entity_id: group.all_device_trackers
    state: home
  - condition: time
    after: '16:00:00'
    before: '23:59:00'
  action:
  - data:
      entity_id: switch.living_room_fluxer
    service: switch.turn_off
  - data:
      entity_id: light.living_room_lights
      brightness: '255'
    service: light.turn_on
  - data:
      entity_id: switch.ikea_outlet_1
    service: switch.turn_on
  - data:
      entity_id: switch.power_outlet_1
    service: switch.turn_on
  - data:
      entity_id: switch.power_outlet_2
    service: switch.turn_on

# When kaitlyn leaves for work on weekday mornings, turn lights off
- alias: Kaitlyn Leaves For Work - Turn Lights Off
  trigger:
  - platform: state
    entity_id: person.kaitlyn
    to: not_home
    for: '00:05:00'
  condition:
  - condition: time
    after: '04:00:00'
    before: '10:00:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: person.andrew
    state: home
  - condition: template
    value_template: '{{ states("input_select.automation_mode") in ["home"] }}'
  action:
  - service: light.turn_off
    data:
      entity_id: light.living_room_lights
  - service: light.turn_off
    data:
      entity_id: light.master_bedroom_lights
  - service: script.turn_off_kitchen_lights

script:
  lights_bright_up:
    alias: Lights Brightness Up
    sequence:
    - service: light.turn_on
      data_template:
        entity_id: "{{ entity_id }}"
        brightness: >
          {% set n = (state_attr(entity_id, "brightness") | int) + 50 %}
          {% if n > 254 %}
          254
          {% else %}
          {{ n }}
          {% endif %}

  lights_bright_down:
    alias: Lights Brightness Down
    sequence:
    - service: light.turn_on
      data_template:
        entity_id: "{{ entity_id }}"
        brightness: >
          {% set n = state_attr(entity_id, 'brightness') | int - 50 %}
          {% if n < 4 %}
          4
          {% else %}
          {{ n }}
          {% endif %}

  all_lights_off:
    alias: All Lights Off
    sequence:
    - service: light.turn_off
      data:
        entity_id: group.all_lights
    - service: switch.turn_off
      data:
        entity_id: switch.power_outlet_1
    - service: switch.turn_off
      data:
        entity_id: switch.power_outlet_2
    - service: switch.turn_off
      data:
        entity_id: switch.ikea_outlet_1
  
  turn_on_living_room_lights:
    alias: Turn On Living Room Lights
    sequence:
    - service: switch.turn_off
      data:
        entity_id: switch.living_room_fluxer
    - service: light.turn_on
      data:
        entity_id: light.living_room_lights
        brightness: '255'

  turn_off_interior_lights:
    alias: Turn Off Interior Lights
    sequence:
    - service: light.turn_off
      data:
        entity_id: light.interior_lights
    - service: switch.turn_off
      data:
        entity_id:
        - group.interior_light_switches

  turn_on_interior_lights:
    alias: Turn On Interior Lights
    sequence:
    - service: script.turn_on_living_room_lights
    - service: script.turn_on_kitchen_lights
    - service: script.turn_on_patio_lights

  turn_on_patio_lights:
    alias: Turn On Patio Lights
    sequence:
    - service: switch.turn_on
      data:
        entity_id: switch.ikea_outlet_2

  turn_off_patio_lights:
    alias: Turn Off Patio Lights
    sequence:
    - service: switch.turn_off
      data:
        entity_id: switch.ikea_outlet_2
  
  
  turn_on_kitchen_lights:
    alias: Turn On Kitchen Lights
    sequence:
    - service: switch.turn_on
      entity_id:
      - switch.power_outlet_1
      - switch.power_outlet_2

  turn_off_kitchen_lights:
    alias: Turn On Kitchen Lights
    sequence:
    - service: switch.turn_off
      entity_id:
      - switch.power_outlet_1
      - switch.power_outlet_2

  turn_on_entry_way_lights:
    alias: Turn On Entry Way Lights
    sequence:
    - service: light.turn_on
      data:
        entity_id: light.laundry_room_lights
        brightness: '255'
  
  man_cave_alert:
    alias: Man Cave Alert
    sequence:
    - service: light.toggle
      data:
        entity_id: light.man_cave
    - delay:
        seconds: 1
    - service: light.toggle
      data:
        entity_id: light.man_cave
    - delay:
        seconds: 1
    - service: light.toggle
      data:
        entity_id: light.man_cave
    - delay:
        seconds: 1
    - service: light.toggle
      data:
        entity_id: light.man_cave
    - delay:
        seconds: 1
    - service: light.toggle
      data:
        entity_id: light.man_cave
    - delay:
        seconds: 1
    - service: light.toggle
      data:
        entity_id: light.man_cave

  man_cave_bright_mode:
    alias: Man Cave Bright Mode
    sequence:
    - service: light.turn_on
      data:
       entity_id: light.man_cave
       brightness: '255'
       color_temp: '255'
    - service: light.turn_on
      data:
        entity_id: light.man_cave_dimmable
        brightness: '255'
    - service: light.turn_on
      data:
        entity_id: light.man_cave_ambience
        brightness: '255'
  
  man_cave_reading_mode:
    alias: Man Cave Reading Mode
    sequence:
    - service: light.turn_off
      data:
       entity_id: light.man_cave
    - service: light.turn_on
      data:
        entity_id: light.man_cave_dimmable
        brightness: '255'
    - service: light.turn_on
      data:
        entity_id: light.man_cave_ambience
        brightness: '2'
  
  man_cave_night_mode:
    alias: Man Cave Night Mode
    sequence:
    - service: light.turn_off
      data:
       entity_id: light.man_cave
    - service: light.turn_off
      data:
        entity_id: light.man_cave_dimmable
    - service: light.turn_on
      data:
        entity_id: light.man_cave_ambience
        brightness: '2'